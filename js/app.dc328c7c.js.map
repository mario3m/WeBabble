{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue?9745","webpack:///./src/store/Constants.js","webpack:///./src/store/AuxMethods.js","webpack:///./src/App.vue?1ddc","webpack:///src/App.vue","webpack:///./src/App.vue?0bd2","webpack:///./src/App.vue","webpack:///./src/views/Home.vue?6443","webpack:///src/views/Home.vue","webpack:///./src/views/Home.vue?f351","webpack:///./src/views/Home.vue","webpack:///./src/store/modules/database.js","webpack:///./src/store/modules/permissions.js","webpack:///./src/store/modules/users.js","webpack:///./src/store/modules/user.js","webpack:///./src/store/modules/events.js","webpack:///./src/store/modules/chats.js","webpack:///./src/store/modules/ranking.js","webpack:///./src/store/store.js","webpack:///./src/router.js","webpack:///./src/registerServiceWorker.js","webpack:///./src/plugins/vuetify.js","webpack:///./src/main.js","webpack:///./src/assets/logo.png","webpack:///./src/views/Home.vue?c554"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","installedCssChunks","jsonpScriptSrc","p","exports","module","l","e","promises","cssChunks","Promise","resolve","reject","href","fullhref","existingLinkTags","document","getElementsByTagName","tag","dataHref","getAttribute","rel","existingStyleTags","linkTag","createElement","type","onload","onerror","event","request","target","src","err","Error","code","parentNode","removeChild","head","appendChild","then","installedChunkData","promise","onScriptComplete","script","charset","timeout","nc","setAttribute","error","clearTimeout","chunk","errorType","realSrc","message","name","undefined","setTimeout","all","m","c","d","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","oe","console","jsonpArray","window","oldJsonpFunction","slice","ERROR_GENERIC_PROBLEM","ERROR_GENERIC_CONNECTION_PROBLEM","ERROR_GENERIC_DATABASE_PROBLEM","ERROR_ALREADY_AN_ACCOUNT_WITH_THIS_EMAIL","ERROR_ALREADY_AN_ACCOUNT_WITH_THIS_USERNAME","ERROR_WRONG_EMAIL_PASSWORD_COMBINATION","ERROR_UPLOADING_IMAGE","ERROR_SOMETHING_HAPPENED","ERROR_API_FILEREADER_NOT_SUPPORTED","ERROR_PASSWORDS_DONT_MATCH","ERROR_TOO_MANY_REQUESTS","ERROR_TEXT_WRONG_PASSWORD","ERROR_NO_ACCOUNT_WITH_THIS_EMAIL","ERROR_GETTING_CURRENT_LOCATION","RULE_TEXT_MANDATORY_FIELD","RULE_MIN_VALUE_CHARACTERS_USERNAME","RULE_MAX_VALUE_CHARACTERS_USERNAME","RULE_TEXT_MIN_VALUE_CHARACTERS_USERNAME","RULE_TEXT_MAX_VALUE_CHARACTERS_USERNAME","RULE_TEXT_MIN_VALUE_CHARACTERS_USERNAME_TO_START_SEARCHING","RULE_MIN_VALUE_CHARACTERS_USER_DESCRIPTION","RULE_TEXT_MIN_VALUE_CHARACTERS_USER_DESCRIPTION","RULE_TEXT_MIN_VALUE_CHARACTERS_PASSWORD","RULE_MIN_VALUE_AGE","RULE_YOU_HAVE_TO_BE_AT_LEAST_X_YEARS_OLD_TO_REGISTER","ASK_FOR_IMAGE_SELECTION","DATABASE_USERNAME_FIELD","DATABASE_GENDER_FIELD","DATABASE_BIRTHDATE_FIELD","DATABASE_KNOWN_LANGUAGES_FIELD","DATABASE_LANGUAGES_TO_LEARN_FIELD","DATABASE_AVG_RATING_FIELD","DATABASE_NUM_RATINGS_FIELD","DATABASE_DATE_FIELD","RANKING_PAGE_SIZE","MAX_RANKING_PAGE_SIZE","SEARCHED_USERS_PAGE_SIZE","EVENTS_PAGE_SIZE","DATABASE_COLLECTION_EVENTS","MIN_USER_AGE","MAX_USER_AGE","TEXT_LANGUAGES_YOU_WANT_TO_IMPROVE","TEXT_LANGUAGES_YOU_WANT_TO_PRACTICE","TEXT_LANGUAGES_YOU_SPEAK_FLUENTLY","TEXT_MOTHER_LANGUAGES","TEXT_LANGUAGE_HE_SHE_WANT_TO_IMPROVE","TEXT_LANGUAGE_HE_SHE_WANT_TO_PRACTICE","TEXT_LANGUAGE_HE_SHE_SPEAK_FLUENTLY","TEXT_MOTHER_LANGUAGE","TEXT_LANGUAGE","TEXT_GENDER","TEXT_DISTANCE","TEXT_AGE","TEXT_FILTER_BY_MOTHER_LANGUAGE","TEXT_FILTER_BY_LANGUAGE_TO_LEARN","TEXT_SEARCH","TEXT_NO_FIT_USERS_TO_LIST","TEXT_FILTERS","TEXT_RATE_USER","TEXT_YOU","TEXT_CANCEL","TEXT_RATE","TEXT_REMOVE","TEXT_WATCH_MORE","TEXT_COULD_NOT_SET_YOUR_RATING","TEXT_PROBLEM_RETRIEVING_RANKING","TEXT_PROBLEM_GETTING_CURRENT_LOCATION","TEXT_PROBLEM_GETTING_NEARBY_USERS","TEXT_PROBLEM_GETTING_EVENTS","TEXT_NO_LIMIT","TEXT_1_KM","TEXT_5_KM","TEXT_10_KM","TEXT_20_KM","TEXT_REMOVE_FILTERS","TEXT_YOUR_PROFILE","TEXT_EDIT","TEXT_EDIT_PROFILE","TEXT_USERS","TEXT_TO_FILTER","TEXT_EVENTS","TEXT_RANKING","TEXT_CHATS","TEXT_CHAT","TEXT_CLOSE","MONTHS_OF_THE_YEAR_IN_TEXT","TEXT_SHOW_USERS","TEXT_OF","TEXT_CREATE_YOUR_ACCOUNT","TEXT_CREATE_AN_ACCOUNT","TEXT_NAME","TEXT_LASTNAME","TEXT_EMAIL","TEXT_EMAIL_DIRECTION","TEXT_PASSWORD","TEXT_REPEAT_PASSWORD","TEXT_REGISTER","TEXT_REGISTER_NOW","TEXT_ALREADY_HAVE_AN_ACCOUNT","TEXT_ACCESS_NOW","TEXT_ACCESS_TO_YOUR_ACCOUNT","TEXT_VERIFICATION_EMAIL_SENT_TO","TEXT_VERIFY_YOUR_EMAIL","TEXT_USERNAME","TEXT_FILL_YOUR_PROFILE","TEXT_BIRTHDATE","TEXT_TELL_US_A_LITTLE_ABOUT_YOU","TEXT_TO_CONTINUE","TEXT_YOUR_LANGUAGES","TEXT_WOMAN","TEXT_MAN","TEXT_ANY","TEXT_OTHER","TEXT_CHOOSE_YOUR_PROFILE_IMAGE","TEXT_EMAIL_NOT_VALID","TEXT_USERNAME_NOT_VALID","TEXT_HAVE_YOU_FORGOTTEN_YOUR_PASSWORD","TEXT_STILL_DONT_HAVE_AN_ACCOUNT","TEXT_TO_LOG_IN","TEXT_TO_LOG_OUT","TEXT_RESEND_EMAIL","TEXT_YOU_ARE_ABOUT_TO_LOG_OUT","TEXT_CONFIRM","TEXT_ARE_YOU_SURE_YOU_WANT_TO_LOG_OUT","TEXT_PROFILE_INFO","TEXT_LANGUAGES_TO_PRACTICE","TEXT_SAVE","TEXT_SETTINGS","TEXT_ACCOUNT","TEXT_PERMISSIONS","TEXT_NAME_AND_LASTNAME","TEXT_CHANGE_NAME_AND_LASTNAME","TEXT_CHANGE_EMAIL","TEXT_UPDATE","TEXT_VERIFY_YOUR_PASSWORD","TEXT_REMOVE_ACCOUNT","TEXT_INTRODUCE_YOUR_PASSWORD_TO_CONTINUE","TEXT_YOUR_EMAIL_HAS_BEEN_UPDATED","TEXT_YOUR_PASSWORD_HAS_BEEN_UPDATED","TEXT_CHANGE_PASSWORD","TEXT_CURRENT_PASSWORD","TEXT_NEW_PASSWORD","TEXT_CONFIRM_PASSWORD","TEXT_UPDATE_PASSWORD","TEXT_ENTER_YOUR_EMAIL_TO_RESET_YOUR_PASSWORD","TEXT_RESET_PASSWORD","TEXT_RESET_PASSWORD_INSTRUCTIONS","TEXT_SPACE_YEARS","TEXT_PARTICIPANTS","TEXT_NO_PARTICIPANTS_YET","TEXT_VERIFICATION_EMAIL_SENT","TEXT_NO_USERS_MATCH_SEARCH","TEXT_NO_EVENTS_MATCH_SEARCH","TEXT_NO_CHATS_AVAILABLE","IMG_USER_PROFILE_HEADER","IMG_EMOJI_SAD_FACE","arraysContainSameElements","arr1","arr2","Array","isArray","arr1_aux","concat","sort","arr2_aux","shuffle","array","Math","random","emptyCallback","angleInRad","x","PI","generateChatID","id1","id2","chatID","_vm","this","_h","$createElement","_c","_self","staticStyle","_e","staticRenderFns","component","VApp","staticClass","attrs","_v","_s","createAnAccountText","toLogInText","Constants","VBtn","VContainer","Vue","use","Vuex","namespaced","state","getters","mutations","actions","isUserAuth","firebase","currentUser","setAccount","context","firestoreDB","collection","doc","uid","set","lastName","role","chats","tokens","merge","log","catch","askForMessagingPermission","requestPermission","generatePushNotificationToken","getToken","token","localStorage","getItem","currentMessageToken","update","FieldValue","arrayUnion","getAccount","id","email","createAccountListener","userID","docRef","onSnapshot","user","formattedUser","listener","dispatch","root","createAccount","createUserWithEmailAndPassword","password","setPersistance","setPersistence","Auth","Persistence","LOCAL","login","signInWithEmailAndPassword","logout","signOut","sendEmailVerification","isEmailVerified","reload","emailVerified","sendPasswordResetEmail","updateAccountData","batch","infoToUpdate","commit","updateAccountEmail","updateEmail","updateAccountPassword","updatePassword","getProfileByUID","toDate","setHours","getProfile","profileInfo","getMultipleProfilesByUID","ids","userProfiles","forEach","getProfileByUsername","username","where","querySnapshot","size","docs","setProfile","toLowerCase","birthDate","Date","gender","description","avgRating","numRatings","updateProfile","knownLanguages","languagesToLearn","profileImg","setLanguages","uploadProfileImg","img","path","url","uploadImg","storageDB","ref","child","putString","getDownloadURL","setProfileImg","updateUserLocation","location","geoFirestore","GeoFirestore","coordinates","GeoPoint","lat","lng","date","getLocation","getRatings","exists","setRating","newRating","rating","delete","isNextUsersPageEmpty","page","lastUserShowed","filters","ageRange","orderBy","currentDate","setFullYear","getFullYear","language","filterBy","languageToLearn","knownLanguage","startAfter","endAt","limit","documentSnapshots","searchedUserIndex","findIndex","searchedUser","newDocs","map","dataDocs","getNextUsersPage","newLastUserShowed","startAt","users","getNearbyUserIDs","geofirestore","queryNearbyUsers","near","center","radius","maxDistance","snapshot","getUsersWithSimilarUsername","getEventByID","getNextEventsPage","newLastEventShowed","lastEventShowed","eventsRetrieved","events","isNextEventsPageEmpty","addParticipantToEvent","eventID","participants","removeParticipantFromEvent","arrayRemove","createChatMessagesListener","chatMessages","messages","docChanges","change","formattedChatMessages","setMessagesToRead","addMessagesToChat","newMessage","serverTimestamp","sender","read","text","addChat","chat","newChat","getChatByID","getTop100RankingUsers","position","getUserRankingPositionByID","database","isGeolocationPermissionGranted","isPushNotificationPermissionGranted","getIsGeolocationPermissionGranted","getIsPushNotificationPermissionGranted","resetState","setIsGeolocationPermissionGranted","setIsPushNotificationPermissionGranted","checkForGeolocationPermission","navigator","permissions","query","geolocation","getCurrentPosition","AuxMethods","onchange","checkForPushNotificationsPermission","isPermissionGranted","searchedUsersIDs","genderFilter","ageRangeFilter","languageFilter","searchByUsernameFilter","maxDistanceFilter","maxDistanceRanges","maxDistanceRangesText","locationFilter","nearbyUsersIDs","distanceSearchFilter","getUsers","getGenderFilter","getAgeRangeFilter","getLanguageFilter","getSearchByUsernameFilter","getMaxDistanceFilter","getMaxDistanceRanges","getMaxDistanceRangesText","getUserByID","getNearbyUsersIDs","getNearbyUsersIDsLength","areThereFiltersOn","getFilters","filtersOn","getLastUserShowed","getSearchedUsers","searchedUsersReturn","getSearchedUsersIDsLength","getSearchedUsersIDs","setUsers","setGenderFilter","setAgeRangeFilter","setNearbyUsersIDs","setLanguageFilter","setLocationFilter","setSearchByUsernameFilter","setMaxDistanceFilter","addUser","addSearchedUserID","resetSearchedUsersIDs","setLastUserShowed","addRating","userTo","prev","newAvgRating","areThereMore","isEmpty","data2","isEmpty2","areThereMoreNearbyUsers","allIDs","idsToGetProfiles","isValid","startsWith","languageToLearnIndex","lang","knownLanguageIndex","getNearbyUsersProfiles","usersAdded","resetSearchedUsers","setFilters","resetFilters","ratings","genderOptions","defaultProfileImg","languageOptions","getName","getID","getLastName","getEmail","getRole","getChats","getUsername","getBirthDate","getGender","getDescription","getProfileImg","getAvgRating","getNumRatings","getKnownLanguages","getLanguagesToLearn","getGenderTextByID","getGenderImgByID","getGenderDefaultProfileImgByUserGender","getGenderOptionsAsArray","keys","getLanguageTextByID","getLanguageImgByID","getLanguageOptionsAsArray","getFormattedDateInTextMonth","getDate","getMonth","getLanguageFromLanguageOptionsByID","getRating","setIDe","setName","setLastName","setEmail","setRole","setChats","accountInfo","setUsername","setBirthDate","setGender","setDescription","setAvgRating","setNumRatings","setKnownLanguages","setLanguagesToLearn","setRatings","setLocation","initState","generateNotificationToken","updateAccountNameAndLastName","isUserLogged","isIt","checkIfEmailIsVerified","isVerified","checkIfUsernameIsAlreadyRegistered","createProfile","isAlreadyRegistered","nextTick","getRegistrationState","checkRegistrationState","getCurrentLocation","coords","latitude","longitude","ratingsInfo","rateUser","currentLocation","eventsToShowIDs","getEvents","getEventsToShow","eventsToShow","getLastEventShowed","amIParticipating","found","find","participantID","addEvent","addEventToShow","setEventsToShowIDs","setLastEventShowed","userLocation","distance","eventLocation","_lat","_long","eventNonFormattedLoc","haversine","getEventParticipants","chatsToShowIDs","chatListListener","chatMessagesListeners","getChatsToShowIDs","getChatMessagesByChatID","getUnreadMessagesByChatID","myID","unreadMessages","getChatsToShow","chatsToShow","auxChat","lastMessage","getUserByChatID","getNotReadMessagesCountByChatID","count","addChatMessagesListener","updateChatMessages","index","mMessage","sortChatMessagesByDate","compareChatMessagesByDate","a","b","dateA","dateB","addChatToShow","sortChatsToShowByLastMessage","compareChatsByLastMessageDate","chatALastMessageDate","chatBLastMessageDate","setChatListListener","pushChatMessages","mp","alreadyAdded","manageChatListChange","cch","manageChatMessagesChange","newMessages","modifiedMessagesToRead","modifiedMessagesDated","setChatMessagesToReadByChatID","sendNewChatMessage","messageText","createChatListeners","rankingUsers","rankingUsersIDs","rankingUser","getRankingUsersToShow","rus","ru","score","getRankedUserByIndex","getRankingUsers","setRankingUser","setRankingUsers","resetRankingUsers","resetRankingUsersIDs","addRankingUserID","rankingUserID","top100Users","userIndex","getPagedRankingUsers","newUserShowed","pageEnding","areThereMoreRankingUsersToShow","Store","ranking","appInfoLoaded","allAvailableLanguages","allAvailableGenders","defaultInfo","userImage","maleUserImage","femaleUserImage","profileHeaderImage","searchInfo","lastVisible","userIDs","filtering","genderW","genderM","searchByUsername","filterByLanguageToLearn","userInfo","registrationState","profileImage","chatIDs","chatUsers","chatIDsListener","chatsInfo","activeChat","rankingInfo","activeUser","eventsInfo","activeEventID","getAppInfoLoaded","notReadMessagesCountByChatID","chatIndex","notReadMessagesCount","getProfileHeaderImage","getUserIndexByUID","getUserByUID","getSearchUsers","searchUsers","searchUser","getOtherUserInChatByChatID","getChatWithUserByChatID","getEmailVerified","getRatingOfUserByUID","getChatsInfoActiveChat","getActiveEvent","getEvent","getActiveChatUserID","getChatUserByChatID","getNewChatMessageIndex","getSearchInfoUsers","getSearchInfoUserByUID","getChatWithUser","chatWithUser","getSearchInfoFilteringFilterByLanguageToLearn","getSearchInfoFiltering","getSearchInfoLastVisible","getSearchInfo","getLanguageNameByID","getAllAvailableLanguagesAsArray","getGenderNameByID","getAngleInRad","getHaversineDistance","p1","p2","R","dLat","dLong","sin","cos","atan2","sqrt","getAllAvailableGendersAsArray","getPathToFlagImageByLanguageID","getDefaultInfoUserImage","getUserInfo","getUserInfoLocation","getUserInfoUID","getUserInfoChatIDs","getMaleDefaultInfoUserImage","getFemaleDefaultInfoUserImage","getDefaultInfoUserImageByGender","getUserInfoProfileImage","getLanguageObjectsByIDs","lids","lobjects","lid","lobject","getFormattedMonthIn3CapitalLettersText","month","charAt","toUpperCase","getStoreInitiated","storeInitiated","setAppInfoLoaded","setSearchInfoFilteringNearbyUsersIDs","setEmailVerified","setUserInfoLocation","resetSearchInfoUserIDs","resetUserInfo","setSearchInfoFiltering","newFiltering","resetRankingInfo","resetEventsInfo","resetChatsInfoActiveChat","resetChats","resetRatings","setUserRating","to","setUserRatingInfo","setNewUserRatingInfo","newNumRatings","oldRatingTotal","setUserRatings","setUserInfoEmail","setUserInfoChatIDs","setUserInfoChatIDsListener","addChatToChats","addUserToChatUsers","user2","addChatIDToChatIDs","addMessageToChat","setUserInfoUID","addUserToSearchInfoUserIDs","addRankingInfoUserID","userToAddUID","addSearchInfoUserID","setSearchInfoUserIDs","addEventsInfoEvent","userToAdd","setSearchInfoFilteringSearchByUsername","resetSearchInfo","resetSearchInfoFiltering","setSearchInfoLastVisible","setRankingInfoLastVisible","setEventsInfoLastVisible","setSearchInfoFilter","filter","setUserInfoUsername","setUserInfoName","setUserInfoLastName","setUserInfoBirthDate","setUserInfoGender","setUserInfoAvgRating","setUserInfoNumRatings","setSearchedUserAvgRating","setSearchedUserNumRatings","setUserInfoDescription","setUserInfoProfileImage","setUserInfoKnownLanguages","setUserInfoLanguagesToLearn","setRegistrationState","st","setChatWithUser","setChatsInfoActiveChat","setActiveEventID","setMessageToRead","messageIndex","messageID","closeAllChatListenersFirebase","databaseListener","addNewMessage","created","messageIndex2","getTime","resetChat","isUsernameInUseFirebase","setUserPersistanceFirebase","registerUserFirebase","logoutUserFirebase","setUserPrivateInfoFirebase","setUserPrivateInfoRegistrationStateFirebase","sendEmailVerificationFirebase","checkEmailVerifiedFirebase","setUserProfileInfoFirebase","setUserLanguagesFirebase","knownLanguagesDB","languagesToLearnDB","setUserProfileImageDatabase","imageUpload","deleteUserProfileImageDatabase","loginUserFirebase","success","getAppInfoForLoggedUserFirebase","getUserPrivateInfo","warn","getUserPublicInfoDocByUIDFirebase","userDoc","getUserPublicInfo","userChats","createChatIDsListenerFirebase","setChatWithUserMessagesToRead","sendChatMessageFirebase","myUID","otherUserUID","listUsersSearchedPageFirebase","first","page2","lastVisible2","page3","documentSnapshots2","originalDocs","setSearchedUsersState","usersRetrieved","isNextUsersSearchedPageEmptyFirebase","searchUsersByUsernameFirebase","searchByUsernameField","prepareChatWithUser","createChatFirebase","createChatListenerFirebase","otherUserID","ratingInfo","error2","setRatingInRatingsFirebase","from","getRatingsInRatingsFirebase","getRatingInUsersPublicInfo","returnValue","listUsersRankingPageFirebase","isNextRankingUsersPageEmptyFirebase","getUserLocation","lastLocation","getUserLocationFirebase","lastLocationData","JSON","stringify","updateUserLocationFirebase","geolocateUser","getNearbyUsersFirebase","meters","listNearbyUsersSearchedPageFirebase","pageUsers","nearbyUsersIndex","nearbyUsersDocs","isNextNearbyUsersSearchedPageEmptyFirebase","listEventsEventsPageFirebase","eventCoordinates","distanceInKm","parseFloat","toFixed","isNextEventsEventsPageEmptyFirebase","getEventFirebase","documentSnapshot","getLoggedUser","resetAppState","initAppInfo","Router","router","base","process","routes","redirect","Home","meta","requiresAuth","children","menu","beforeEach","next","auth","matched","some","record","store","register","ready","registered","cached","updatefound","updated","offline","Vuetify","icons","iconfont","theme","light","primary","secondary","accent","info","warning","VueChatScroll","VueGoogleMaps","load","libraries","config","productionTip","app","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","initializeApp","db","firestore","settings","timestampsInSnapshots","enablePersistence","experimentalTabSynchronization","storage","messaging","onAuthStateChanged","vuetify","render","h","App","$mount"],"mappings":"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","file":"js/app.dc328c7c.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded CSS chunks\n \tvar installedCssChunks = {\n \t\t\"app\": 0\n \t}\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// script path function\n \tfunction jsonpScriptSrc(chunkId) {\n \t\treturn __webpack_require__.p + \"js/\" + ({}[chunkId]||chunkId) + \".\" + {\"chunk-03c1ac63\":\"36b611a3\",\"chunk-118d6538\":\"fee83e02\",\"chunk-4057901c\":\"b46c278c\",\"chunk-00fb658a\":\"99c6a22f\",\"chunk-34eb959b\":\"f49812c1\",\"chunk-2e5ee3cc\":\"77fc6a79\",\"chunk-4265ebd4\":\"5875a7b5\",\"chunk-3a0a4a79\":\"6d381fa0\",\"chunk-622f8ab8\":\"06c6d001\",\"chunk-1316b82a\":\"613d9b9e\",\"chunk-24881ba1\":\"0744e4ff\",\"chunk-2bfdb492\":\"d39ea9d7\",\"chunk-5fc618fa\":\"5822490b\",\"chunk-2919e26c\":\"cd5017e1\",\"chunk-4b03be8b\":\"0e5710a3\",\"chunk-a1b665b8\":\"cbe0d6c0\",\"chunk-01ac6596\":\"e7d04f2f\",\"chunk-04430290\":\"1f43ff3c\",\"chunk-bfde474e\":\"bbb3f3d9\",\"chunk-c6f98fe2\":\"302c5122\",\"chunk-05afca82\":\"c5717909\",\"chunk-3d7a4fc2\":\"ca8c72eb\",\"chunk-4a9d46ca\":\"c8f9111d\",\"chunk-c3d7f09e\":\"daf04df8\",\"chunk-0c346784\":\"fb9024d4\",\"chunk-3dc88c82\":\"90865176\",\"chunk-0a1d012c\":\"9c276f47\",\"chunk-c9e96654\":\"6e43c5c2\",\"chunk-8956f106\":\"567fc026\"}[chunkId] + \".js\"\n \t}\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n \t// This file contains only the entry chunk.\n \t// The chunk loading function for additional chunks\n \t__webpack_require__.e = function requireEnsure(chunkId) {\n \t\tvar promises = [];\n\n\n \t\t// mini-css-extract-plugin CSS loading\n \t\tvar cssChunks = {\"chunk-03c1ac63\":1,\"chunk-118d6538\":1,\"chunk-4057901c\":1,\"chunk-00fb658a\":1,\"chunk-34eb959b\":1,\"chunk-2e5ee3cc\":1,\"chunk-4265ebd4\":1,\"chunk-3a0a4a79\":1,\"chunk-622f8ab8\":1,\"chunk-1316b82a\":1,\"chunk-24881ba1\":1,\"chunk-2bfdb492\":1,\"chunk-5fc618fa\":1,\"chunk-2919e26c\":1,\"chunk-4b03be8b\":1,\"chunk-a1b665b8\":1,\"chunk-01ac6596\":1,\"chunk-04430290\":1,\"chunk-bfde474e\":1,\"chunk-c6f98fe2\":1,\"chunk-05afca82\":1,\"chunk-3d7a4fc2\":1,\"chunk-4a9d46ca\":1,\"chunk-c3d7f09e\":1,\"chunk-0c346784\":1,\"chunk-3dc88c82\":1,\"chunk-0a1d012c\":1,\"chunk-c9e96654\":1,\"chunk-8956f106\":1};\n \t\tif(installedCssChunks[chunkId]) promises.push(installedCssChunks[chunkId]);\n \t\telse if(installedCssChunks[chunkId] !== 0 && cssChunks[chunkId]) {\n \t\t\tpromises.push(installedCssChunks[chunkId] = new Promise(function(resolve, reject) {\n \t\t\t\tvar href = \"css/\" + ({}[chunkId]||chunkId) + \".\" + {\"chunk-03c1ac63\":\"3a36bb3a\",\"chunk-118d6538\":\"803f1308\",\"chunk-4057901c\":\"a7ab9d60\",\"chunk-00fb658a\":\"ec562ca4\",\"chunk-34eb959b\":\"9d44b928\",\"chunk-2e5ee3cc\":\"b2c7afec\",\"chunk-4265ebd4\":\"df0fdab8\",\"chunk-3a0a4a79\":\"a5256043\",\"chunk-622f8ab8\":\"dc35a825\",\"chunk-1316b82a\":\"b6154fbf\",\"chunk-24881ba1\":\"df0fdab8\",\"chunk-2bfdb492\":\"df0fdab8\",\"chunk-5fc618fa\":\"b69ea1e5\",\"chunk-2919e26c\":\"16f584ce\",\"chunk-4b03be8b\":\"7268b89c\",\"chunk-a1b665b8\":\"4551a332\",\"chunk-01ac6596\":\"8cea3ea7\",\"chunk-04430290\":\"84291cb1\",\"chunk-bfde474e\":\"8cea3ea7\",\"chunk-c6f98fe2\":\"23187cca\",\"chunk-05afca82\":\"8cea3ea7\",\"chunk-3d7a4fc2\":\"6c790320\",\"chunk-4a9d46ca\":\"c7210f2c\",\"chunk-c3d7f09e\":\"2e6c5a2d\",\"chunk-0c346784\":\"650191b5\",\"chunk-3dc88c82\":\"650191b5\",\"chunk-0a1d012c\":\"b315181b\",\"chunk-c9e96654\":\"7ee0a6c0\",\"chunk-8956f106\":\"1643a8cc\"}[chunkId] + \".css\";\n \t\t\t\tvar fullhref = __webpack_require__.p + href;\n \t\t\t\tvar existingLinkTags = document.getElementsByTagName(\"link\");\n \t\t\t\tfor(var i = 0; i < existingLinkTags.length; i++) {\n \t\t\t\t\tvar tag = existingLinkTags[i];\n \t\t\t\t\tvar dataHref = tag.getAttribute(\"data-href\") || tag.getAttribute(\"href\");\n \t\t\t\t\tif(tag.rel === \"stylesheet\" && (dataHref === href || dataHref === fullhref)) return resolve();\n \t\t\t\t}\n \t\t\t\tvar existingStyleTags = document.getElementsByTagName(\"style\");\n \t\t\t\tfor(var i = 0; i < existingStyleTags.length; i++) {\n \t\t\t\t\tvar tag = existingStyleTags[i];\n \t\t\t\t\tvar dataHref = tag.getAttribute(\"data-href\");\n \t\t\t\t\tif(dataHref === href || dataHref === fullhref) return resolve();\n \t\t\t\t}\n \t\t\t\tvar linkTag = document.createElement(\"link\");\n \t\t\t\tlinkTag.rel = \"stylesheet\";\n \t\t\t\tlinkTag.type = \"text/css\";\n \t\t\t\tlinkTag.onload = resolve;\n \t\t\t\tlinkTag.onerror = function(event) {\n \t\t\t\t\tvar request = event && event.target && event.target.src || fullhref;\n \t\t\t\t\tvar err = new Error(\"Loading CSS chunk \" + chunkId + \" failed.\\n(\" + request + \")\");\n \t\t\t\t\terr.code = \"CSS_CHUNK_LOAD_FAILED\";\n \t\t\t\t\terr.request = request;\n \t\t\t\t\tdelete installedCssChunks[chunkId]\n \t\t\t\t\tlinkTag.parentNode.removeChild(linkTag)\n \t\t\t\t\treject(err);\n \t\t\t\t};\n \t\t\t\tlinkTag.href = fullhref;\n\n \t\t\t\tvar head = document.getElementsByTagName(\"head\")[0];\n \t\t\t\thead.appendChild(linkTag);\n \t\t\t}).then(function() {\n \t\t\t\tinstalledCssChunks[chunkId] = 0;\n \t\t\t}));\n \t\t}\n\n \t\t// JSONP chunk loading for javascript\n\n \t\tvar installedChunkData = installedChunks[chunkId];\n \t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n \t\t\t// a Promise means \"currently loading\".\n \t\t\tif(installedChunkData) {\n \t\t\t\tpromises.push(installedChunkData[2]);\n \t\t\t} else {\n \t\t\t\t// setup Promise in chunk cache\n \t\t\t\tvar promise = new Promise(function(resolve, reject) {\n \t\t\t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n \t\t\t\t});\n \t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n \t\t\t\t// start chunk loading\n \t\t\t\tvar script = document.createElement('script');\n \t\t\t\tvar onScriptComplete;\n\n \t\t\t\tscript.charset = 'utf-8';\n \t\t\t\tscript.timeout = 120;\n \t\t\t\tif (__webpack_require__.nc) {\n \t\t\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n \t\t\t\t}\n \t\t\t\tscript.src = jsonpScriptSrc(chunkId);\n\n \t\t\t\t// create error before stack unwound to get useful stacktrace later\n \t\t\t\tvar error = new Error();\n \t\t\t\tonScriptComplete = function (event) {\n \t\t\t\t\t// avoid mem leaks in IE.\n \t\t\t\t\tscript.onerror = script.onload = null;\n \t\t\t\t\tclearTimeout(timeout);\n \t\t\t\t\tvar chunk = installedChunks[chunkId];\n \t\t\t\t\tif(chunk !== 0) {\n \t\t\t\t\t\tif(chunk) {\n \t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n \t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n \t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n \t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n \t\t\t\t\t\t\terror.type = errorType;\n \t\t\t\t\t\t\terror.request = realSrc;\n \t\t\t\t\t\t\tchunk[1](error);\n \t\t\t\t\t\t}\n \t\t\t\t\t\tinstalledChunks[chunkId] = undefined;\n \t\t\t\t\t}\n \t\t\t\t};\n \t\t\t\tvar timeout = setTimeout(function(){\n \t\t\t\t\tonScriptComplete({ type: 'timeout', target: script });\n \t\t\t\t}, 120000);\n \t\t\t\tscript.onerror = script.onload = onScriptComplete;\n \t\t\t\tdocument.head.appendChild(script);\n \t\t\t}\n \t\t}\n \t\treturn Promise.all(promises);\n \t};\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// on error function for async loading\n \t__webpack_require__.oe = function(err) { console.error(err); throw err; };\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/vuetify-loader/lib/loader.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/vuetify-loader/lib/loader.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"","export default{\r\n    /* ERRORS */\r\n    ERROR_GENERIC_PROBLEM: 'Parece que ha habido un problema con tu petición. Por favor, vuelve a intentarlo más tarde.',\r\n    ERROR_GENERIC_CONNECTION_PROBLEM: 'Parece que ha habido un problema de conexión. Por favor, vuelve a intentarlo más tarde.',\r\n    ERROR_GENERIC_DATABASE_PROBLEM: 'Parece que ha habido un problema con la base de datos. Por favor, vuelve a intentarlo más tarde.',\r\n    ERROR_ALREADY_AN_ACCOUNT_WITH_THIS_EMAIL: 'Ya existe una cuenta registrada con ese E-mail. Si es tuya, prueba a iniciar sesión-',\r\n    ERROR_ALREADY_AN_ACCOUNT_WITH_THIS_USERNAME: 'Ya existe un usuario con ese nombre.',\r\n    ERROR_WRONG_EMAIL_PASSWORD_COMBINATION: 'No existe una cuenta registrada con este E-mail o la contraseña es incorrecta.',\r\n    ERROR_UPLOADING_IMAGE: 'Error subiendo la imagen.',\r\n    ERROR_SOMETHING_HAPPENED: 'Parece que ha ocurrido un error.',\r\n    ERROR_API_FILEREADER_NOT_SUPPORTED: 'Lo sentimos, la API FileReader no está soportada.',\r\n    ERROR_PASSWORDS_DONT_MATCH: 'Las contraseñas no coinciden',\r\n    ERROR_TOO_MANY_REQUESTS: 'Parece que has realizado demasiadas peticiones en poco tiempo. Por favor, vuelve a intentarlo más tarde.',\r\n    ERROR_TEXT_WRONG_PASSWORD: 'Parece que la contraseña introducida no coincide con su contraseña actual.',\r\n    ERROR_NO_ACCOUNT_WITH_THIS_EMAIL: 'Parece que no hay ninguna cuenta registrada con este E-mail.',\r\n    ERROR_GETTING_CURRENT_LOCATION: 'Parece que ha habido un problema accediendo a su ubicación actual.',\r\n\r\n    /* RULES */\r\n    RULE_TEXT_MANDATORY_FIELD: 'Este campo es obligatorio',\r\n    RULE_MIN_VALUE_CHARACTERS_USERNAME: 5,\r\n    RULE_MAX_VALUE_CHARACTERS_USERNAME: 14,\r\n    RULE_TEXT_MIN_VALUE_CHARACTERS_USERNAME: 'Mínimo 5 caracteres',\r\n    RULE_TEXT_MAX_VALUE_CHARACTERS_USERNAME: 'Máximo 14 caracteres',\r\n    RULE_TEXT_MIN_VALUE_CHARACTERS_USERNAME_TO_START_SEARCHING: 'Mínimo 5 caracteres para realizar la búsqueda',\r\n    RULE_MIN_VALUE_CHARACTERS_USER_DESCRIPTION: 20,\r\n    RULE_TEXT_MIN_VALUE_CHARACTERS_USER_DESCRIPTION: 'Mínimo 20 caracteres',\r\n    RULE_TEXT_MIN_VALUE_CHARACTERS_PASSWORD: 'Mínimo 8 caracteres',\r\n    RULE_MIN_VALUE_AGE: 16,\r\n    RULE_YOU_HAVE_TO_BE_AT_LEAST_X_YEARS_OLD_TO_REGISTER: 'Debes tener al menos ' + '16' + ' años.',\r\n\r\n    /* INSTRUCTIONS */\r\n    ASK_FOR_IMAGE_SELECTION: 'Por favor, selecciona una imagen',\r\n\r\n\r\n    /* DATABASE */\r\n    DATABASE_USERNAME_FIELD: 'username',\r\n    DATABASE_GENDER_FIELD: 'gender',\r\n    DATABASE_BIRTHDATE_FIELD: 'birthDate',\r\n    DATABASE_KNOWN_LANGUAGES_FIELD: 'knownLanguages',\r\n    DATABASE_LANGUAGES_TO_LEARN_FIELD: 'languagesToLearn',\r\n    DATABASE_AVG_RATING_FIELD: 'avgRating',\r\n    DATABASE_NUM_RATINGS_FIELD: 'numRatings',\r\n    DATABASE_DATE_FIELD: 'date',\r\n    RANKING_PAGE_SIZE: 2,\r\n    MAX_RANKING_PAGE_SIZE: 100,\r\n    SEARCHED_USERS_PAGE_SIZE: 2, //Allways SEARCHED_USERS_PAGE_SIZE >= 2\r\n    EVENTS_PAGE_SIZE: 1,\r\n    DATABASE_COLLECTION_EVENTS: 'Events',\r\n\r\n    /* DATA */\r\n    MIN_USER_AGE: 16,\r\n    MAX_USER_AGE: 100,\r\n\r\n    /* TEXTS */\r\n    TEXT_LANGUAGES_YOU_WANT_TO_IMPROVE: '¿Qué idiomas buscas mejorar?',\r\n    TEXT_LANGUAGES_YOU_WANT_TO_PRACTICE: 'Idiomas que quieres practicar',\r\n    TEXT_LANGUAGES_YOU_SPEAK_FLUENTLY: '¿Qué idiomas hablas con soltura?',\r\n    TEXT_MOTHER_LANGUAGES: 'Idiomas maternos',\r\n    TEXT_LANGUAGE_HE_SHE_WANT_TO_IMPROVE: 'Idioma que busca mejorar',\r\n    TEXT_LANGUAGE_HE_SHE_WANT_TO_PRACTICE: 'Idioma que quiere practicar',\r\n    TEXT_LANGUAGE_HE_SHE_SPEAK_FLUENTLY: 'Idioma que habla con soltura',\r\n    TEXT_MOTHER_LANGUAGE: 'Idioma materno',\r\n    TEXT_LANGUAGE: 'Idioma',\r\n    TEXT_GENDER: 'Género',\r\n    TEXT_DISTANCE: 'Distancia',\r\n    TEXT_AGE: 'Edad',\r\n    TEXT_FILTER_BY_MOTHER_LANGUAGE: 'Filtrar por idioma materno',\r\n    TEXT_FILTER_BY_LANGUAGE_TO_LEARN: 'Filtrar por idioma que quiere practicar',\r\n    TEXT_SEARCH: 'Buscar',\r\n    TEXT_NO_FIT_USERS_TO_LIST: 'No se han encontrado usuarios que cumplan con los requisitos.',\r\n    TEXT_FILTERS: 'Filtros',\r\n    TEXT_RATE_USER: 'Valora al usuario',\r\n    TEXT_YOU: 'Tú',\r\n    TEXT_CANCEL: 'Cancelar',\r\n    TEXT_RATE: 'Valorar',\r\n    TEXT_REMOVE: 'Eliminar',\r\n    TEXT_WATCH_MORE: 'Ver más',\r\n    TEXT_COULD_NOT_SET_YOUR_RATING: 'Parece que ha habido un problema: No se ha podido guardar su valoración.',\r\n    TEXT_PROBLEM_RETRIEVING_RANKING: 'Parece que ha habido un problema al cargar el ranking. Por favor, comprueba tu conexión.',\r\n    TEXT_PROBLEM_GETTING_CURRENT_LOCATION: 'Parece que ha habido un problema: no se ha podido obtener tu localizacion actual.',\r\n    TEXT_PROBLEM_GETTING_NEARBY_USERS: 'Parece que ha habido un problema: no se han podido obtener los usuarios cercanos.',\r\n    TEXT_PROBLEM_GETTING_EVENTS: 'Parece que ha habido un problema: no se han podido obtener los eventos.',\r\n    TEXT_NO_LIMIT: 'Sin límite',\r\n    TEXT_1_KM: '1 km',\r\n    TEXT_5_KM: '5 km',\r\n    TEXT_10_KM: '10 km',\r\n    TEXT_20_KM: '20 km',\r\n    TEXT_REMOVE_FILTERS: 'Eliminar filtros',\r\n    TEXT_YOUR_PROFILE: 'Tu perfil',\r\n    TEXT_EDIT:'Editar',\r\n    TEXT_EDIT_PROFILE:'Editar perfil',\r\n    TEXT_USERS: 'Usuarios',\r\n    TEXT_TO_FILTER: 'Filtrar',\r\n    TEXT_EVENTS: 'Eventos',\r\n    TEXT_RANKING: 'Ranking',\r\n    TEXT_CHATS: 'Chats',\r\n    TEXT_CHAT: 'Chats',\r\n    TEXT_CLOSE: 'Cerrar',\r\n    MONTHS_OF_THE_YEAR_IN_TEXT: ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'],\r\n    TEXT_SHOW_USERS: 'Mostrar usuarios',\r\n    TEXT_OF: 'de',\r\n    TEXT_CREATE_YOUR_ACCOUNT: 'Crea tu cuenta',\r\n    TEXT_CREATE_AN_ACCOUNT: 'Crear una cuenta',\r\n    TEXT_NAME: 'Nombre',\r\n    TEXT_LASTNAME: 'Apellidos',\r\n    TEXT_EMAIL: 'E-mail',\r\n    TEXT_EMAIL_DIRECTION: 'Correo electrónico',\r\n    TEXT_PASSWORD: 'Contraseña',\r\n    TEXT_REPEAT_PASSWORD: 'Repite la contraseña',\r\n    TEXT_REGISTER: 'Registrar',\r\n    TEXT_REGISTER_NOW: '¡Regístrate ahora!',\r\n    TEXT_ALREADY_HAVE_AN_ACCOUNT: '¿Ya tienes una cuenta?',\r\n    TEXT_ACCESS_NOW: '¡Accede ahora!',\r\n    TEXT_ACCESS_TO_YOUR_ACCOUNT: 'Accede a tu cuenta',\r\n    TEXT_VERIFICATION_EMAIL_SENT_TO: 'Para poder continuar, completa el proceso de verificación a través del enlace que hemos enviado a tu E-mail:',\r\n    TEXT_VERIFY_YOUR_EMAIL: 'Verifica tu E-mail',\r\n    TEXT_USERNAME: 'Nombre de usuario',\r\n    TEXT_FILL_YOUR_PROFILE: 'Rellena tu perfil',\r\n    TEXT_BIRTHDATE: 'Fecha de nacimiento',\r\n    TEXT_TELL_US_A_LITTLE_ABOUT_YOU: 'Cuéntanos un poco sobre ti',\r\n    TEXT_TO_CONTINUE: 'Continuar',\r\n    TEXT_YOUR_LANGUAGES: 'Tus idiomas',\r\n    TEXT_WOMAN: 'Mujer',\r\n    TEXT_MAN: 'Hombre',\r\n    TEXT_ANY: 'Cualquiera',\r\n    TEXT_OTHER: 'Otro',\r\n    TEXT_CHOOSE_YOUR_PROFILE_IMAGE: 'Elige tu foto de perfil',\r\n    TEXT_EMAIL_NOT_VALID: 'E-mail no válido',\r\n    TEXT_USERNAME_NOT_VALID: 'Nombre de usuario no válido',\r\n    TEXT_HAVE_YOU_FORGOTTEN_YOUR_PASSWORD: '¿Has olvidado tu contraseña?',\r\n    TEXT_STILL_DONT_HAVE_AN_ACCOUNT: '¿Todavía no tienes una cuenta?',\r\n    TEXT_TO_LOG_IN: 'Iniciar sesión',\r\n    TEXT_TO_LOG_OUT: 'Cerrar sesión',\r\n    TEXT_RESEND_EMAIL: 'Volver a enviar E-mail',\r\n    TEXT_YOU_ARE_ABOUT_TO_LOG_OUT: 'Va a salir de su cuenta',\r\n    TEXT_CONFIRM: 'Confirmar',\r\n    TEXT_ARE_YOU_SURE_YOU_WANT_TO_LOG_OUT: '¿Está seguro de que quiere cerrar sesión?',\r\n    TEXT_PROFILE_INFO: 'Información de perfil',\r\n    TEXT_LANGUAGES_TO_PRACTICE: 'Idiomas a practicar',\r\n    TEXT_SAVE: 'Guardar',\r\n    TEXT_SETTINGS: 'Configuración e información',\r\n    TEXT_ACCOUNT: 'Cuenta',\r\n    TEXT_PERMISSIONS: 'Permisos',\r\n    TEXT_NAME_AND_LASTNAME: 'Nombre y apellidos',\r\n    TEXT_CHANGE_NAME_AND_LASTNAME: 'Cambiar nombre y apellidos',\r\n    TEXT_CHANGE_EMAIL: 'Cambiar correo electrónico',\r\n    TEXT_UPDATE: 'Actualizar',\r\n    TEXT_VERIFY_YOUR_PASSWORD: 'Verifica tu contraseña',\r\n    TEXT_REMOVE_ACCOUNT: 'Borrar cuenta',\r\n    TEXT_INTRODUCE_YOUR_PASSWORD_TO_CONTINUE: 'Vuelve a introducir tu contraseña de WeBabble para continuar.',\r\n    TEXT_YOUR_EMAIL_HAS_BEEN_UPDATED: 'Tu dirección de correo electrónico ha sido actualizada.',\r\n    TEXT_YOUR_PASSWORD_HAS_BEEN_UPDATED: 'Tu contraseña ha sido actualizada.',\r\n    TEXT_CHANGE_PASSWORD: 'Cambiar contraseña',\r\n    TEXT_CURRENT_PASSWORD: 'Contraseña actual',\r\n    TEXT_NEW_PASSWORD: 'Nueva contraseña',\r\n    TEXT_CONFIRM_PASSWORD: 'Confirmar la contraseña',\r\n    TEXT_UPDATE_PASSWORD: 'Actualizar contraseña',\r\n    TEXT_ENTER_YOUR_EMAIL_TO_RESET_YOUR_PASSWORD: 'Introduce tu E-mail y te ayudaremos a recuperar la contraseña:',\r\n    TEXT_RESET_PASSWORD: 'Restablecer contraseña',\r\n    TEXT_RESET_PASSWORD_INSTRUCTIONS: 'En un breve período de tiempo recibirás un email. Ábrelo y sigue las instrucciones para restablecer tu contraseña.',\r\n    TEXT_SPACE_YEARS: ' años',\r\n    TEXT_PARTICIPANTS: 'Participantes',\r\n    TEXT_NO_PARTICIPANTS_YET: 'Parece que todavía no se ha apuntado nadie. ¡Sé el primero!',\r\n    TEXT_VERIFICATION_EMAIL_SENT: 'E-mail de verificación enviado.',\r\n    TEXT_NO_USERS_MATCH_SEARCH: 'Parece que no hay usuarios que coincidan con tu búsqueda.',\r\n    TEXT_NO_EVENTS_MATCH_SEARCH: 'Parece que no hay eventos que coincidan con tu búsqueda.',\r\n    TEXT_NO_CHATS_AVAILABLE: 'Parece que no tienes ningún chat todavía. ¡Comienza a hablar con algún usuario!.',\r\n\r\n\r\n    /* IMAGES */\r\n    IMG_USER_PROFILE_HEADER: \"img/backgrounds/user_profile_header.png\",\r\n    IMG_EMOJI_SAD_FACE: 'img/emojis/sad_face.png'\r\n}\r\n","export default {\r\n    arraysContainSameElements: function (arr1, arr2) {\r\n\r\n        if (!Array.isArray(arr1) || !Array.isArray(arr2) || arr1.length !== arr2.length)\r\n            return false;\r\n\r\n        var arr1_aux = arr1.concat().sort();\r\n        var arr2_aux = arr2.concat().sort();\r\n\r\n        for (var i = 0; i < arr1_aux.length; i++) {\r\n\r\n            if (arr1_aux[i] !== arr2_aux[i])\r\n                return false;\r\n\r\n        }\r\n\r\n        return true;\r\n\r\n    },\r\n\r\n    shuffle: function (array) {\r\n        array.sort(() => Math.random() - 0.5);\r\n    },\r\n\r\n    emptyCallback: function () {\r\n\r\n    },\r\n    angleInRad: () => (x) => {\r\n        return x * Math.PI / 180;\r\n    },\r\n\r\n    generateChatID(id1, id2){\r\n        let chatID;\r\n\r\n        if (id1 < id2) {\r\n            chatID = id1 + id2;\r\n        } else {\r\n            chatID = id2 + id1;\r\n        }\r\n\r\n        return chatID;\r\n    }\r\n\r\n}","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-app',{staticStyle:{\"max-width\":\"100%\",\"height\":\"100%\"}},[(_vm.dataIsReady)?_c('router-view',{staticStyle:{\"max-width\":\"100%\",\"height\":\"100%\"}}):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <v-app style=\"max-width: 100%; height: 100%;\">\r\n        <router-view v-if=\"dataIsReady\" style=\"max-width: 100%; height: 100%;\"/>\r\n    </v-app>\r\n</template>\r\n\r\n<script>\r\n\r\n    import {mapActions, mapMutations} from 'vuex';\r\n    import firebase from \"firebase\";\r\n    import Constants from \"./store/Constants\";\r\n\r\n    export default {\r\n        name: 'App',\r\n        components: {},\r\n        data() {\r\n            return {\r\n                dataIsReady: false\r\n            }\r\n        },\r\n        methods: {\r\n            ...mapActions('user', ['getRegistrationState']),\r\n            ...mapActions(['initAppInfo', 'getLoggedUser']),\r\n        },\r\n        created() {\r\n            let self = this;\r\n\r\n            self.getLoggedUser().then(currentUser => {\r\n                if (currentUser != null && currentUser != undefined) {\r\n                    // user is logged in\r\n                    let resultInitAppInfo = self.initAppInfo();\r\n\r\n                    resultInitAppInfo\r\n                        .then(() => {\r\n                            self.dataIsReady = true;\r\n                        })\r\n                        .catch((error) => {\r\n                            self.snackbarText = error;\r\n                            self.snackbar = true;\r\n                        });\r\n                } else {\r\n                    self.$store.dispatch('resetAppState').then(() => {\r\n                        self.$router.replace('home');\r\n                    })\r\n                        .catch((error) => {\r\n                            self.snackbarText = error;\r\n                            self.snackbar = true;\r\n                        });\r\n\r\n                    self.dataIsReady = true;\r\n                    console.log(\"No user logged\");\r\n                }\r\n            });\r\n            //this.checkRegistrationState();\r\n            /*let self = this;\r\n            let resultInitAppInfo = this.initAppInfo();\r\n\r\n            resultInitAppInfo.then(() => {\r\n                self.dataIsReady = true;\r\n            })\r\n                .catch((error) => {\r\n                    console.log(error)\r\n                });*/\r\n\r\n        },\r\n\r\n    };\r\n</script>\r\n\r\n<style>\r\n    #app-toolbar {\r\n        width: 100%;\r\n    }\r\n\r\n    #loading {\r\n        display: flex;\r\n        flex-direction: column;\r\n        justify-content: center;\r\n        align-items: center;\r\n        text-align: center;\r\n        min-height: 100vh;\r\n    }\r\n</style>\r\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/vuetify-loader/lib/loader.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/vuetify-loader/lib/loader.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=1726166d&\"\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VApp } from 'vuetify/lib/components/VApp';\ninstallComponents(component, {VApp})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"img-back\"},[_c('v-container',{staticClass:\"home\",staticStyle:{\"height\":\"100%\",\"position\":\"relative\",\"width\":\"100%\"},attrs:{\"align\":\"center\"}},[_c('div',{staticStyle:{\"width\":\"100%\"},attrs:{\"align\":\"center\"}},[_c('img',{attrs:{\"src\":require(\"../assets/logo.png\")}})]),_c('div',{staticClass:\"bottom-centered-buttons\",attrs:{\"align\":\"center\"}},[_c('div',{staticStyle:{\"width\":\"100%\"},attrs:{\"align\":\"center\"}},[_c('router-link',{attrs:{\"to\":\"/sign-up\"}},[_c('v-btn',{staticStyle:{\"width\":\"100%\"},attrs:{\"color\":\"primary\"}},[_vm._v(_vm._s(_vm.createAnAccountText))])],1)],1),_c('br'),_c('div',{staticStyle:{\"width\":\"100%\"},attrs:{\"align\":\"center\"}},[_c('router-link',{attrs:{\"to\":\"/login\"}},[_c('v-btn',{staticStyle:{\"width\":\"100%\"},attrs:{\"color\":\"primary\"}},[_vm._v(_vm._s(_vm.toLogInText))])],1)],1)])])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"img-back\">\r\n    <v-container class=\"home\" style=\"height: 100%; position: relative; width: 100%\" align=\"center\">\r\n\r\n      <div align=\"center\" style=\"width: 100%\">\r\n        <img src=\"../assets/logo.png\"/>\r\n      </div>\r\n\r\n      <div class=\"bottom-centered-buttons\" align=\"center\">\r\n        <div align=\"center\" style=\"width: 100%\">\r\n          <router-link to=\"/sign-up\"><v-btn color=\"primary\" style=\"width: 100%\">{{createAnAccountText}}</v-btn></router-link>\r\n        </div>\r\n        <br >\r\n        <div align=\"center\" style=\"width: 100%\">\r\n          <router-link to=\"/login\"><v-btn color=\"primary\" style=\"width: 100%\">{{toLogInText}}</v-btn></router-link>\r\n        </div>\r\n      </div>\r\n    </v-container>\r\n  </div>\r\n\r\n</template>\r\n\r\n<script>\r\n\r\nimport Constants from \"../store/Constants\";\r\n\r\nexport default {\r\n  name: \"home\",\r\n  data() {\r\n    return {\r\n      createAnAccountText: Constants.TEXT_CREATE_AN_ACCOUNT,\r\n      toLogInText: Constants.TEXT_TO_LOG_IN,\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n  .bottom-centered-buttons{\r\n    width: 92.5%;\r\n    bottom:5%;\r\n    left: 50%;\r\n    transform: translate(-50%, 0);\r\n    position: fixed;\r\n  }\r\n\r\n  .img-back{\r\n    position: absolute;\r\n    top: 0px;\r\n    right: 0px;\r\n    height: 100%;\r\n    width: 100%;\r\n    background-image: url(\"../assets/home_background.jpg\");\r\n    background-position: center;\r\n    background-size: cover;\r\n  }\r\n\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/vuetify-loader/lib/loader.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/vuetify-loader/lib/loader.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Home.vue?vue&type=template&id=58559630&scoped=true&\"\nimport script from \"./Home.vue?vue&type=script&lang=js&\"\nexport * from \"./Home.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Home.vue?vue&type=style&index=0&id=58559630&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"58559630\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VContainer})\n","import Vue from 'vue'\r\nimport Vuex from 'vuex'\r\n\r\nVue.use(Vuex);\r\n\r\nimport * as firebase from \"firebase\";\r\nimport Constants from \"../Constants\";\r\nimport {GeoFirestore} from \"geofirestore\";\r\nimport {AxiosInstance as axios} from \"axios\";\r\n\r\n////////////////////////////////////////////////////////\r\n//-----     DATABASE (Firebase) INTERACTION      -----//\r\n////////////////////////////////////////////////////////\r\n\r\nexport default {\r\n    namespaced: true,\r\n    state: {},\r\n    getters: {},\r\n    mutations: {},\r\n    actions: {\r\n\r\n\r\n        /*--------------------------------------------------------------*/\r\n        /*------------------------- ACCOUNTS ---------------------------*/\r\n        /*--------------------------------------------------------------*/\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ isUserAuth ~                                                              >\r\n        // To determine if user is or is not authenticated                             >\r\n        //----------------------------------------------------------------------------->\r\n        isUserAuth: function () {\r\n            return firebase.auth().currentUser;\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ setAccount ~                                                              >\r\n        // To set user account info                                                    >\r\n        // parameters required: data {email, password, name, lastName, role}           >\r\n        //----------------------------------------------------------------------------->\r\n        setAccount: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                firestoreDB.collection(\"Accounts\").doc(firebase.auth().currentUser.uid).set(\r\n                    {\r\n                        name: data.name,\r\n                        lastName: data.lastName,\r\n                        role: 'user',\r\n                        chats: [],\r\n                        tokens: []\r\n                    },\r\n                    {merge: true}\r\n                )\r\n                    .then(() => {\r\n                        console.log(\"Account info successfully written in firebase\");\r\n                        resolve();\r\n                    })\r\n                    .catch(function (error) {\r\n                        console.error(error);\r\n                        reject(error);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ askForMessagingPermission ~                                               >\r\n        // To asf for messaging push notifications permission                          >\r\n        //----------------------------------------------------------------------------->\r\n        askForMessagingPermission(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                firebase.messaging().requestPermission()\r\n                    .then(() => {\r\n                        resolve(true);\r\n                    })\r\n                    .catch(() => {\r\n                        resolve(false);\r\n                    });\r\n\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ generatePushNotificationToken ~                                           >\r\n        // To generate push notifications token for this browser and user              >\r\n        //----------------------------------------------------------------------------->\r\n        generatePushNotificationToken(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                firebase.messaging().getToken().then(async (token) => {\r\n                    if (token) {\r\n                        const currentMessageToken = await window.localStorage.getItem('messagingToken');\r\n                        console.log('token will be updated', currentMessageToken != token)\r\n                        if (currentMessageToken != token) {\r\n                            console.log(\"token\")\r\n                            let firestoreDB = firebase.firestore();\r\n                            firestoreDB.collection(\"Accounts\").doc(firebase.auth().currentUser.uid).update(\r\n                                {tokens: firebase.firestore.FieldValue.arrayUnion(token)}\r\n                            )\r\n                                .then(() => {\r\n                                    resolve();\r\n                                })\r\n                                .catch(function (error) {\r\n                                    console.error(error);\r\n                                    reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                                });\r\n                        }\r\n                    } else {\r\n                        reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                    }\r\n                }).catch(function (error) {\r\n                    console.error(error);\r\n                    reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getAccount ~                                                              >\r\n        // To get user auth account info                                               >\r\n        //----------------------------------------------------------------------------->\r\n        getAccount() {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n                firestoreDB.collection(\"Accounts\").doc(firebase.auth().currentUser.uid).get()\r\n                    .then((doc) => {\r\n                        console.log(\"Account info successfully retrieved from firebase\");\r\n                        resolve({\r\n                            id: doc.id,\r\n                            email: firebase.auth().currentUser.email,\r\n                            ...doc.data()\r\n                        });\r\n                    })\r\n                    .catch((error) => {\r\n                        console.error(error);\r\n                        reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ createAccountListener ~                                                   >\r\n        // To listen on changes on user account info                                   >\r\n        // parameters required: userID                                                 >\r\n        //----------------------------------------------------------------------------->\r\n        createAccountListener: function (context, userID) {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                try {\r\n                    let docRef = firestoreDB.collection(\"Accounts\").doc(userID)\r\n                        .onSnapshot(function (user) {\r\n                            let formattedUser = {\r\n                                id: userID,\r\n                                ...user.data(),\r\n                                listener: docRef\r\n                            };\r\n                            context.dispatch(\"chats/manageChatListChange\", formattedUser, {root: true}).then(() => {\r\n                                resolve(formattedUser);\r\n                            })\r\n\r\n                        })\r\n                } catch (e) {\r\n                    console.error(e);\r\n                    reject(e);\r\n                }\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ createAccount ~                                                           >\r\n        // To create user account                                                      >\r\n        // parameters required: data {email, password, name, lastName}                 >\r\n        //----------------------------------------------------------------------------->\r\n        createAccount: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                    firebase.auth().createUserWithEmailAndPassword(data.email, data.password)\r\n                        .then(() => {\r\n                            console.log(\"Success creating account in firebase.\");\r\n                            resolve();\r\n                        })\r\n                        .catch((error) => {\r\n                            console.error(error);\r\n                            if (error.code == 'auth/email-already-in-use') {\r\n                                reject(Constants.ERROR_ALREADY_AN_ACCOUNT_WITH_THIS_EMAIL);\r\n                            } else {\r\n                                reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                            }\r\n                        });\r\n                }\r\n            );\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ setPersistance ~                                                          >\r\n        // To set firebase account persistance                                         >\r\n        //----------------------------------------------------------------------------->\r\n        setPersistance: function () {\r\n            return new Promise(function (resolve, reject) {\r\n                firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL)\r\n                    .then(() => {\r\n                        console.log(\"Success setting firebase account persistence.\");\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        console.error(error)\r\n                        reject(error);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ login ~                                                                   >\r\n        // To log in firebase user account                                             >\r\n        // parameters required: data {email, password}                                 >\r\n        //----------------------------------------------------------------------------->\r\n        login: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                firebase.auth().signInWithEmailAndPassword(data.email, data.password)\r\n                    .then(() => {\r\n                        console.log(\"Success logging user in firebase.\");\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        console.error(error);\r\n                        if (error.code == 'auth/wrong-password' || error.code == \"auth/user-not-found\") {\r\n                            reject(Constants.ERROR_WRONG_EMAIL_PASSWORD_COMBINATION);\r\n                        } else if (error.code == \"auth/too-many-requests\") {\r\n                            reject(Constants.ERROR_TOO_MANY_REQUESTS);\r\n                        } else {\r\n                            reject(Constants.ERROR_GENERIC_PROBLEM);\r\n                        }\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ login ~                                                                   >\r\n        // To log out of firebase user account                                         >\r\n        //----------------------------------------------------------------------------->\r\n        logout: function () {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                if (firebase.auth() != null) {\r\n                    firebase.auth().signOut()\r\n                        .then(() => {\r\n                            console.log(\"User logged out correctly of firebase!\");\r\n                            resolve();\r\n                        })\r\n                        .catch(err => {\r\n                            console.error(err);\r\n                            reject(Constants.ERROR_GENERIC_PROBLEM);\r\n                        });\r\n                }\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ sendEmailVerification ~                                                   >\r\n        // To send firebase account email verification                                 >\r\n        //----------------------------------------------------------------------------->\r\n        sendEmailVerification: function () {\r\n            return new Promise(function (resolve, reject) {\r\n                firebase.auth().currentUser.sendEmailVerification().then(function () {\r\n                    console.log('Firebase verification email sent.');\r\n                    resolve();\r\n                }, function (error) {\r\n                    console.error(error);\r\n                    if (error.code == \"auth/too-many-requests\") {\r\n                        reject(Constants.ERROR_TOO_MANY_REQUESTS);\r\n                    } else {\r\n                        reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                    }\r\n\r\n                });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ isEmailVerified ~                                                         >\r\n        // To check if firebase account email is verified                              >\r\n        //----------------------------------------------------------------------------->\r\n        isEmailVerified: function () {\r\n            return new Promise(function (resolve, reject) {\r\n                firebase.auth().currentUser.reload().then(() => {\r\n                    if (firebase.auth().currentUser.emailVerified) {\r\n                        console.log(\"Firebase account email is verified.\");\r\n                        resolve(true);\r\n                    } else {\r\n                        resolve(false);\r\n                    }\r\n                }).catch((error) => {\r\n                    console.error(error);\r\n                    reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ sendPasswordResetEmail ~                                                  >\r\n        // To send firebase account password reset email                               >\r\n        //----------------------------------------------------------------------------->\r\n        sendPasswordResetEmail: function (context, email) {\r\n            return new Promise(function (resolve, reject) {\r\n                firebase.auth().sendPasswordResetEmail(email).then(function () {\r\n                    console.log(\"Password reset email sent.\");\r\n                    resolve();\r\n                }).catch(function (error) {\r\n                    // An error happened.\r\n                    if (error.code == 'auth/user-not-found') {\r\n                        console.log(\"No account attached to the specified email.\");\r\n                        resolve();\r\n                    } else {\r\n                        console.error(error);\r\n                        reject(Constants.ERROR_GENERIC_PROBLEM);\r\n                    }\r\n                });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ updateAccountData ~                                                       >\r\n        // To update user account data name and last name                              >\r\n        // parameters required: data {[name], [lastName], [email]}                     >\r\n        //----------------------------------------------------------------------------->\r\n        updateAccountData: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n                let batch = firestoreDB.batch();\r\n                let docRef = firestoreDB.collection(\"Accounts\").doc(firebase.auth().currentUser.uid);\r\n                let infoToUpdate = false;\r\n\r\n                if (data.hasOwnProperty('name')) {\r\n                    batch.update(docRef, {\"name\": data.name});\r\n                    infoToUpdate = true;\r\n                }\r\n                if (data.hasOwnProperty('lastName')) {\r\n                    batch.update(docRef, {\"lastName\": data.lastName});\r\n                    infoToUpdate = true;\r\n                }\r\n\r\n                if (infoToUpdate) {\r\n                    batch.commit().then(() => {\r\n                        console.log(\"Account info successfully updated in firebase\");\r\n                        resolve();\r\n                    })\r\n                        .catch(function (error) {\r\n                            console.error(error);\r\n                            reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                        });\r\n                } else {\r\n                    resolve();\r\n                }\r\n\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ updateAccountEmail ~                                                      >\r\n        // To update user account email                                                >\r\n        // parameters required: email                                                  >\r\n        //----------------------------------------------------------------------------->\r\n        updateAccountEmail: function (context, email) {\r\n            return new Promise(function (resolve, reject) {\r\n                let user = firebase.auth().currentUser;\r\n\r\n                user.updateEmail(email).then(function () {\r\n                    console.log(\"Account email successfully updated in firebase\");\r\n                    resolve()\r\n                }).catch(function (error) {\r\n                    console.error(error);\r\n                    reject(Constants.ERROR_GENERIC_PROBLEM);\r\n                });\r\n\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ updateAccountPassword ~                                                   >\r\n        // To update user account password                                             >\r\n        // parameters required: password                                               >\r\n        //----------------------------------------------------------------------------->\r\n        updateAccountPassword: function (context, password) {\r\n            return new Promise(function (resolve, reject) {\r\n                let user = firebase.auth().currentUser;\r\n\r\n                user.updatePassword(password).then(function () {\r\n                    console.log(\"Account password successfully updated in firebase\");\r\n                    resolve()\r\n                }).catch(function (error) {\r\n                    console.error(error);\r\n                    reject(Constants.ERROR_GENERIC_PROBLEM);\r\n                });\r\n\r\n            });\r\n        },\r\n\r\n\r\n        /*--------------------------------------------------------------*/\r\n        /*------------------------- PROFILES ---------------------------*/\r\n        /*--------------------------------------------------------------*/\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getProfileByUID ~                                                         >\r\n        // To get an user profile by its uid                                           >\r\n        // parameters required: uid                                                    >\r\n        //----------------------------------------------------------------------------->\r\n        getProfileByUID(context, uid) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                firestoreDB.collection(\"Profiles\").doc(uid).get()\r\n                    .then((doc) => {\r\n                        if (doc.data() != null && doc.data() != undefined) {\r\n                            if (doc.data().hasOwnProperty(\"birthDate\")) {\r\n                                doc.data()[\"birthDate\"] = doc.data()[\"birthDate\"].toDate().setHours(0, 0, 0,);\r\n                            }\r\n                            resolve({\r\n                                id: doc.id,\r\n                                ...doc.data()\r\n                            });\r\n                        } else {\r\n                            resolve(null);\r\n                        }\r\n\r\n                    })\r\n                    .catch((error) => {\r\n                        console.error(error);\r\n                        reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getProfile ~                                                              >\r\n        // To get an user profile by its uid                                           >\r\n        // parameters required: uid                                                    >\r\n        //----------------------------------------------------------------------------->\r\n        getProfile(context) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                context.dispatch('getProfileByUID', firebase.auth().currentUser.uid)\r\n                    .then((profileInfo) => {\r\n                        if (profileInfo && profileInfo.hasOwnProperty(\"birthDate\")) {\r\n                            profileInfo[\"birthDate\"] = profileInfo[\"birthDate\"].toDate().setHours(0, 0, 0,);\r\n                        }\r\n\r\n                        console.log(\"Profile info successfully retrieved from firebase\");\r\n                        resolve(profileInfo);\r\n                    })\r\n                    .catch((error) => {\r\n                        console.error(error);\r\n                        reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getMultipleProfilesByUID ~                                                >\r\n        // To get multiple user profiles by their uids                                 >\r\n        // parameters required: ids[]                                                  >\r\n        // return: userProfiles[]                                                               >\r\n        //----------------------------------------------------------------------------->\r\n        getMultipleProfilesByUID(context, ids) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let promises = [];\r\n                let userProfiles = [];\r\n\r\n                ids.forEach(id => {\r\n                    promises.push(\r\n                        context.dispatch('getProfileByUID', id)\r\n                            .then((profileInfo) => {\r\n                                userProfiles.push({\r\n                                    id: id,\r\n                                    ...profileInfo\r\n                                });\r\n                            })\r\n                            .catch((error) => {\r\n                                console.error(error);\r\n                                reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                            })\r\n                    );\r\n                });\r\n                Promise.all(promises).then(function () {\r\n                    resolve(userProfiles);\r\n                })\r\n            });\r\n        },\r\n\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getProfileByUsername ~                                                    >\r\n        // To get user profile info by its username                                    >\r\n        // parameters required: username                                               >\r\n        //----------------------------------------------------------------------------->\r\n        getProfileByUsername(context, username) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                firestoreDB.collection(\"Profiles\").where(\"username\", \"==\", username).get()\r\n                    .then((querySnapshot) => {\r\n                        if (querySnapshot.size > 0) {\r\n                            console.log(\"Profile info successfully retrieved from firebase\");\r\n                            resolve(querySnapshot.docs);\r\n                        } else {\r\n                            console.log(\"Profile info was not found in firebase\");\r\n                            resolve(null);\r\n                        }\r\n                    })\r\n                    .catch((error) => {\r\n                        console.error(error);\r\n                        reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ setProfile ~                                                              >\r\n        // To set user profile info                                                    >\r\n        // parameters required: data {username, birthDate, gender, description}        >\r\n        //----------------------------------------------------------------------------->\r\n        setProfile: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                firestoreDB.collection(\"Profiles\").doc(firebase.auth().currentUser.uid).set(\r\n                    {\r\n                        username: data.username.toLowerCase(),\r\n                        birthDate: new Date(new Date(data.birthDate).setHours(0, 0, 0,)),\r\n                        gender: data.gender,\r\n                        description: data.description,\r\n                        avgRating: 0,\r\n                        numRatings: 0\r\n                    },\r\n                    {\r\n                        merge: true\r\n                    }\r\n                )\r\n                    .then(() => {\r\n                        console.log(\"Profile info successfully written in firebase\");\r\n                        resolve();\r\n                    })\r\n                    .catch(function (error) {\r\n                        console.error(error);\r\n                        reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ updateProfile ~                                                           >\r\n        // To update user profile info                                                 >\r\n        // parameters required: data {[username], [birthDate], [gender],               >\r\n        //                            [description], [knownLanguages],                 >\r\n        //                            [languagesToLearn]}                              >\r\n        //----------------------------------------------------------------------------->\r\n        updateProfile: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n                let batch = firestoreDB.batch();\r\n                let docRef = firestoreDB.collection(\"Profiles\").doc(firebase.auth().currentUser.uid);\r\n                let infoToUpdate = false;\r\n\r\n                if (data.hasOwnProperty('username')) {\r\n                    batch.update(docRef, {\"username\": data.username});\r\n                    infoToUpdate = true;\r\n                }\r\n                if (data.hasOwnProperty('description')) {\r\n                    batch.update(docRef, {\"description\": data.description});\r\n                    infoToUpdate = true;\r\n                }\r\n                if (data.hasOwnProperty('gender')) {\r\n                    batch.update(docRef, {\"gender\": data.gender});\r\n                    infoToUpdate = true;\r\n                }\r\n                if (data.hasOwnProperty('birthDate')) {\r\n                    batch.update(docRef, {\"birthDate\": new Date(new Date(data.birthDate).setHours(0, 0, 0,))});\r\n                    infoToUpdate = true;\r\n                }\r\n                if (data.hasOwnProperty('knownLanguages')) {\r\n                    batch.update(docRef, {\"knownLanguages\": data.knownLanguages});\r\n                    infoToUpdate = true;\r\n                }\r\n                if (data.hasOwnProperty('languagesToLearn')) {\r\n                    batch.update(docRef, {\"languagesToLearn\": data.languagesToLearn});\r\n                    infoToUpdate = true;\r\n                }\r\n                if (data.hasOwnProperty('profileImg')) {\r\n                    batch.update(docRef, {\"profileImg\": data.profileImg});\r\n                    infoToUpdate = true;\r\n                }\r\n\r\n                if (infoToUpdate) {\r\n                    batch.commit().then(() => {\r\n                        console.log(\"Profile info successfully updated in firebase\");\r\n                        resolve();\r\n                    })\r\n                        .catch(function (error) {\r\n                            console.error(error);\r\n                            reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                        });\r\n                } else {\r\n                    resolve();\r\n                }\r\n\r\n\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ setLanguages ~                                                            >\r\n        // To set user languages: known and to-be-learned                              >\r\n        // parameters required: data {knownLanguages, languagesToLearn}                >\r\n        //----------------------------------------------------------------------------->\r\n        setLanguages: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                firestoreDB.collection(\"Profiles\").doc(firebase.auth().currentUser.uid).set(\r\n                    {\r\n                        knownLanguages: data.knownLanguages,\r\n                        languagesToLearn: data.languagesToLearn,\r\n                    },\r\n                    {\r\n                        merge: true\r\n                    }\r\n                )\r\n                    .then(() => {\r\n                        console.log(\"User languages info successfully written in firebase.\");\r\n                        resolve();\r\n                    })\r\n                    .catch(function (error) {\r\n                        console.error(error);\r\n                        reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ uploadProfileImg ~                                                        >\r\n        // To upload a profile image to firebase storage                               >\r\n        // parameters required: img                                                    >\r\n        //----------------------------------------------------------------------------->\r\n        uploadProfileImg: function (context, img) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let userID = firebase.auth().currentUser.uid;\r\n                let path = \"UserProfileImages/\" + userID;\r\n\r\n                let data = {\r\n                    img: img,\r\n                    path: path\r\n                };\r\n\r\n                context.dispatch('uploadImg', data)\r\n                    .then((url) => {\r\n                        resolve(url);\r\n                    })\r\n                    .catch((error) => {\r\n                        console.error(error);\r\n                        reject(Constants.ERROR_UPLOADING_IMAGE);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ uploadImg ~                                                               >\r\n        // To upload an image to firebase storage                                      >\r\n        // parameters required: data {path, img}                                       >\r\n        //----------------------------------------------------------------------------->\r\n        uploadImg: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                let storageDB = firebase.storage().ref().child(data.path);\r\n                storageDB.putString(data.img, 'base64')\r\n                    .then(() => {\r\n                        storageDB.getDownloadURL().then((url) => {\r\n                            console.log('User profile image uploaded.');\r\n                            resolve(url)\r\n                        })\r\n                            .catch((error) => {\r\n                                console.error(error);\r\n                                reject(Constants.ERROR_UPLOADING_IMAGE);\r\n                            });\r\n                    }).catch(function (error) {\r\n                    console.error(error);\r\n                    reject(Constants.ERROR_UPLOADING_IMAGE);\r\n                });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ setProfileImg ~                                                           >\r\n        // To set user profile image url in firebase profile                           >\r\n        // parameters required: url                                                    >\r\n        //----------------------------------------------------------------------------->\r\n        setProfileImg: function (context, url) {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                firestoreDB.collection(\"Profiles\").doc(firebase.auth().currentUser.uid).set(\r\n                    {\r\n                        profileImg: url\r\n                    },\r\n                    {merge: true}\r\n                )\r\n                    .then(() => {\r\n                        console.log(\"User profile image successfully written in firebase.\");\r\n                        resolve();\r\n                    })\r\n                    .catch(function (error) {\r\n                        console.error(error);\r\n                        reject(Constants.ERROR_UPLOADING_IMAGE);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ updateUserLocation ~                                                      >\r\n        // To update user location in firebase using GeoFirestore library              >\r\n        // parameters required: location{lat, lng}                                     >\r\n        //----------------------------------------------------------------------------->\r\n        updateUserLocation: function (context, location) {\r\n            let geoFirestore = new GeoFirestore(firebase.firestore());\r\n\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                geoFirestore.collection('UserLocations').doc(firebase.auth().currentUser.uid).set({\r\n                    coordinates: new firebase.firestore.GeoPoint(location.lat, location.lng),\r\n                    date: new Date()\r\n                }).then(function () {\r\n                    console.log(\"User location successfully written in firebase.\");\r\n                    resolve();\r\n                }).catch((error) => {\r\n                    console.log(error);\r\n                    reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getLocation ~                                                             >\r\n        // To get user location                                                        >\r\n        //----------------------------------------------------------------------------->\r\n        getLocation: function () {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                firestoreDB.collection(\"UserLocations\").doc(firebase.auth().currentUser.uid).get()\r\n                    .then((doc) => {\r\n                        console.log(\"User location successfully retrieved from firebase.\");\r\n                        let location = {\r\n                            lat: doc.data().l[0],\r\n                            lng: doc.data().l[1]\r\n                        };\r\n                        resolve(location);\r\n                    })\r\n                    .catch((error) => {\r\n                        console.error(error);\r\n                        reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n\r\n\r\n        /*--------------------------------------------------------------*/\r\n        /*------------------------  RATINGS ----------------------------*/\r\n        /*--------------------------------------------------------------*/\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getRatings ~                                                              >\r\n        // To get user ratings given by the logged user                                >\r\n        // return: ratingsInfo/null                                                    >\r\n        //----------------------------------------------------------------------------->\r\n        getRatings: function () {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                firestoreDB.collection(\"Ratings\").doc(firebase.auth().currentUser.uid).get().then(function (doc) {\r\n                    console.log(\"User ratings successfully retrieved from firebase.\");\r\n\r\n\r\n                    if (doc.exists) {\r\n                        resolve(doc.data());\r\n                    } else {\r\n                        resolve(null);\r\n                    }\r\n                })\r\n                    .catch(function (error) {\r\n                        console.error(error);\r\n                        reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ setRating ~                                                              >\r\n        // To set user rating given by the logged user                                 >\r\n        // parameters: data{id, rating}                                                >\r\n        //----------------------------------------------------------------------------->\r\n        setRating: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n                let newRating = {};\r\n\r\n                newRating[data.id] = data.rating;\r\n                if (data.rating) {\r\n                    firestoreDB.collection(\"Ratings\").doc(firebase.auth().currentUser.uid).set(newRating, {merge: true})\r\n                        .then(() => {\r\n                            console.log(\"Rating successfully written in firebase.\");\r\n                            resolve();\r\n                        })\r\n                        .catch(function (error) {\r\n                            console.error(error);\r\n                            reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                        });\r\n                } else {\r\n                    firestoreDB.collection(\"Ratings\").doc(firebase.auth().currentUser.uid).update({\r\n                        [data.id]: firebase.firestore.FieldValue.delete()\r\n                    })\r\n                        .then(() => {\r\n                            console.log(\"Rating successfully deleted in firebase.\");\r\n                            resolve();\r\n                        })\r\n                        .catch(function (error) {\r\n                            console.error(error);\r\n                            reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                        });\r\n                }\r\n            });\r\n        },\r\n\r\n        /*--------------------------------------------------------------*/\r\n        /*-------------------------  SEARCH ----------------------------*/\r\n        /*--------------------------------------------------------------*/\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ isNextUsersPageEmpty ~                                                    >\r\n        // To check that if we search users with pagination, next page won't be empty  >\r\n        // parameters required: data{lastUserShowed, limit, filters}                   >\r\n        // return: true/false                                                          >\r\n        //----------------------------------------------------------------------------->\r\n        isNextUsersPageEmpty: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let firestoreDB = firebase.firestore();\r\n                let geoFirestore = new GeoFirestore(firestoreDB);\r\n                let page;\r\n                let lastUserShowed = data.lastUserShowed;\r\n                let newLastUserShowed;\r\n\r\n                page = firestoreDB.collection(\"Profiles\");\r\n\r\n                // --> USERNAME FILTERING\r\n                if (data.filters.username != null && data.filters.username != undefined && data.filters.username != '') {\r\n                    if (lastUserShowed == null) {\r\n                        lastUserShowed = data.filters.username;\r\n                    }\r\n                }\r\n                // --> GENDER FILTERING\r\n                if (data.filters.gender === \"M\") {\r\n                    page = page.where(\"gender\", \"==\", \"M\");\r\n                    //console.log(\"Filtering by gender: M.\");\r\n                } else if (data.filters.gender === \"W\") {\r\n                    page = page.where(\"gender\", \"==\", \"W\");\r\n                    //console.log(\"Filtering by gender: W.\");\r\n                }\r\n                // --> END GENDER FILTERING\r\n\r\n                // --> AGE FILTERING\r\n                if (data.filters.ageRange[0] > Constants.MIN_USER_AGE || data.filters.ageRange[1] < Constants.MAX_USER_AGE) {\r\n                    page = page.orderBy(\"birthDate\");\r\n                }\r\n\r\n                if (data.filters.ageRange[0] > Constants.MIN_USER_AGE) {\r\n                    let currentDate = new Date();\r\n                    currentDate.setFullYear(currentDate.getFullYear() - data.filters.ageRange[0]);\r\n                    currentDate.setHours(0, 0, 0);\r\n                    page = page.where(\"birthDate\", \"<\", currentDate);\r\n                    //console.log(\"Filtering by min age.\");\r\n                }\r\n\r\n                if (data.filters.ageRange[1] < Constants.MAX_USER_AGE) {\r\n                    let currentDate = new Date();\r\n                    currentDate.setFullYear(currentDate.getFullYear() - data.filters.ageRange[1] - 1);\r\n                    currentDate.setHours(0, 0, 0)\r\n                    page = page.where(\"birthDate\", \">\", currentDate);\r\n\r\n                    //console.log(\"Filtering by max age.\");\r\n                }\r\n                // --> END AGE FILTERING\r\n\r\n                // --> LANGUAGES FILTERING\r\n                if (data.filters.language.filterBy == \"languageToLearn\" && data.filters.language.languageToLearn != \"all\") {\r\n                    page = page.where(\"languagesToLearn\", \"array-contains\", data.filters.language.languageToLearn);\r\n                    //console.log(\"Filtering by languageToLearn: \" + data.filters.language.languageToLearn + \".\");\r\n                } else if (data.filters.language.filterBy == \"knownLanguage\" && data.filters.language.knownLanguage != \"all\") {\r\n                    page = page.where(\"knownLanguages\", \"array-contains\", data.filters.language.knownLanguage);\r\n                    //console.log(\"Filtering by knownLanguage: \" + data.filters.language.knownLanguage + \".\");\r\n                }\r\n                // --> END LANGUAGES FILTERING\r\n\r\n                if (data.filters.username != null && data.filters.username != undefined && data.filters.username != '') {\r\n                    page = page.orderBy(\"username\").startAfter(lastUserShowed).endAt(data.filters.username + \"\\uf8ff\").limit(data.limit);\r\n                } else {\r\n                    page = page.orderBy(\"username\").startAfter(lastUserShowed).limit(data.limit);\r\n                }\r\n\r\n                page.get()\r\n                    .then(function (documentSnapshots) {\r\n\r\n                        // To remove the logged user\r\n                        let searchedUserIndex = documentSnapshots.docs.findIndex(function (searchedUser) {\r\n                            return searchedUser.id == firebase.auth().currentUser.uid;\r\n                        });\r\n\r\n                        let newDocs = documentSnapshots.docs;\r\n                        if (searchedUserIndex != -1) {\r\n                            newDocs.splice(searchedUserIndex, 1);\r\n                        }\r\n\r\n\r\n                        newDocs = newDocs.map(doc => {\r\n                            const id = doc.id;\r\n                            const dataDocs = doc.data();\r\n                            return {id, ...dataDocs};\r\n                        });\r\n\r\n                        resolve(newDocs.length == 0);\r\n\r\n                    }).catch((error) => {\r\n                    console.log(error);\r\n                    reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getNextUsersPage ~                                                        >\r\n        // To get search users with pagination                                         >\r\n        // parameters required: data{lastUserShowed, limit, filters}                   >\r\n        // return: {newLastUserShowed, users}                                          >\r\n        //----------------------------------------------------------------------------->\r\n        getNextUsersPage: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let firestoreDB = firebase.firestore();\r\n                let geoFirestore = new GeoFirestore(firestoreDB);\r\n                let page;\r\n                let newLastUserShowed;\r\n                let lastUserShowed = data.lastUserShowed;\r\n\r\n                page = firestoreDB.collection(\"Profiles\");\r\n\r\n                // --> USERNAME FILTERING\r\n                if (data.filters.username != null && data.filters.username != undefined && data.filters.username != '') {\r\n                    if (lastUserShowed == null) {\r\n                        lastUserShowed = data.filters.username;\r\n                    }\r\n                }\r\n                // --> END USERNAME FILTERING\r\n\r\n                // --> GENDER FILTERING\r\n                if (data.filters.gender === \"M\") {\r\n                    page = page.where(\"gender\", \"==\", \"M\");\r\n                    //console.log(\"Filtering by gender: M.\");\r\n                } else if (data.filters.gender === \"W\") {\r\n                    page = page.where(\"gender\", \"==\", \"W\");\r\n                    //console.log(\"Filtering by gender: W.\");\r\n                }\r\n                // --> END GENDER FILTERING\r\n\r\n                // --> AGE FILTERING\r\n                if (data.filters.ageRange[0] > Constants.MIN_USER_AGE || data.filters.ageRange[1] < Constants.MAX_USER_AGE) {\r\n                    page = page.orderBy(\"birthDate\");\r\n                }\r\n\r\n                if (data.filters.ageRange[0] > Constants.MIN_USER_AGE) {\r\n                    let currentDate = new Date();\r\n                    currentDate.setFullYear(currentDate.getFullYear() - data.filters.ageRange[0]);\r\n                    currentDate.setHours(0, 0, 0);\r\n                    page = page.where(\"birthDate\", \"<\", currentDate);\r\n                    //console.log(\"Filtering by min age.\");\r\n                }\r\n\r\n                if (data.filters.ageRange[1] < Constants.MAX_USER_AGE) {\r\n                    let currentDate = new Date();\r\n                    currentDate.setFullYear(currentDate.getFullYear() - data.filters.ageRange[1] - 1);\r\n                    currentDate.setHours(0, 0, 0)\r\n                    page = page.where(\"birthDate\", \">\", currentDate);\r\n\r\n                    //console.log(\"Filtering by max age.\");\r\n                }\r\n                // --> END AGE FILTERING\r\n\r\n                // --> LANGUAGES FILTERING\r\n                if (data.filters.language.filterBy == \"languageToLearn\" && data.filters.language.languageToLearn != \"all\") {\r\n                    page = page.where(\"languagesToLearn\", \"array-contains\", data.filters.language.languageToLearn);\r\n                    //console.log(\"Filtering by languageToLearn: \" + data.filters.language.languageToLearn + \".\");\r\n                } else if (data.filters.language.filterBy == \"knownLanguage\" && data.filters.language.knownLanguage != \"all\") {\r\n                    page = page.where(\"knownLanguages\", \"array-contains\", data.filters.language.knownLanguage);\r\n                    //console.log(\"Filtering by knownLanguage: \" + data.filters.language.knownLanguage + \".\");\r\n                }\r\n                // --> END LANGUAGES FILTERING\r\n\r\n\r\n                if (data.lastUserShowed == null && data.filters.username != null && data.filters.username != undefined && data.filters.username != '') {\r\n                    page = page.orderBy(\"username\").startAt(lastUserShowed).endAt(data.filters.username + \"\\uf8ff\").limit(data.limit);\r\n                } else if (data.lastUserShowed != null && data.filters.username != null && data.filters.username != undefined && data.filters.username != '') {\r\n                    page = page.orderBy(\"username\").startAfter(lastUserShowed).endAt(data.filters.username + \"\\uf8ff\").limit(data.limit);\r\n                } else {\r\n                    page = page.orderBy(\"username\").startAfter(lastUserShowed).limit(data.limit);\r\n                }\r\n\r\n                page.get()\r\n                    .then(function (documentSnapshots) {\r\n\r\n                        // To remove the logged user\r\n                        let searchedUserIndex = documentSnapshots.docs.findIndex(function (searchedUser) {\r\n                            return searchedUser.id == firebase.auth().currentUser.uid;\r\n                        });\r\n\r\n                        let newDocs = documentSnapshots.docs;\r\n\r\n                        if (searchedUserIndex != -1) {\r\n                            newDocs.splice(searchedUserIndex, 1);\r\n                        }\r\n                        newLastUserShowed = documentSnapshots.docs[documentSnapshots.docs.length - 1];\r\n\r\n                        newDocs = newDocs.map(doc => {\r\n                            const id = doc.id;\r\n                            const dataDocs = doc.data();\r\n                            return {id, ...dataDocs};\r\n                        });\r\n\r\n\r\n                        resolve({\r\n                            newLastUserShowed: newLastUserShowed,\r\n                            users: newDocs\r\n                        });\r\n\r\n\r\n                    }).catch((error) => {\r\n                    console.log(error);\r\n                    reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getNearbyUserIDs ~                                                        >\r\n        // To get IDs of nearby users                                                  >\r\n        // parameters required: data{location, maxDistance}                            >\r\n        // return: ids[]                                                               >\r\n        //----------------------------------------------------------------------------->\r\n        getNearbyUserIDs(context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                let geofirestore = new GeoFirestore(firebase.firestore());\r\n                let queryNearbyUsers = geofirestore.collection('UserLocations').near({\r\n                    center: new firebase.firestore.GeoPoint(data.location.lat, data.location.lng),\r\n                    radius: data.maxDistance\r\n                });\r\n\r\n\r\n                queryNearbyUsers.get().then((snapshot) => {\r\n                    let ids = [];\r\n                    snapshot.docs.forEach(doc => {\r\n                        if (doc.id != firebase.auth().currentUser.uid)\r\n                            ids.push(doc.id);\r\n                    });\r\n                    resolve(ids);\r\n                }).catch((error) => {\r\n                    console.log(error);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                });\r\n            });\r\n        }\r\n        ,\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getUsersWithSimilarUsername ~                                             >\r\n        // To get profiles of users which username starts with the one passed as a     >\r\n        // parameter.                                                                  >\r\n        // parameters required: username                                               >\r\n        // return: userProfiles[]                                                      >\r\n        //----------------------------------------------------------------------------->\r\n        getUsersWithSimilarUsername(context, username) {\r\n            return new Promise(function (resolve, reject) {\r\n                let geofirestore = new GeoFirestore(firebase.firestore());\r\n                let queryNearbyUsers = geofirestore.collection('UserLocations').near({\r\n                    center: new firebase.firestore.GeoPoint(data.location.lat, data.location.lng),\r\n                    radius: data.maxDistance\r\n                });\r\n\r\n\r\n                queryNearbyUsers.get().then((snapshot) => {\r\n                    let ids = [];\r\n                    snapshot.docs.forEach(doc => {\r\n                        if (doc.id != firebase.auth().currentUser.uid)\r\n                            ids.push(doc.id);\r\n                    });\r\n                    resolve(ids);\r\n                }).catch((error) => {\r\n                    console.log(error);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n\r\n\r\n        /*--------------------------------------------------------------*/\r\n        /*-------------------------- EVENTS ----------------------------*/\r\n        /*--------------------------------------------------------------*/\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getEventByID ~                                                            >\r\n        // To get an event by its id                                                   >\r\n        // parameters required: id                                                     >\r\n        //----------------------------------------------------------------------------->\r\n        getEventByID(context, id) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                firestoreDB.collection(\"Events\").doc(id).get()\r\n                    .then((doc) => {\r\n\r\n                        if (doc.data() != null && doc.data() != undefined) {\r\n                            resolve({\r\n                                id: doc.id,\r\n                                ...doc.data()\r\n                            });\r\n                        } else {\r\n                            resolve(null);\r\n                        }\r\n\r\n                    })\r\n                    .catch((error) => {\r\n                        console.error(error);\r\n                        reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getNextEventsPage ~                                                       >\r\n        // To get events with pagination                                               >\r\n        // parameters required: data{lastEventShowed, limit}                           >\r\n        // return: {newLastEventShowed, events}                                        >\r\n        //----------------------------------------------------------------------------->\r\n        getNextEventsPage: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let firestoreDB = firebase.firestore();\r\n                let page;\r\n                let newLastEventShowed;\r\n                let lastEventShowed = data.lastEventShowed;\r\n                let currentDate = new Date();\r\n\r\n                page = firestoreDB.collection(\"Events\");\r\n                if (lastEventShowed == null) {\r\n                    page = page.where(\"date\", \">\", currentDate).orderBy(\"date\").startAt(lastEventShowed);\r\n                } else {\r\n                    page = page.where(\"date\", \">\", currentDate).orderBy(\"date\").startAfter(lastEventShowed);\r\n                }\r\n                page.limit(data.limit).get()\r\n                    .then(function (documentSnapshots) {\r\n\r\n                        newLastEventShowed = documentSnapshots.docs[documentSnapshots.docs.length - 1];\r\n\r\n                        let eventsRetrieved = documentSnapshots.docs.map(doc => {\r\n                            const id = doc.id;\r\n                            const dataDocs = doc.data();\r\n                            return {id, ...dataDocs};\r\n                        });\r\n\r\n                        resolve({\r\n                            newLastEventShowed: newLastEventShowed,\r\n                            events: eventsRetrieved\r\n                        });\r\n\r\n\r\n                    }).catch((error) => {\r\n                    console.log(error);\r\n                    reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ isNextEventsPageEmpty ~                                                   >\r\n        // To check if next page of events is empty                                    >\r\n        // parameters required: data{lastEventShowed, limit}                           >\r\n        // return: true/false                                                          >\r\n        //----------------------------------------------------------------------------->\r\n        isNextEventsPageEmpty: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let firestoreDB = firebase.firestore();\r\n                let page;\r\n                let newLastEventShowed;\r\n                let lastEventShowed = data.lastEventShowed;\r\n                let currentDate = new Date();\r\n\r\n                page = firestoreDB.collection(\"Events\");\r\n                page = page.where(\"date\", \">\", currentDate).orderBy(\"date\").startAfter(lastEventShowed);\r\n                page.limit(data.limit).get()\r\n                    .then(function (documentSnapshots) {\r\n\r\n                        resolve(documentSnapshots.docs.length == 0);\r\n\r\n                    }).catch((error) => {\r\n                    console.log(error);\r\n                    reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ addParticipantToEvent ~                                                   >\r\n        // To add the logged user to an Event                                          >\r\n        // parameters required: eventID                                                >\r\n        //----------------------------------------------------------------------------->\r\n        addParticipantToEvent: function (context, eventID) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                firestoreDB.collection(\"Events\").doc(eventID).update({\r\n                    participants: firebase.firestore.FieldValue.arrayUnion(firebase.auth().currentUser.uid)\r\n                }).then(function (documentSnapshots) {\r\n                    console.log(\"User successfully added to event in firebase.\")\r\n                    resolve(firebase.auth().currentUser.uid);\r\n                }).catch((error) => {\r\n                    console.log(error);\r\n                    reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ removeParticipantFromEvent ~                                              >\r\n        // To remove the logged user from an Event                                     >\r\n        // parameters required: eventID                                                >\r\n        // return: userID                                                              >\r\n        //----------------------------------------------------------------------------->\r\n        removeParticipantFromEvent: function (context, eventID) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                firestoreDB.collection(\"Events\").doc(eventID).update({\r\n                    participants: firebase.firestore.FieldValue.arrayRemove(firebase.auth().currentUser.uid)\r\n                }).then(function (documentSnapshots) {\r\n                    console.log(\"User successfully remove from event in firebase.\")\r\n                    resolve(firebase.auth().currentUser.uid);\r\n                }).catch((error) => {\r\n                    console.log(error);\r\n                    reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n\r\n\r\n        /*--------------------------------------------------------------*/\r\n        /*--------------------------  CHATS ----------------------------*/\r\n        /*--------------------------------------------------------------*/\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ createChatMessagesListener ~                                              >\r\n        // To create a listener for chat messages by chat id                           >\r\n        // parameters required: chatID                                                 >\r\n        // return: messages                                                            >\r\n        //----------------------------------------------------------------------------->\r\n        createChatMessagesListener: function (context, chatID) {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                try {\r\n                    let docRef = firestoreDB.collection(\"Chats\").doc(chatID).collection(\"Messages\")\r\n                        .onSnapshot(function (chatMessages) {\r\n\r\n                            let messages = chatMessages.docChanges().map(change => {\r\n                                const id = change.doc.id;\r\n                                const dataDocs = change.doc.data();\r\n                                return {id, change: change.type, ...dataDocs};\r\n                            });\r\n\r\n                            let formattedChatMessages = {\r\n                                id: chatID,\r\n                                messages: messages,\r\n                                listener: docRef\r\n                            };\r\n                            context.dispatch(\"chats/manageChatMessagesChange\", formattedChatMessages, {root: true}).then(() => {\r\n                                resolve();\r\n                            })\r\n\r\n                        })\r\n                } catch (e) {\r\n                    console.error(e);\r\n                    reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                }\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ setMessagesToRead ~                                                       >\r\n        // To set messages unread in chat to read state                                >\r\n        // parameters required: chatID                                                 >\r\n        //----------------------------------------------------------------------------->\r\n        setMessagesToRead(context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n                let promises = [];\r\n\r\n                let batch = firestoreDB.batch();\r\n\r\n                data.messages.forEach(message => {\r\n                    batch.update(firestoreDB.collection(\"Chats\").doc(data.chatID).collection(\"Messages\").doc(message),\r\n                        {\r\n                            'read': true\r\n                        });\r\n                });\r\n\r\n                batch.commit().then(function () {\r\n                    resolve();\r\n                })\r\n                    .catch(function (error) {\r\n                        reject(error);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ addMessagesToChat ~                                                       >\r\n        // To add a new message to a chat in firebase                                  >\r\n        // parameters required: chatID                                                 >\r\n        //----------------------------------------------------------------------------->\r\n        addMessagesToChat(context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                let newMessage = {\r\n                    date: firebase.firestore.FieldValue.serverTimestamp(),\r\n                    sender: data.message.sender,\r\n                    read: false,\r\n                    text: data.message.text,\r\n                };\r\n\r\n                firestoreDB.collection(\"Chats\").doc(data.chatID).collection(\"Messages\").doc().set(newMessage)\r\n                    .then(() => {\r\n                        resolve();\r\n                    })\r\n                    .catch(function (error) {\r\n                        console.error(\"Error adding message\", error);\r\n                        reject(Constants.ERROR_GENERIC_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ addChat ~                                                                 >\r\n        // To create a new chat and add it to the user chat list                       >\r\n        // parameters required: chat{id, users[]}                                      >\r\n        //----------------------------------------------------------------------------->\r\n        addChat(context, chat) {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                let newChat = {\r\n                    users: chat.users,\r\n                };\r\n\r\n                firestoreDB.collection(\"Chats\").doc(chat.id).set(newChat)\r\n                    .then(() => {\r\n                        firestoreDB.collection(\"Accounts\").doc(firebase.auth().currentUser.uid).update({chats: firebase.firestore.FieldValue.arrayUnion(chat.id)})\r\n                            .then(() => {\r\n                                resolve();\r\n                            });\r\n                    })\r\n                    .catch(function (error) {\r\n                        console.error(\"Error adding chat\", error);\r\n                        reject(Constants.ERROR_GENERIC_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getChatByID ~                                                             >\r\n        // To get a chat by its id                                                     >\r\n        // parameters required: chatID                                                 >\r\n        //----------------------------------------------------------------------------->\r\n        getChatByID(context, chatID) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                firestoreDB.collection(\"Chats\").doc(chatID).get()\r\n                    .then((doc) => {\r\n                        resolve({\r\n                            id: doc.id,\r\n                            ...doc.data()\r\n                        });\r\n\r\n                    })\r\n                    .catch((error) => {\r\n                        console.error(error);\r\n                        reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n\r\n\r\n        /*--------------------------------------------------------------*/\r\n        /*-------------------------- RANKING ---------------------------*/\r\n        /*--------------------------------------------------------------*/\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getTop100RankingUsers ~                                                   >\r\n        // To get the top 100 ranked users in the app                                  >\r\n        //----------------------------------------------------------------------------->\r\n        getTop100RankingUsers: function () {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let firestoreDB = firebase.firestore();\r\n                let page = firestoreDB.collection(\"Ranking\");\r\n                page = page.orderBy(\"position\").limit(Constants.MAX_RANKING_PAGE_SIZE);\r\n                page.get()\r\n                    .then(function (documentSnapshots) {\r\n                        let newDocs = documentSnapshots.docs.map(doc => {\r\n                            const position = doc.id;\r\n                            const dataDocs = doc.data();\r\n                            return {position: position, ...dataDocs};\r\n                        });\r\n\r\n                        resolve(newDocs);\r\n\r\n                    }).catch((error) => {\r\n                    console.log(error);\r\n                    reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getUserRankingPositionByID ~                                              >\r\n        // To get user position in app ranking                                         >\r\n        // parameters required: userID                                                 >\r\n        //----------------------------------------------------------------------------->\r\n        getUserRankingPositionByID: function (context, userID) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let firestoreDB = firebase.firestore();\r\n                firestoreDB.collection(\"Ranking\").where(\"id\", \"==\", userID).get()\r\n                    .then(function (documentSnapshots) {\r\n                        let newDocs = documentSnapshots.docs.map(doc => {\r\n                            const position = doc.id;\r\n                            const dataDocs = doc.data();\r\n                            return {position: position, ...dataDocs};\r\n                        });\r\n\r\n                        if (newDocs.length > 1 || newDocs.length < 1) {\r\n                            resolve(null);\r\n                        } else {\r\n                            resolve(newDocs[0]);\r\n                        }\r\n\r\n                    }).catch((error) => {\r\n                    console.log(error);\r\n                    reject(Constants.ERROR_GENERIC_DATABASE_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n\r\n    },\r\n\r\n}","import Vue from 'vue'\r\nimport Vuex from 'vuex'\r\n\r\nVue.use(Vuex);\r\n\r\nimport Constants from \"../Constants\";\r\nimport AuxMethods from \"../AuxMethods\";\r\nimport database from \"./database\";\r\n\r\n////////////////////////////////////////////////////////\r\n//-----        APP PERMISSIONS MANAGEMENT        -----//\r\n////////////////////////////////////////////////////////\r\n\r\nexport default {\r\n    namespaced: true,\r\n    modules: {\r\n        database\r\n    },\r\n    state: {\r\n        isGeolocationPermissionGranted: false,\r\n        isPushNotificationPermissionGranted: false,\r\n    },\r\n    getters: {\r\n        getIsGeolocationPermissionGranted: (state) => {\r\n            return state.isGeolocationPermissionGranted;\r\n        },\r\n        getIsPushNotificationPermissionGranted: (state) => {\r\n            return state.isPushNotificationPermissionGranted;\r\n        },\r\n    },\r\n    mutations: {\r\n        resetState(state) {\r\n            state.isGeolocationPermissionGranted = false;\r\n            state.isPushNotificationPermissionGranted = false;\r\n        },\r\n        setIsGeolocationPermissionGranted(state, isGeolocationPermissionGranted) {\r\n            state.isGeolocationPermissionGranted = isGeolocationPermissionGranted;\r\n        },\r\n        setIsPushNotificationPermissionGranted(state, isPushNotificationPermissionGranted) {\r\n            state.isPushNotificationPermissionGranted = isPushNotificationPermissionGranted;\r\n        },\r\n    },\r\n    actions: {\r\n        //----------------------------------------------------------------------------->\r\n        // ~ resetState ~                                                              >\r\n        // To reset state info                                                         >\r\n        //----------------------------------------------------------------------------->\r\n        resetState(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.commit('resetState');\r\n                resolve();\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ checkForGeolocationPermission ~                                           >\r\n        // To check if geolocation permission has been granted by the user             >\r\n        //----------------------------------------------------------------------------->\r\n        checkForGeolocationPermission: function (context) {\r\n            return new Promise(function (resolve, reject) {\r\n                navigator.permissions.query({name: 'geolocation'}).then(function (result) {\r\n                    if (result.state == 'granted') {\r\n                        // Permission is already granted\r\n                        context.commit(\"setIsGeolocationPermissionGranted\", true);\r\n\r\n                        context.dispatch(\"user/getLocation\", {root: true}).catch((error) => {\r\n                            reject(error);\r\n                        });\r\n\r\n                        resolve(true);\r\n                    } else if (result.state == 'prompt') {\r\n                        // Navigator will ask for permission\r\n                        context.commit(\"setIsGeolocationPermissionGranted\", false);\r\n                        navigator.geolocation.getCurrentPosition(AuxMethods.emptyCallback);\r\n                    } else if (result.state == 'denied') {\r\n                        // User has denied permission\r\n                        context.commit(\"setIsGeolocationPermissionGranted\", false);\r\n                        resolve(false);\r\n                    }\r\n\r\n                    result.onchange = function () {\r\n                        // Whenever permission state changes\r\n\r\n                        if (result.state == 'granted') {\r\n                            // Permission is already granted\r\n                            context.commit(\"setIsGeolocationPermissionGranted\", true);\r\n\r\n                            context.dispatch(\"user/getLocation\", null, {root: true}).catch((error) => {\r\n                                reject(error);\r\n                            });\r\n\r\n                            resolve(true);\r\n                        } else if (result.state == 'prompt') {\r\n                            // Navigator will ask for permission\r\n                            context.commit(\"setIsGeolocationPermissionGranted\", false);\r\n                            navigator.geolocation.getCurrentPosition(AuxMethods.emptyCallback);\r\n\r\n                        } else if (result.state == 'denied') {\r\n                            // User has denied permission\r\n                            context.commit(\"setIsGeolocationPermissionGranted\", false);\r\n                            resolve(false);\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ checkForPushNotificationsPermission ~                                     >\r\n        // To check if push notifications permission has been granted by the user      >\r\n        //----------------------------------------------------------------------------->\r\n        checkForPushNotificationsPermission: function (context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch(\"database/askForMessagingPermission\").then(function (isPermissionGranted) {\r\n                    if (isPermissionGranted) {\r\n                        context.commit(\"setIsPushNotificationPermissionGranted\", true);\r\n                        context.dispatch('user/generateNotificationToken', null, {root: true}).catch((error) => {\r\n                            reject(error);\r\n                        });\r\n                        resolve(true);\r\n                    } else{\r\n                        context.commit(\"setIsPushNotificationPermissionGranted\", false);\r\n                        resolve(false);\r\n                    }\r\n                });\r\n            });\r\n        },\r\n    }\r\n}","import Vue from 'vue'\r\nimport Vuex from 'vuex'\r\n\r\nVue.use(Vuex);\r\n\r\nimport Constants from \"../Constants\";\r\nimport database from \"./database\";\r\nimport permissions from \"./permissions\";\r\n\r\n////////////////////////////////////////////////////////\r\n//-----                APP USERS                 -----//\r\n////////////////////////////////////////////////////////\r\n\r\nexport default {\r\n    namespaced: true,\r\n    modules: {\r\n        database,\r\n        permissions\r\n    },\r\n    state: {\r\n        /* All users retrieved */\r\n        users: {},\r\n\r\n        /* User IDs result of the searching process */\r\n        searchedUsersIDs: [],\r\n        lastUserShowed: null,\r\n        genderFilter: \"O\",\r\n        ageRangeFilter: [Constants.MIN_USER_AGE, Constants.MAX_USER_AGE],\r\n        languageFilter: {\r\n            filterBy: \"languageToLearn\",\r\n            knownLanguage: \"all\",\r\n            languageToLearn: \"all\"\r\n        },\r\n        searchByUsernameFilter: null,\r\n        maxDistanceFilter: 3,\r\n        maxDistanceRanges: [1000, 5000, 10000, null],\r\n        maxDistanceRangesText: [Constants.TEXT_1_KM, Constants.TEXT_5_KM, Constants.TEXT_10_KM, '∞'],\r\n        locationFilter: null,\r\n        nearbyUsersIDs: null,\r\n\r\n        /* Filtering fields */\r\n        distanceSearchFilter: null,\r\n    },\r\n    getters: {\r\n\r\n        getUsers: (state) => {\r\n            return state.users;\r\n        },\r\n\r\n        getGenderFilter: (state) => {\r\n            return state.genderFilter;\r\n        },\r\n        getAgeRangeFilter: (state) => {\r\n            return state.ageRangeFilter;\r\n        },\r\n        getLanguageFilter: (state) => {\r\n            return state.languageFilter;\r\n        },\r\n        getSearchByUsernameFilter: (state) => {\r\n            return state.searchByUsernameFilter;\r\n        },\r\n        getMaxDistanceFilter: (state) => {\r\n            return state.maxDistanceFilter;\r\n        },\r\n        getMaxDistanceRanges: (state) => {\r\n            return state.maxDistanceRanges;\r\n        },\r\n        getMaxDistanceRangesText: (state) => {\r\n            return state.maxDistanceRangesText;\r\n        },\r\n        getUserByID: (state) => (id) => {\r\n            return state.users[id];\r\n        },\r\n        getNearbyUsersIDs: (state) => {\r\n            return state.nearbyUsersIDs;\r\n        },\r\n        getNearbyUsersIDsLength: (state) => {\r\n            return state.nearbyUsersIDs.length;\r\n        },\r\n        areThereFiltersOn: (state, getters) => {\r\n            let filters = getters.getFilters;\r\n            let filtersOn = false;\r\n\r\n            if (filters.gender === \"M\" || filters.gender === \"W\"\r\n                || filters.ageRange[0] > Constants.MIN_USER_AGE\r\n                || filters.ageRange[1] < Constants.MAX_USER_AGE\r\n                || (filters.language.filterBy == \"languageToLearn\" && filters.language.languageToLearn != \"all\")\r\n                || (filters.language.filterBy == \"knownLanguage\" && filters.language.knownLanguage != \"all\")\r\n                || filters.maxDistance != null) {\r\n                filtersOn = true;\r\n            }\r\n\r\n            return filtersOn;\r\n        },\r\n        getFilters: (state) => {\r\n            return {\r\n                gender: state.genderFilter,\r\n                ageRange: state.ageRangeFilter,\r\n                language: state.languageFilter,\r\n                maxDistance: state.maxDistanceRanges[state.maxDistanceFilter],\r\n                location: state.locationFilter,\r\n                username: state.searchByUsernameFilter\r\n            };\r\n        },\r\n        getLastUserShowed: (state) => {\r\n            return state.lastUserShowed;\r\n        },\r\n        getSearchedUsers: (state) => {\r\n\r\n            let searchedUsersReturn = [];\r\n\r\n            state.searchedUsersIDs.forEach(userID => {\r\n                searchedUsersReturn.push({\r\n                    id: userID,\r\n                    ...state.users[userID]\r\n                });\r\n            });\r\n\r\n            return searchedUsersReturn;\r\n        },\r\n        getSearchedUsersIDsLength: (state) => {\r\n            return state.searchedUsersIDs.length;\r\n        },\r\n        getSearchedUsersIDs: (state) => {\r\n            return state.searchedUsersIDs;\r\n        },\r\n\r\n    },\r\n    mutations: {\r\n        resetState(state) {\r\n            /* All users retrieved */\r\n            state.users = {};\r\n\r\n            /* User IDs result of the searching process */\r\n            state.searchedUsersIDs = [];\r\n            state.lastUserShowed = null;\r\n            state.genderFilter = \"O\";\r\n            state.ageRangeFilter = [Constants.MIN_USER_AGE, Constants.MAX_USER_AGE];\r\n            state.languageFilter = {\r\n                filterBy: \"languageToLearn\",\r\n                knownLanguage: \"all\",\r\n                languageToLearn: \"all\"\r\n            };\r\n            state.searchByUsernameFilter = null;\r\n            state.maxDistanceFilter = 3;\r\n            state.maxDistanceRanges = [1000, 5000, 10000, null];\r\n            state.maxDistanceRangesText = [Constants.TEXT_1_KM, Constants.TEXT_5_KM, Constants.TEXT_10_KM, '∞'];\r\n            state.locationFilter = null;\r\n            state.nearbyUsersIDs = null;\r\n\r\n            /* Filtering fields */\r\n            state.distanceSearchFilter = null;\r\n        },\r\n        setUsers(state, users) {\r\n            state.users = users;\r\n        },\r\n        setGenderFilter: (state, genderFilter) => {\r\n            state.genderFilter = genderFilter;\r\n        },\r\n        setAgeRangeFilter: (state, ageRangeFilter) => {\r\n            state.ageRangeFilter = ageRangeFilter;\r\n        },\r\n        setNearbyUsersIDs: (state, nearbyUsersIDs) => {\r\n            state.nearbyUsersIDs = nearbyUsersIDs;\r\n        },\r\n        setLanguageFilter: (state, languageFilter) => {\r\n            state.languageFilter = languageFilter;\r\n        },\r\n        setLocationFilter: (state, locationFilter) => {\r\n            state.locationFilter = locationFilter;\r\n        },\r\n        setSearchByUsernameFilter: (state, searchByUsernameFilter) => {\r\n            state.searchByUsernameFilter = searchByUsernameFilter;\r\n        },\r\n        setMaxDistanceFilter: (state, maxDistanceFilter) => {\r\n            state.maxDistanceFilter = maxDistanceFilter;\r\n        },\r\n        addUser(state, user) {\r\n            state.users[user.id] = user;\r\n        },\r\n        addSearchedUserID(state, userID) {\r\n            state.searchedUsersIDs.push(userID);\r\n        },\r\n        resetSearchedUsersIDs(state) {\r\n            state.searchedUsersIDs = [];\r\n        },\r\n        setLastUserShowed(state, lastUserShowed) {\r\n            state.lastUserShowed = lastUserShowed;\r\n        },\r\n        addRating(state, data) {\r\n            let userTo = state.users[data.id];\r\n\r\n            if (data.prev == null) {\r\n                //new rate\r\n                let newAvgRating = userTo.avgRating * userTo.numRatings;\r\n                newAvgRating += data.rating;\r\n                newAvgRating /= (userTo.numRatings + 1);\r\n                state.users[data.id].avgRating = newAvgRating;\r\n                state.users[data.id].numRatings = userTo.numRatings + 1;\r\n            } else {\r\n                if (data.rating == null) {\r\n                    //remove rate\r\n                    let newAvgRating = userTo.avgRating * userTo.numRatings;\r\n                    newAvgRating = newAvgRating - data.prev;\r\n                    if ((userTo.numRatings - 1) != 0)\r\n                        newAvgRating /= (userTo.numRatings - 1);\r\n                    state.users[data.id].avgRating = newAvgRating;\r\n                    state.users[data.id].numRatings = userTo.numRatings - 1;\r\n                } else {\r\n                    //modify rate\r\n                    let newAvgRating = userTo.avgRating * userTo.numRatings;\r\n                    newAvgRating = newAvgRating + data.rating - data.prev;\r\n                    if (userTo.numRatings != 0)\r\n                        newAvgRating /= userTo.numRatings;\r\n                    state.users[data.id].avgRating = newAvgRating;\r\n                }\r\n\r\n            }\r\n        },\r\n    },\r\n    actions: {\r\n        //----------------------------------------------------------------------------->\r\n        // ~ resetState ~                                                              >\r\n        // To reset state info                                                         >\r\n        //----------------------------------------------------------------------------->\r\n        resetState(context) {\r\n            context.commit('resetState');\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getSearchedUsers ~                                                        >\r\n        // To list searched users using pagination                                     >\r\n        // return: true/false (are there more users to show?)                          >\r\n        //----------------------------------------------------------------------------->\r\n        getSearchedUsers(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                let filters = context.getters.getFilters;\r\n\r\n                if (filters.location != null && filters.location != undefined && filters.maxDistance != null) {\r\n                    if (context.getters.getLastUserShowed == null) {\r\n                        context.dispatch('database/getNearbyUserIDs', {\r\n                            location: filters.location,\r\n                            maxDistance: filters.maxDistance\r\n                        })\r\n                            .then((ids) => {\r\n                                context.commit('setNearbyUsersIDs', ids);\r\n                                context.dispatch('getNearbyUsersProfiles')\r\n                                    .then(() => {\r\n                                        context.dispatch('areThereMoreNearbyUsers')\r\n                                            .then((areThereMore) => {\r\n                                                resolve(areThereMore);\r\n                                            })\r\n                                            .catch((error) => {\r\n                                                reject(error);\r\n                                            });\r\n                                    })\r\n                                    .catch((error) => {\r\n                                        reject(error);\r\n                                    });\r\n                            })\r\n                            .catch((error) => {\r\n                                reject(error);\r\n                            });\r\n                    } else {\r\n                        context.dispatch('getNearbyUsersProfiles')\r\n                            .then(() => {\r\n                                context.dispatch('areThereMoreNearbyUsers')\r\n                                    .then((areThereMore) => {\r\n                                        resolve(areThereMore);\r\n                                    })\r\n                                    .catch((error) => {\r\n                                        reject(error);\r\n                                    });\r\n                            })\r\n                            .catch((error) => {\r\n                                reject(error);\r\n                            });\r\n                    }\r\n                } else {\r\n                    context.dispatch('database/getNextUsersPage', {\r\n                        lastUserShowed: context.getters.getLastUserShowed,\r\n                        limit: Constants.SEARCHED_USERS_PAGE_SIZE,\r\n                        filters: filters\r\n                    })\r\n                        .then((data) => {\r\n                            context.commit('setLastUserShowed', data.newLastUserShowed);\r\n\r\n                            data.users.forEach(user => {\r\n                                context.commit('addUser', user);\r\n                                context.commit('addSearchedUserID', user.id);\r\n                            });\r\n                            if (data.users.length > 0) {\r\n\r\n                                context.dispatch('database/isNextUsersPageEmpty', {\r\n                                    lastUserShowed: context.getters.getLastUserShowed,\r\n                                    limit: Constants.SEARCHED_USERS_PAGE_SIZE,\r\n                                    filters: filters\r\n                                })\r\n                                    .then((isEmpty) => {\r\n                                        if (data.users.length > 0 && data.users.length < Constants.SEARCHED_USERS_PAGE_SIZE\r\n                                            && !isEmpty) {\r\n                                            context.dispatch('database/getNextUsersPage', {\r\n                                                lastUserShowed: context.getters.getLastUserShowed,\r\n                                                limit: Constants.SEARCHED_USERS_PAGE_SIZE - data.users.length,\r\n                                                filters: filters\r\n                                            })\r\n                                                .then((data2) => {\r\n                                                    context.commit('setLastUserShowed', data2.newLastUserShowed);\r\n                                                    data2.users.forEach(user => {\r\n                                                        context.commit('addUser', user);\r\n                                                        context.commit('addSearchedUserID', user.id);\r\n                                                    });\r\n                                                    context.dispatch('database/isNextUsersPageEmpty', {\r\n                                                        lastUserShowed: context.getters.getLastUserShowed,\r\n                                                        limit: Constants.SEARCHED_USERS_PAGE_SIZE,\r\n                                                        filters: filters\r\n                                                    })\r\n                                                        .then((isEmpty2) => {\r\n                                                            resolve(!isEmpty2);\r\n                                                        })\r\n                                                        .catch((error) => {\r\n                                                            reject(error);\r\n                                                        });\r\n                                                }).catch((error) => {\r\n                                                reject(error);\r\n                                            });\r\n                                        } else {\r\n                                            resolve(!isEmpty);\r\n                                        }\r\n                                    })\r\n                                    .catch((error) => {\r\n                                        reject(error);\r\n                                    });\r\n                            }\r\n                        })\r\n                        .catch((error) => {\r\n                            reject(error);\r\n                        });\r\n                }\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ areThereMoreNearbyUsers ~                                                 >\r\n        // To check if there are valid nearby users to show yet                        >\r\n        // return: true/false (are there more valid nearby users to show?)             >\r\n        //----------------------------------------------------------------------------->\r\n        areThereMoreNearbyUsers(context) {\r\n            return new Promise(async function (resolve, reject) {\r\n                let allIDs = context.getters.getNearbyUsersIDs;\r\n                let filters = context.getters.getFilters;\r\n                let lastUserShowed = context.getters.getLastUserShowed;\r\n                let i;\r\n\r\n                while (lastUserShowed + 1 < context.getters.getNearbyUsersIDsLength) {\r\n                    if (lastUserShowed == null) {\r\n                        i = 0;\r\n                    } else {\r\n                        i = lastUserShowed + 1;\r\n                    }\r\n\r\n                    let idsToGetProfiles = [];\r\n                    let aux = Constants.SEARCHED_USERS_PAGE_SIZE + lastUserShowed + 1;\r\n\r\n                    for (; i < Constants.SEARCHED_USERS_PAGE_SIZE + lastUserShowed + 1; i++) {\r\n                        if (i == context.getters.getNearbyUsersIDsLength)\r\n                            break;\r\n                        idsToGetProfiles.push(allIDs[i]);\r\n\r\n                    }\r\n\r\n                    lastUserShowed = i - 1;\r\n\r\n                    await context.dispatch('database/getMultipleProfilesByUID', idsToGetProfiles)\r\n                        .then((userProfiles) => {\r\n                            userProfiles.forEach(user => {\r\n                                let isValid = true;\r\n\r\n                                // --> USERNAME FILTERING\r\n                                if (filters.username != null && filters.username != undefined && filters.username != ''\r\n                                    && !user.username.startsWith(filters.username)) {\r\n                                    isValid = false;\r\n                                }\r\n                                // --> END USERNAME FILTERING\r\n\r\n                                // --> GENDER FILTERING\r\n                                if ((filters.gender === \"M\" && user.gender !== \"M\")\r\n                                    || (filters.gender === \"W\" && user.gender !== \"W\")) {\r\n                                    isValid = false;\r\n                                }\r\n                                // --> END GENDER FILTERING\r\n\r\n                                // --> AGE FILTERING\r\n                                if (filters.ageRange[0] > Constants.MIN_USER_AGE || filters.ageRange[1] < Constants.MAX_USER_AGE) {\r\n                                    if (filters.ageRange[0] > Constants.MIN_USER_AGE) {\r\n                                        let currentDate = new Date();\r\n                                        currentDate.setFullYear(currentDate.getFullYear() - filters.ageRange[0]);\r\n                                        currentDate.setHours(0, 0, 0);\r\n                                        if (new Date(user.birthDate.toDate().setHours(0, 0, 0,)) >= new Date(currentDate)) {\r\n                                            isValid = false;\r\n                                        }\r\n                                    }\r\n\r\n                                    if (filters.ageRange[1] < Constants.MAX_USER_AGE) {\r\n                                        let currentDate = new Date();\r\n                                        currentDate.setFullYear(currentDate.getFullYear() - filters.ageRange[1] - 1);\r\n                                        currentDate.setHours(0, 0, 0)\r\n                                        if (new Date(user.birthDate.toDate().setHours(0, 0, 0,)) <= new Date(currentDate)) {\r\n                                            isValid = false;\r\n                                        }\r\n                                    }\r\n                                }\r\n                                // --> END AGE FILTERING\r\n\r\n                                // --> LANGUAGES FILTERING\r\n                                if (filters.language.filterBy == \"languageToLearn\" && filters.language.languageToLearn != \"all\") {\r\n\r\n                                    let languageToLearnIndex = user.languagesToLearn.findIndex(function (lang) {\r\n                                        return lang == filters.language.languageToLearn;\r\n                                    });\r\n\r\n                                    if (languageToLearnIndex == -1) {\r\n                                        isValid = false;\r\n                                    }\r\n                                } else if (filters.language.filterBy == \"knownLanguage\" && filters.language.knownLanguage != \"all\") {\r\n                                    let knownLanguageIndex = user.knownLanguages.findIndex(function (lang) {\r\n                                        return lang == filters.language.knownLanguage;\r\n                                    });\r\n\r\n                                    if (knownLanguageIndex == -1) {\r\n                                        isValid = false;\r\n                                    }\r\n                                }\r\n                                // --> END LANGUAGES FILTERING\r\n\r\n                                if (isValid) {\r\n                                    resolve(true);\r\n                                }\r\n                            });\r\n                        })\r\n                        .catch((error) => {\r\n                            reject(error);\r\n                        });\r\n                }\r\n\r\n                resolve(false);\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getNearbyUsersProfiles ~                                                  >\r\n        // To show valid nearby users with pagination                                  >\r\n        //----------------------------------------------------------------------------->\r\n        getNearbyUsersProfiles(context) {\r\n            return new Promise(async function (resolve, reject) {\r\n                let usersAdded = 0;\r\n                let allIDs = context.getters.getNearbyUsersIDs;\r\n                let filters = context.getters.getFilters;\r\n\r\n                while (usersAdded < Constants.SEARCHED_USERS_PAGE_SIZE && context.getters.getLastUserShowed + 1 < context.getters.getNearbyUsersIDsLength) {\r\n                    let i;\r\n                    let lastUserShowed = context.getters.getLastUserShowed;\r\n\r\n                    if (lastUserShowed == null) {\r\n                        i = 0;\r\n                        lastUserShowed = 0;\r\n                    } else {\r\n                        i = lastUserShowed + 1;\r\n                    }\r\n\r\n                    let idsToGetProfiles = [];\r\n                    for (; i < Constants.SEARCHED_USERS_PAGE_SIZE + lastUserShowed; i++) {\r\n                        if (i == context.getters.getNearbyUsersIDsLength)\r\n                            break;\r\n\r\n                        idsToGetProfiles.push(allIDs[i]);\r\n                    }\r\n\r\n                    context.commit('setLastUserShowed', i - 1);\r\n\r\n                    await context.dispatch('database/getMultipleProfilesByUID', idsToGetProfiles)\r\n                        .then(async (userProfiles) => {\r\n                            userProfiles.forEach(user => {\r\n                                let isValid = true;\r\n\r\n                                // --> USERNAME FILTERING\r\n                                if (filters.username != null && filters.username != undefined && filters.username != ''\r\n                                    && !user.username.startsWith(filters.username)) {\r\n                                    isValid = false;\r\n                                }\r\n                                // --> END USERNAME FILTERING\r\n\r\n                                // --> GENDER FILTERING\r\n                                if ((filters.gender === \"M\" && user.gender !== \"M\")\r\n                                    || (filters.gender === \"W\" && user.gender !== \"W\")) {\r\n                                    isValid = false;\r\n                                }\r\n                                // --> END GENDER FILTERING\r\n\r\n                                // --> AGE FILTERING\r\n                                if (filters.ageRange[0] > Constants.MIN_USER_AGE || filters.ageRange[1] < Constants.MAX_USER_AGE) {\r\n                                    if (filters.ageRange[0] > Constants.MIN_USER_AGE) {\r\n                                        let currentDate = new Date();\r\n                                        currentDate.setFullYear(currentDate.getFullYear() - filters.ageRange[0]);\r\n                                        currentDate.setHours(0, 0, 0);\r\n                                        if (new Date(user.birthDate.toDate().setHours(0, 0, 0,)) >= new Date(currentDate)) {\r\n                                            isValid = false;\r\n                                        }\r\n                                    }\r\n\r\n                                    if (filters.ageRange[1] < Constants.MAX_USER_AGE) {\r\n                                        let currentDate = new Date();\r\n                                        currentDate.setFullYear(currentDate.getFullYear() - filters.ageRange[1] - 1);\r\n                                        currentDate.setHours(0, 0, 0)\r\n                                        if (new Date(user.birthDate.toDate().setHours(0, 0, 0,)) <= new Date(currentDate)) {\r\n                                            isValid = false;\r\n                                        }\r\n                                    }\r\n                                }\r\n                                // --> END AGE FILTERING\r\n\r\n                                // --> LANGUAGES FILTERING\r\n                                if (filters.language.filterBy == \"languageToLearn\" && filters.language.languageToLearn != \"all\") {\r\n\r\n                                    let languageToLearnIndex = user.languagesToLearn.findIndex(function (lang) {\r\n                                        return lang == filters.language.languageToLearn;\r\n                                    });\r\n\r\n                                    if (languageToLearnIndex == -1) {\r\n                                        isValid = false;\r\n                                    }\r\n                                } else if (filters.language.filterBy == \"knownLanguage\" && filters.language.knownLanguage != \"all\") {\r\n                                    let knownLanguageIndex = user.knownLanguages.findIndex(function (lang) {\r\n                                        return lang == filters.language.knownLanguage;\r\n                                    });\r\n\r\n                                    if (knownLanguageIndex == -1) {\r\n                                        isValid = false;\r\n                                    }\r\n                                }\r\n                                // --> END LANGUAGES FILTERING\r\n\r\n                                if (isValid) {\r\n                                    context.commit('addUser', user);\r\n                                    context.commit('addSearchedUserID', user.id);\r\n                                    usersAdded++;\r\n                                }\r\n                            });\r\n                        })\r\n                        .catch((error) => {\r\n                            reject(error);\r\n                        });\r\n                }\r\n                resolve();\r\n            });\r\n        },\r\n\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ resetSearchedUsers ~                                                      >\r\n        // To reset variables related to user searching                                >\r\n        //----------------------------------------------------------------------------->\r\n        resetSearchedUsers(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.commit(\"resetSearchedUsersIDs\");\r\n                context.commit('setLastUserShowed', null);\r\n\r\n                resolve();\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ setFilters ~                                                              >\r\n        // To set the filtering values selected by the user for the searching          >\r\n        //----------------------------------------------------------------------------->\r\n        setFilters(context, filters) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.commit(\"setGenderFilter\", filters.gender);\r\n                context.commit(\"setAgeRangeFilter\", filters.ageRange);\r\n                context.commit(\"setLanguageFilter\", filters.language);\r\n                context.commit(\"setMaxDistanceFilter\", filters.maxDistance);\r\n                context.commit(\"setLocationFilter\", filters.location);\r\n                resolve();\r\n            });\r\n        },\r\n\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getUserByID ~                                                             >\r\n        // To user profile info by its ID                                              >\r\n        // parameters required: id                                                     >\r\n        //----------------------------------------------------------------------------->\r\n        getUserByID(context, id) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                context.dispatch('database/getProfileByUID', id)\r\n                    .then((profileInfo) => {\r\n                        if (profileInfo) {\r\n                            context.commit('addUser', profileInfo);\r\n                            resolve(profileInfo);\r\n                        } else {\r\n                            resolve(false);\r\n                        }\r\n                    })\r\n                    .catch((error) => {\r\n                        console.log(\"Error getting user by it's id in firebase.\");\r\n                        reject(error)\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ resetFilters ~                                                            >\r\n        // To reset the filtering values to default                                    >\r\n        //----------------------------------------------------------------------------->\r\n        resetFilters(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.commit(\"setGenderFilter\", \"O\");\r\n                context.commit(\"setAgeRangeFilter\", [Constants.MIN_USER_AGE, Constants.MAX_USER_AGE]);\r\n                context.commit('setLanguageFilter', {\r\n                    filterBy: \"languageToLearn\",\r\n                    knownLanguage: \"all\",\r\n                    languageToLearn: \"all\"\r\n                });\r\n\r\n                context.commit(\"setLocationFilter\", null);\r\n                context.commit(\"setNearbyUsersIDs\", null);\r\n                context.commit(\"setNearbyUsersIDs\", null);\r\n                context.commit(\"setMaxDistanceFilter\", 3)\r\n                context.commit(\"setSearchByUsernameFilter\", null)\r\n\r\n                let filters = context.getters.getFilters;\r\n                filters[\"maxDistance\"] = 3;\r\n\r\n                resolve(filters);\r\n            });\r\n        },\r\n\r\n\r\n    }\r\n}","import Vue from 'vue'\r\nimport Vuex from 'vuex'\r\n\r\nVue.use(Vuex);\r\n\r\nimport Constants from \"../Constants\";\r\nimport database from \"./database.js\";\r\nimport users from \"./users.js\";\r\nimport permissions from \"./permissions.js\";\r\n\r\n////////////////////////////////////////////////////////\r\n//-----         ACCOUNTS & PROFILES INFO         -----//\r\n////////////////////////////////////////////////////////\r\n\r\nexport default {\r\n    namespaced: true,\r\n    modules: {\r\n        database,\r\n        users\r\n    },\r\n    state: {\r\n        /* User account*/\r\n        id: null,\r\n        name: null,\r\n        lastName: null,\r\n        email: null,\r\n        chats: [],\r\n        role: 'user',\r\n\r\n        /* User profile */\r\n        // 1st part\r\n        username: null,\r\n        birthDate: null,\r\n        gender: null,\r\n        description: null,\r\n        avgRating: null,\r\n        numRatings: null,\r\n        // 2nd part\r\n        knownLanguages: null,\r\n        languagesToLearn: null,\r\n        // 3rd part\r\n        profileImg: null,\r\n\r\n        /* Geolocation info */\r\n        location: null,\r\n\r\n        /* Ratings info */\r\n        ratings: null,\r\n\r\n        /* Constants */\r\n        genderOptions: {\r\n            \"M\": {\r\n                text: Constants.TEXT_MAN,\r\n                img: \"img/genders/male.svg\",\r\n                defaultProfileImg: 'img/defaultUserImages/male-defaultUserImage.svg',\r\n            },\r\n            \"W\": {\r\n                text: Constants.TEXT_WOMAN,\r\n                img: \"img/genders/female.svg\",\r\n                defaultProfileImg: 'img/defaultUserImages/female-defaultUserImage.svg',\r\n            },\r\n            \"O\": {\r\n                text: Constants.TEXT_OTHER,\r\n                img: \"img/genders/other.svg\",\r\n                defaultProfileImg: 'img/defaultUserImages/defaultUserImage.svg',\r\n            }\r\n        },\r\n        languageOptions: {\r\n            \"de\": {\r\n                text: \"Alemán\",\r\n                img: \"img/flags/de.svg\"\r\n            },\r\n            \"zh\": {\r\n                text: \"Chino\",\r\n                img: \"img/flags/zh.svg\"\r\n            },\r\n            \"es\": {\r\n                text: \"Español\",\r\n                img: \"img/flags/es.svg\"\r\n            },\r\n            \"fr\": {\r\n                text: \"Francés\",\r\n                img: \"img/flags/fr.svg\"\r\n            },\r\n            \"en\": {\r\n                text: \"Inglés\",\r\n                img: \"img/flags/en.svg\"\r\n            },\r\n            \"it\": {\r\n                text: \"Italiano\",\r\n                img: \"img/flags/it.svg\"\r\n            },\r\n            \"ja\": {\r\n                text: \"Japonés\",\r\n                img: \"img/flags/ja.svg\"\r\n            },\r\n            \"pt\": {\r\n                text: \"Portugués\",\r\n                img: \"img/flags/pt.svg\"\r\n            },\r\n            \"all\": {\r\n                text: \"Cualquier idioma\",\r\n                img: \"img/flags/all.svg\"\r\n            },\r\n        },\r\n    },\r\n    getters: {\r\n        getName: (state) => {\r\n            return state.name;\r\n        },\r\n        getID: (state) => {\r\n            return state.id;\r\n        },\r\n        getLastName: (state) => {\r\n            return state.lastName;\r\n        },\r\n        getEmail: (state) => {\r\n            return state.email;\r\n        },\r\n        getRole: (state) => {\r\n            return state.role;\r\n        },\r\n        getChats: (state) => {\r\n            return state.chats;\r\n        },\r\n        getProfile: (state) => {\r\n            let data = {};\r\n\r\n            if (state.username) {\r\n                data = {\r\n                    username: state.username,\r\n                    ...data\r\n                }\r\n            }\r\n            if (state.birthDate) {\r\n                data = {\r\n                    birthDate: state.birthDate,\r\n                    ...data\r\n                }\r\n            }\r\n            if (state.gender) {\r\n                data = {\r\n                    gender: state.gender,\r\n                    ...data\r\n                }\r\n            }\r\n            if (state.description) {\r\n                data = {\r\n                    description: state.description,\r\n                    ...data\r\n                }\r\n            }\r\n            if (state.profileImg) {\r\n                data = {\r\n                    profileImg: state.profileImg,\r\n                    ...data\r\n                }\r\n            }\r\n            if (state.knownLanguages) {\r\n                data = {\r\n                    knownLanguages: state.knownLanguages,\r\n                    ...data\r\n                }\r\n            }\r\n            if (state.languagesToLearn) {\r\n                data = {\r\n                    languagesToLearn: state.languagesToLearn,\r\n                    ...data\r\n                }\r\n            }\r\n\r\n            data = {\r\n                avgRating: state.avgRating,\r\n                numRatings: state.numRatings,\r\n                ...data\r\n            }\r\n\r\n            return data;\r\n        },\r\n        getUsername: (state) => {\r\n            return state.username;\r\n        },\r\n        getBirthDate: (state) => {\r\n            return state.birthDate;\r\n        },\r\n        getGender: (state) => {\r\n            return state.gender;\r\n        },\r\n        getDescription: (state) => {\r\n            return state.description;\r\n        },\r\n        getProfileImg: (state) => {\r\n            return state.profileImg;\r\n        },\r\n        getAvgRating: (state) => {\r\n            return state.avgRating;\r\n        },\r\n        getNumRatings: (state) => {\r\n            return state.numRatings;\r\n        },\r\n        getKnownLanguages: (state) => {\r\n            return state.knownLanguages;\r\n        },\r\n        getLanguagesToLearn: (state) => {\r\n            return state.languagesToLearn;\r\n        },\r\n        getGenderTextByID: (state) => (id) => {\r\n            return state.genderOptions[id].text;\r\n        },\r\n        getGenderImgByID: (state) => (id) => {\r\n            return state.genderOptions[id].img;\r\n        },\r\n        getGenderDefaultProfileImgByUserGender: (state) => {\r\n            if (null == state.gender) {\r\n                return state.genderOptions[\"O\"].defaultProfileImg;\r\n            } else {\r\n                return state.genderOptions[state.gender].defaultProfileImg;\r\n            }\r\n        },\r\n        getGenderOptionsAsArray: (state, getters) => {\r\n            return Object.keys(state.genderOptions).map(function (id) {\r\n                let text = getters.getGenderTextByID(id);\r\n                let img = getters.getGenderImgByID(id);\r\n                return new Object({id, text, img});\r\n            });\r\n        },\r\n        getLanguageTextByID: (state) => (id) => {\r\n            return state.languageOptions[id].text;\r\n        },\r\n        getLanguageImgByID: (state) => (id) => {\r\n            return state.languageOptions[id].img;\r\n        },\r\n        getLanguageOptionsAsArray: (state, getters) => {\r\n            return Object.keys(state.languageOptions).map(function (id) {\r\n                let text = getters.getLanguageTextByID(id);\r\n                let img = getters.getLanguageImgByID(id);\r\n                return new Object({id, text, img});\r\n            });\r\n        },\r\n        getFormattedDateInTextMonth: () => (date) => {\r\n            let d = new Date(date);\r\n            return d.getDate() + \" \" + Constants.TEXT_OF + \" \" + Constants.MONTHS_OF_THE_YEAR_IN_TEXT[d.getMonth()] + \" \" + Constants.TEXT_OF + \" \" + d.getFullYear();\r\n        },\r\n        getLanguageFromLanguageOptionsByID: (state) => (id) => {\r\n            return state.languageOptions[id];\r\n        },\r\n        getLocation: (state) => {\r\n            return state.location;\r\n        },\r\n        getRatings: (state) => {\r\n            return state.ratings;\r\n        },\r\n        getRating: (state)  => (id) => {\r\n            if(state.ratings){\r\n                return state.ratings[id];\r\n            }\r\n            else{\r\n                return null;\r\n            }\r\n        },\r\n\r\n    },\r\n    mutations: {\r\n        setIDe(state, id) {\r\n            state.id = id;\r\n        },\r\n        setName(state, name) {\r\n            state.name = name;\r\n        },\r\n        setLastName(state, lastName) {\r\n            state.lastName = lastName;\r\n        },\r\n        setEmail(state, email) {\r\n            state.email = email;\r\n        },\r\n        setRole(state, role) {\r\n            state.role = role;\r\n        },\r\n        setChats(state, chats) {\r\n            state.chats = chats;\r\n        },\r\n        setAccount(state, accountInfo) {\r\n            if (accountInfo.hasOwnProperty('email')) {\r\n                state.email = accountInfo.email;\r\n            }\r\n            if (accountInfo.hasOwnProperty('name')) {\r\n                state.name = accountInfo.name;\r\n            }\r\n            if (accountInfo.hasOwnProperty('lastName')) {\r\n                state.lastName = accountInfo.lastName;\r\n            }\r\n            if (accountInfo.hasOwnProperty('profileImg')) {\r\n                state.role = accountInfo.role;\r\n            }\r\n            if (accountInfo.hasOwnProperty('id')) {\r\n                state.id = accountInfo.id;\r\n            }\r\n            if (accountInfo.hasOwnProperty('chats')) {\r\n                state.chats = accountInfo.chats;\r\n            }\r\n        },\r\n        setUsername(state, username) {\r\n            state.username = username;\r\n        },\r\n        setBirthDate(state, birthDate) {\r\n            state.birthDate = birthDate;\r\n        },\r\n        setGender(state, gender) {\r\n            state.gender = gender;\r\n        },\r\n        setDescription(state, description) {\r\n            state.description = description;\r\n        },\r\n        setAvgRating(state, avgRating) {\r\n            state.avgRating = avgRating;\r\n        },\r\n        setNumRatings(state, numRatings) {\r\n            state.numRatings = numRatings;\r\n        },\r\n        setKnownLanguages(state, knownLanguages) {\r\n            state.knownLanguages = knownLanguages;\r\n        },\r\n        setLanguagesToLearn(state, languagesToLearn) {\r\n            state.languagesToLearn = languagesToLearn;\r\n        },\r\n        setProfileImg(state, profileImg) {\r\n            state.profileImg = profileImg;\r\n        },\r\n        setRatings(state, ratings) {\r\n            state.ratings = ratings;\r\n        },\r\n        setRating(state, data) {\r\n            if(state.ratings == null){\r\n                state.ratings = {};\r\n            }\r\n            state.ratings[data.id] = data.rating;\r\n        },\r\n\r\n        setProfile(state, profileInfo) {\r\n            if (profileInfo) {\r\n\r\n                if (profileInfo.hasOwnProperty('username')) {\r\n                    state.username = profileInfo.username;\r\n                }\r\n                if (profileInfo.hasOwnProperty('birthDate')) {\r\n                    state.birthDate = profileInfo.birthDate;\r\n                }\r\n                if (profileInfo.hasOwnProperty('gender')) {\r\n                    state.gender = profileInfo.gender;\r\n                }\r\n                if (profileInfo.hasOwnProperty('description')) {\r\n                    state.description = profileInfo.description;\r\n                }\r\n                if (profileInfo.hasOwnProperty('avgRating')) {\r\n                    state.avgRating = profileInfo.avgRating;\r\n                }\r\n                if (profileInfo.hasOwnProperty('numRatings')) {\r\n                    state.numRatings = profileInfo.numRatings;\r\n                }\r\n                if (profileInfo.hasOwnProperty('knownLanguages')) {\r\n                    state.knownLanguages = profileInfo.knownLanguages;\r\n                }\r\n                if (profileInfo.hasOwnProperty('languagesToLearn')) {\r\n                    state.languagesToLearn = profileInfo.languagesToLearn;\r\n                }\r\n                if (profileInfo.hasOwnProperty('profileImg')) {\r\n                    state.profileImg = profileInfo.profileImg;\r\n                }\r\n            }\r\n        },\r\n        resetState(state) {\r\n            /* User account*/\r\n            state.id = null;\r\n            state.name = null;\r\n            state.lastName = null;\r\n            state.email = null;\r\n            state.role = 'user';\r\n            state.chats = [];\r\n\r\n            /* User profile */\r\n            // 1st part\r\n            state.username = null;\r\n            state.birthDate = null;\r\n            state.gender = null;\r\n            state.description = null;\r\n            state.avgRating = null;\r\n            state.numRatings = null;\r\n            // 2nd part\r\n            state.knownLanguages = null;\r\n            state.languagesToLearn = null;\r\n            // 3rd part\r\n            state.profileImg = null;\r\n\r\n            /* Ratings info */\r\n            state.ratings = null;\r\n\r\n            /* Geolocation info */\r\n            state.location = null;\r\n        },\r\n        setLocation(state, location) {\r\n            state.location = location;\r\n        },\r\n    },\r\n    actions: {\r\n        //----------------------------------------------------------------------------->\r\n        // ~ initState ~                                                               >\r\n        // To init users state info with the appropriate data                          >\r\n        //----------------------------------------------------------------------------->\r\n        initState(context) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                context.dispatch('database/getProfile')\r\n                    .then((profileInfo) => {\r\n                        context.commit('setProfile', profileInfo);\r\n\r\n                        context.dispatch('database/getAccount')\r\n                            .then((accountInfo) => {\r\n                                context.commit('setAccount', accountInfo);\r\n                                context.dispatch('getRatings')\r\n                                    .then(() => {\r\n                                        resolve();\r\n                                    })\r\n                                    .catch((error) => {\r\n                                        reject(error)\r\n                                    });\r\n                                resolve();\r\n                            })\r\n                            .catch((error) => {\r\n                                reject(error)\r\n                            });\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ resetState ~                                                              >\r\n        // To reset state info                                                         >\r\n        //----------------------------------------------------------------------------->\r\n        resetState(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.commit('resetState');\r\n                resolve();\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ createAccount ~                                                           >\r\n        // To create user account                                                      >\r\n        // parameters required: data {email, password, name, lastName}                 >\r\n        //----------------------------------------------------------------------------->\r\n        createAccount(context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('database/createAccount', data)\r\n                    .then(() => {\r\n                        context.dispatch('database/setPersistance')\r\n                            .then(() => {\r\n                                context.dispatch('database/setAccount', data)\r\n                                    .then(() => {\r\n                                        context.commit('setAccount', data);\r\n                                        resolve();\r\n                                    })\r\n                                    .catch((error) => {\r\n                                        console.log('Error creating user account.');\r\n                                        reject(error)\r\n                                    });\r\n                            })\r\n                            .catch((error) => {\r\n                                reject(error)\r\n                            });\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error)\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ generateNotificationToken ~                                               >\r\n        // To generate push notifications token for this browser and user              >\r\n        //----------------------------------------------------------------------------->\r\n        generateNotificationToken(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('database/generatePushNotificationToken')\r\n                    .then(() => {\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error)\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ updateAccountNameAndLastName ~                                            >\r\n        // To update user account data name and last name                              >\r\n        // parameters required: data {[name], [lastName]}                              >\r\n        //----------------------------------------------------------------------------->\r\n        updateAccountNameAndLastName(context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                context.dispatch('database/updateAccountData', data)\r\n                    .then(() => {\r\n                        if (data.hasOwnProperty('name')) {\r\n                            context.commit('setName', data.name);\r\n                        }\r\n                        if (data.hasOwnProperty('lastName')) {\r\n                            context.commit('setLastName', data.lastName);\r\n                        }\r\n\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error)\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ updateAccountEmail ~                                                      >\r\n        // To update user account email                                                >\r\n        // parameters required: email                                                  >\r\n        //----------------------------------------------------------------------------->\r\n        updateAccountEmail(context, email) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                context.dispatch('database/updateAccountEmail', email)\r\n                    .then(() => {\r\n                        context.commit('setEmail', email);\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error)\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ updateAccountPassword ~                                                   >\r\n        // To update user account password                                             >\r\n        // parameters required: password                                               >\r\n        //----------------------------------------------------------------------------->\r\n        updateAccountPassword(context, password) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                context.dispatch('database/updateAccountPassword', password)\r\n                    .then(() => {\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error)\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ login ~                                                                   >\r\n        // To log user in                                                              >\r\n        // parameters required: data {email, password}                                 >\r\n        //----------------------------------------------------------------------------->\r\n        login(context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('database/login', data)\r\n                    .then(() => {\r\n                        context.commit('setAccount', data);\r\n                        context.dispatch('database/setPersistance')\r\n                            .then(() => {\r\n                                resolve();\r\n                            })\r\n                            .catch((error) => {\r\n                                reject(error)\r\n                            });\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error)\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ isUserLogged ~                                                            >\r\n        // To determine if user is or is not logged                                    >\r\n        //----------------------------------------------------------------------------->\r\n        isUserLogged: function (context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('database/isUserAuth')\r\n                    .then((isIt) => {\r\n                        resolve(isIt);\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error)\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ logout ~                                                                  >\r\n        // To log user out                                                             >\r\n        //----------------------------------------------------------------------------->\r\n        logout(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('database/logout')\r\n                    .then(() => {\r\n                        context.dispatch('resetAppState', null, {root: true});\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error)\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ sendEmailVerification ~                                                   >\r\n        // To send email to verify user email                                          >\r\n        //----------------------------------------------------------------------------->\r\n        sendEmailVerification(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('database/sendEmailVerification')\r\n                    .then(() => {\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        console.log('Error sending verification email.');\r\n                        reject(error);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ sendEmailVerification ~                                                   >\r\n        // To send email to verify user email                                          >\r\n        //----------------------------------------------------------------------------->\r\n        sendPasswordResetEmail(context, email) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('database/sendPasswordResetEmail', email)\r\n                    .then(() => {\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        console.log('Error sending password email.');\r\n                        reject(error);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ checkIfEmailIsVerified ~                                                  >\r\n        // To check if email is verified                                               >\r\n        //----------------------------------------------------------------------------->\r\n        checkIfEmailIsVerified(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('database/isEmailVerified')\r\n                    .then((isVerified) => {\r\n                        resolve(isVerified);\r\n                    })\r\n                    .catch((error) => {\r\n                        console.log('Error checking if email is verified.');\r\n                        reject(error);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ checkIfUsernameIsAlreadyRegistered ~                                      >\r\n        // To check if a username is already in use                                    >\r\n        //----------------------------------------------------------------------------->\r\n        checkIfUsernameIsAlreadyRegistered(context, username) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('database/getProfileByUsername', username)\r\n                    .then((profileInfo) => {\r\n                        if (profileInfo) {\r\n                            resolve(true);\r\n                        } else {\r\n                            resolve(false);\r\n                        }\r\n                    })\r\n                    .catch((error) => {\r\n                        console.log('Error checking if username is already registered.');\r\n                        reject(error)\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ createProfile ~                                                           >\r\n        // To create user profile                                                      >\r\n        // parameters required: data {username, birthDate, gender, description}        >\r\n        //----------------------------------------------------------------------------->\r\n        createProfile(context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('checkIfUsernameIsAlreadyRegistered', data.username)\r\n                    .then((isAlreadyRegistered) => {\r\n                        if (isAlreadyRegistered) {\r\n                            reject(Constants.ERROR_ALREADY_AN_ACCOUNT_WITH_THIS_USERNAME);\r\n                        } else {\r\n                            context.dispatch('database/setProfile', data)\r\n                                .then(() => {\r\n                                    context.commit('setUsername', data.username);\r\n                                    context.commit('setBirthDate', data.birthDate);\r\n                                    context.commit('setGender', data.gender);\r\n                                    context.commit('setDescription', data.description);\r\n                                    context.commit('setAvgRating', 0);\r\n                                    context.commit('setNumRatings', 0);\r\n                                    resolve();\r\n                                })\r\n                                .catch((error) => {\r\n                                    console.log('Error creating user profile.');\r\n                                    reject(error);\r\n                                });\r\n                        }\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error)\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ updateProfile ~                                                           >\r\n        // To update user profile data                                                 >\r\n        // parameters required: data {[username], [birthDate], [gender],               >\r\n        //                            [description], [knownLanguages],                 >\r\n        //                            [languagesToLearn]}                              >\r\n        //----------------------------------------------------------------------------->\r\n        updateProfile(context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                context.dispatch('database/updateProfile', data)\r\n                    .then(() => {\r\n\r\n                        if (data.hasOwnProperty('username')) {\r\n                            context.commit('setUsername', data.username);\r\n                        }\r\n                        if (data.hasOwnProperty('description')) {\r\n                            context.commit('setDescription', data.description);\r\n                        }\r\n                        if (data.hasOwnProperty('gender')) {\r\n                            context.commit('setGender', data.gender);\r\n                        }\r\n                        if (data.hasOwnProperty('birthDate')) {\r\n                            context.commit('setBirthDate', data.birthDate);\r\n                        }\r\n                        if (data.hasOwnProperty('knownLanguages')) {\r\n                            context.commit('setKnownLanguages', data.knownLanguages);\r\n                        }\r\n                        if (data.hasOwnProperty('languagesToLearn')) {\r\n                            context.commit('setLanguagesToLearn', data.languagesToLearn);\r\n                        }\r\n                        if (data.hasOwnProperty('profileImg')) {\r\n                            context.commit('setProfileImg', data.profileImg);\r\n                        }\r\n\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error)\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ setLanguages ~                                                            >\r\n        // To set user languages: known and to-be-learned                              >\r\n        // parameters required: data {knownLanguages, languagesToLearn}                >\r\n        //----------------------------------------------------------------------------->\r\n        setLanguages(context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                context.dispatch('database/setLanguages', data)\r\n                    .then(() => {\r\n                        context.commit('setKnownLanguages', data.knownLanguages);\r\n                        context.commit('setLanguagesToLearn', data.languagesToLearn);\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        console.log('Error setting user languages.');\r\n                        reject(error);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ setProfileImg ~                                                           >\r\n        // To set user profile image                                                   >\r\n        // parameters required: img                                                    >\r\n        //----------------------------------------------------------------------------->\r\n        setProfileImg(context, img) {\r\n            return new Promise(function (resolve, reject) {\r\n                Vue.nextTick(() => {\r\n\r\n                    context.dispatch('database/uploadProfileImg', img)\r\n                        .then((url) => {\r\n                            context.dispatch('database/setProfileImg', url)\r\n                                .then(() => {\r\n                                    context.commit('setProfileImg', url);\r\n                                    resolve();\r\n                                })\r\n                                .catch((error) => {\r\n                                    console.log('Error setting user profile image.');\r\n                                    console.error(error)\r\n                                    reject(error);\r\n                                });\r\n                        })\r\n                        .catch((error) => {\r\n                            console.log('Error uploading user profile image.');\r\n                            reject(error);\r\n                        });\r\n                });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getRegistrationState ~                                                    >\r\n        // To check what register info the user has already submitted                  >\r\n        //----------------------------------------------------------------------------->\r\n        getRegistrationState(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('database/getProfile')\r\n                    .then((profileInfo) => {\r\n\r\n                        context.dispatch('checkRegistrationState', profileInfo)\r\n                            .then((state) => {\r\n                                context.commit('setProfile', profileInfo);\r\n                                resolve(state);\r\n                            })\r\n                            .catch((error) => {\r\n                                console.log(error);\r\n                                reject(error);\r\n                            });\r\n                    })\r\n                    .catch((error) => {\r\n                        console.error(error);\r\n                        reject(Constants.ERROR_GENERIC_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ checkRegistrationState ~                                                  >\r\n        // To check registration state of a profile                                    >\r\n        // parameters: data {username, gender, description, avgRating, numRatings,     >\r\n        //                   knownLanguages, languagesToLearn, profileImg}             >\r\n        //----------------------------------------------------------------------------->\r\n        checkRegistrationState(context, data) {\r\n\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                context.dispatch('checkIfEmailIsVerified')\r\n                    .then((isVerified) => {\r\n                        if (isVerified) {\r\n                            // Part 0 completed\r\n                            if (data && data.hasOwnProperty('username') && data.hasOwnProperty('gender')\r\n                                && data.hasOwnProperty('description') && data.hasOwnProperty('avgRating')\r\n                                && data.hasOwnProperty('numRatings')) {\r\n                                // Part 1 completed\r\n                                if (data.hasOwnProperty('knownLanguages') && data.hasOwnProperty('languagesToLearn')) {\r\n                                    // Part 2 completed\r\n                                    if (data.hasOwnProperty('profileImg')) {\r\n                                        // Part 3 completed\r\n                                        // Registration process completed\r\n                                        resolve('dashboard');\r\n                                    } else {\r\n                                        // State 3\r\n                                        resolve('set-your-profile-image');\r\n                                    }\r\n                                } else {\r\n                                    // State 2\r\n                                    resolve('fill-your-languages');\r\n                                }\r\n                            } else {\r\n                                // State 1\r\n                                resolve('fill-your-profile-info');\r\n                            }\r\n                        } else {\r\n                            // State 0\r\n                            resolve('email-verification');\r\n                        }\r\n                    })\r\n                    .catch((error) => {\r\n                        console.error(error);\r\n                        reject(Constants.ERROR_GENERIC_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getCurrentLocation ~                                                      >\r\n        // To get the current user location                                            >\r\n        //----------------------------------------------------------------------------->\r\n        getCurrentLocation() {\r\n            return new Promise(function (resolve, reject) {\r\n                try {\r\n                    navigator.geolocation.getCurrentPosition(position => {\r\n                            resolve({\r\n                                lat: position.coords.latitude,\r\n                                lng: position.coords.longitude\r\n                            })\r\n                        },\r\n                        function (error) {\r\n                            console.error(error);\r\n                            reject(Constants.ERROR_GETTING_CURRENT_LOCATION);\r\n                        });\r\n                } catch (error) {\r\n                    console.error(error);\r\n                    reject(Constants.ERROR_GETTING_CURRENT_LOCATION);\r\n                }\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getRatings ~                                                              >\r\n        // To get user ratings given by the logged user                                >\r\n        //----------------------------------------------------------------------------->\r\n        getRatings(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('database/getRatings')\r\n                    .then((ratingsInfo) => {\r\n                        context.commit('setRatings', ratingsInfo);\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        console.log('Error retrieving user ratings.');\r\n                        reject(error);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ rateUser ~                                                                >\r\n        // To rate a user                                                              >\r\n        // parameters: data{id, rating}                                                >\r\n        //----------------------------------------------------------------------------->\r\n        rateUser(context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('database/setRating', data)\r\n                    .then((ratingsInfo) => {\r\n                        context.commit('setRating', data);\r\n                        context.commit('users/addRating', data);\r\n\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        console.log(error)\r\n                        console.log('Error rating user.');\r\n                        reject(error);\r\n                    });\r\n            });\r\n        },\r\n\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getLocation ~                                                             >\r\n        // To get the current (or last) user location                                  >\r\n        //----------------------------------------------------------------------------->\r\n        getLocation(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('getCurrentLocation')\r\n                    .then((currentLocation) => {\r\n                        context.commit('setLocation', currentLocation);\r\n                        context.dispatch('database/updateUserLocation', currentLocation)\r\n                            .then(() => {\r\n                                resolve(currentLocation);\r\n                            })\r\n                            .catch(() => {\r\n                                resolve(currentLocation);\r\n                            });\r\n                    })\r\n                    .catch((error) => {\r\n                        console.error(error);\r\n\r\n                        context.dispatch('database/getLocation')\r\n                            .then((location) => {\r\n                                context.commit('setLocation', location);\r\n                                resolve(location);\r\n                            })\r\n                            .catch((error) => {\r\n                                reject(error);\r\n                            });\r\n                    });\r\n            });\r\n        },\r\n\r\n    },\r\n\r\n};","import Vue from 'vue'\r\nimport Vuex from 'vuex'\r\n\r\nVue.use(Vuex);\r\n\r\nimport Constants from \"../Constants\";\r\nimport database from \"./database\";\r\nimport permissions from \"./permissions\";\r\nimport users from \"./users.js\";\r\nimport user from \"./user.js\";\r\nimport AuxMethods from \"../AuxMethods\";\r\nimport haversine from 'haversine-distance'\r\nimport * as firebase from \"firebase\";\r\n\r\n////////////////////////////////////////////////////////\r\n//-----                 EVENTS                   -----//\r\n////////////////////////////////////////////////////////\r\n\r\nexport default {\r\n    namespaced: true,\r\n    modules: {\r\n        user,\r\n        users,\r\n        database,\r\n        permissions\r\n    },\r\n    state: {\r\n        events: {},\r\n        eventsToShowIDs: [],\r\n        lastEventShowed: null\r\n    },\r\n    getters: {\r\n        getEvents: (state) => {\r\n            return state.events;\r\n        },\r\n        getEventByID: (state) => (id) => {\r\n            return state.events[id];\r\n        },\r\n        getEventsToShow: (state) => {\r\n            let eventsToShow = [];\r\n            state.eventsToShowIDs.forEach((eventID) => {\r\n                eventsToShow.push({\r\n                    id: eventID,\r\n                    ...state.events[eventID]\r\n                })\r\n            });\r\n            return eventsToShow;\r\n        },\r\n        getLastEventShowed: (state) => {\r\n            return state.lastEventShowed;\r\n        },\r\n        amIParticipating: (state) => (data) => {\r\n\r\n            let found = null;\r\n            if (state.events[data.eventID]) {\r\n                found = state.events[data.eventID].participants.find(participantID => participantID == data.userID);\r\n                return found != undefined;\r\n            }\r\n            return null;\r\n\r\n        },\r\n    },\r\n    mutations: {\r\n        resetState(state) {\r\n            state.events = {};\r\n            state.eventsToShowIDs.splice(0, state.eventsToShowIDs.length);\r\n            state.lastEventShowed = null;\r\n        },\r\n        addEvent(state, event) {\r\n            state.events[event.id] = event;\r\n        },\r\n        addParticipantToEvent(state, data) {\r\n            if (-1 == state.events[data.eventID].participants.findIndex(participantID => participantID == data.userID)) {\r\n                state.events[data.eventID].participants.push(data.userID);\r\n            }\r\n        },\r\n        removeParticipantFromEvent(state, data) {\r\n            let searchedUserIndex = state.events[data.eventID].participants.findIndex(function (userID) {\r\n                return userID == data.userID;\r\n            });\r\n            state.events[data.eventID].participants.splice(searchedUserIndex, 1);\r\n        },\r\n        addEventToShow(state, eventID) {\r\n            state.eventsToShowIDs.push(eventID);\r\n        },\r\n        setEventsToShowIDs(state, eventsToShowIDs) {\r\n            state.eventsToShowIDs = eventsToShowIDs;\r\n        },\r\n        setLastEventShowed(state, lastEventShowed) {\r\n            state.lastEventShowed = lastEventShowed;\r\n        },\r\n    },\r\n    actions: {\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getEvents ~                                                               >\r\n        // To get events that will be celebrated                                       >\r\n        //----------------------------------------------------------------------------->\r\n        getEvents(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('database/getNextEventsPage', {\r\n                    lastEventShowed: context.getters.getLastEventShowed,\r\n                    limit: Constants.EVENTS_PAGE_SIZE,\r\n                })\r\n                    .then((data) => {\r\n                        context.commit('setLastEventShowed', data.newLastEventShowed);\r\n\r\n                        data.events.forEach(event => {\r\n                            let userLocation = context.getters['user/getLocation'];\r\n                            let distance = null;\r\n                            let eventLocation = {\r\n                                lat: event.location.coordinates._lat,\r\n                                lng: event.location.coordinates._long,\r\n                            }\r\n\r\n                            let eventNonFormattedLoc = event.location;\r\n                            eventNonFormattedLoc['coordinates'] = eventLocation;\r\n                            event['location'] = eventNonFormattedLoc;\r\n\r\n                            if (userLocation != null) {\r\n                                distance = haversine(event.location.coordinates, userLocation);\r\n                            }\r\n\r\n                            event = {\r\n                                ...event,\r\n                                distance: distance / 1000\r\n                            };\r\n                            context.commit('addEvent', event);\r\n                            context.commit('addEventToShow', event.id);\r\n                        });\r\n\r\n                        if (data.events.length > 0) {\r\n                            context.dispatch('database/isNextEventsPageEmpty', {\r\n                                lastEventShowed: context.getters.getLastEventShowed,\r\n                                limit: Constants.EVENTS_PAGE_SIZE,\r\n                            })\r\n                                .then((isEmpty) => {\r\n                                    resolve(!isEmpty);\r\n                                })\r\n                                .catch((error) => {\r\n                                    reject(error);\r\n                                });\r\n                        }\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getEvents ~                                                               >\r\n        // To get events that will be celebrated                                       >\r\n        //----------------------------------------------------------------------------->\r\n        getEventParticipants(context, eventID) {\r\n            return new Promise(function (resolve, reject) {\r\n                let event = context.getters.getEventByID(eventID);\r\n                context.dispatch('database/getMultipleProfilesByUID', event.participants)\r\n                    .then((userProfiles) => {\r\n                        userProfiles.forEach(user => {\r\n                            context.commit('users/addUser', user);\r\n                        });\r\n                        resolve(userProfiles);\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ resetState ~                                                              >\r\n        // To reset state info                                                         >\r\n        //----------------------------------------------------------------------------->\r\n        resetState(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.commit('resetState');\r\n                resolve();\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ addParticipantToEvent ~                                                   >\r\n        // To add user to an Event                                                     >\r\n        // parameters required: eventID                                                >\r\n        //----------------------------------------------------------------------------->\r\n        addParticipantToEvent: function (context, eventID) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                context.dispatch('database/addParticipantToEvent', eventID)\r\n                    .then((userID) => {\r\n                        context.commit(\"addParticipantToEvent\", {eventID: eventID, userID: userID});\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        console.log(error)\r\n                        reject(error);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ removeParticipantFromEvent ~                                              >\r\n        // To remove user from an Event                                                >\r\n        // parameters required: eventID                                                >\r\n        //----------------------------------------------------------------------------->\r\n        removeParticipantFromEvent: function (context, eventID) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                context.dispatch('database/removeParticipantFromEvent', eventID)\r\n                    .then((userID) => {\r\n                        context.commit(\"removeParticipantFromEvent\", {eventID: eventID, userID: userID});\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getEventByID ~                                                             >\r\n        // To user profile info by its ID                                              >\r\n        // parameters required: id                                                     >\r\n        //----------------------------------------------------------------------------->\r\n        getEventByID(context, id) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                context.dispatch('database/getEventByID', id)\r\n                    .then((event) => {\r\n                        if (event) {\r\n                            let userLocation = context.getters['user/getLocation'];\r\n                            let distance = null;\r\n                            let eventLocation = {\r\n                                lat: event.location.coordinates._lat,\r\n                                lng: event.location.coordinates._long,\r\n                            }\r\n\r\n                            let eventNonFormattedLoc = event.location;\r\n                            eventNonFormattedLoc['coordinates'] = eventLocation;\r\n                            event['location'] = eventNonFormattedLoc;\r\n\r\n                            if (userLocation != null) {\r\n                                distance = haversine(event.location.coordinates, userLocation);\r\n                            }\r\n\r\n                            event = {\r\n                                ...event,\r\n                                distance: distance / 1000\r\n                            };\r\n                            context.commit('addEvent', event);\r\n                            resolve(event);\r\n                        } else {\r\n                            resolve(null);\r\n                        }\r\n                    })\r\n                    .catch((error) => {\r\n                        console.log(\"Error getting event by it's id in firebase.\");\r\n                        reject(error)\r\n                    });\r\n            });\r\n        },\r\n\r\n    },\r\n}","import Vue from 'vue'\r\nimport Vuex from 'vuex'\r\n\r\nVue.use(Vuex);\r\n\r\nimport database from \"./database\";\r\nimport permissions from \"./permissions\";\r\nimport users from \"./users.js\";\r\nimport user from \"./user.js\";\r\n\r\n////////////////////////////////////////////////////////\r\n//-----                  CHATS                   -----//\r\n////////////////////////////////////////////////////////\r\n\r\nexport default {\r\n    namespaced: true,\r\n    modules: {\r\n        user,\r\n        users,\r\n        database,\r\n        permissions\r\n    },\r\n    state: {\r\n        chats: {},\r\n        chatsToShowIDs: [],\r\n\r\n        chatListListener: null,\r\n        chatMessagesListeners: []\r\n    },\r\n    getters: {\r\n        getChatByID: (state) => (id) => {\r\n            return state.chats[id];\r\n        },\r\n        getChatsToShowIDs: (state) => {\r\n            return state.chatsToShowIDs;\r\n        },\r\n        getChatMessagesByChatID: (state, getters) => (chatID) => {\r\n            if (state.chats[chatID] != undefined) {\r\n                return state.chats[chatID].messages;\r\n            } else {\r\n                return [];\r\n            }\r\n\r\n        },\r\n        getUnreadMessagesByChatID: (state, getters) => (chatID) => {\r\n            let i, count = 0;\r\n            let myID = getters['user/getID'];\r\n            let unreadMessages = [];\r\n\r\n            if (state.chats[chatID] != undefined) {\r\n                for (i = state.chats[chatID].messages.length - 1; i >= 0; i--) {\r\n                    if (state.chats[chatID].messages[i].sender != myID && !state.chats[chatID].messages[i].read) {\r\n                        unreadMessages.push(state.chats[chatID].messages[i].id);\r\n                    } else if (state.chats[chatID].messages[i].sender != myID && state.chats[chatID].messages[i].read) {\r\n                        break;\r\n                    } else if (state.chats[chatID].messages[i].sender == myID) {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return unreadMessages;\r\n        },\r\n        getChatsToShow: (state) => {\r\n            let chatsToShow = [];\r\n\r\n            state.chatsToShowIDs.forEach((chatID) => {\r\n                let auxChat = {};\r\n                auxChat.users = state.chats[chatID].users;\r\n                auxChat.id = state.chats[chatID].id;\r\n                auxChat.lastMessage = state.chats[chatID].messages[state.chats[chatID].messages.length - 1];\r\n                chatsToShow.push(auxChat)\r\n            });\r\n\r\n            return chatsToShow;\r\n        },\r\n        getUserByChatID: (state, getters) => (chatID) => {\r\n            let userID;\r\n            if (state.chats[chatID].users[0] == getters['user/getID']) {\r\n                userID = state.chats[chatID].users[1];\r\n            } else {\r\n                userID = state.chats[chatID].users[0];\r\n            }\r\n\r\n            return getters['users/getUserByID'](userID);\r\n        },\r\n\r\n        getNotReadMessagesCountByChatID: (state, getters) => (id) => {\r\n            let i, count = 0;\r\n            let myID = getters['user/getID'];\r\n\r\n            for (i = state.chats[id].messages.length - 1; i >= 0; i--) {\r\n                if (state.chats[id].messages[i].sender != myID && !state.chats[id].messages[i].read) {\r\n                    count++;\r\n                } else if (state.chats[id].messages[i].sender != myID && state.chats[id].messages[i].read) {\r\n                    break;\r\n                } else if (state.chats[id].messages[i].sender == myID) {\r\n                    break;\r\n                }\r\n            }\r\n\r\n            return count;\r\n        },\r\n\r\n\r\n    },\r\n    mutations: {\r\n        resetState(state) {\r\n            state.chats = {};\r\n            state.chatsToShowIDs.splice(0, state.chatsToShowIDs.length);\r\n\r\n            if (state.chatListListener != null && state.chatListListener != undefined) {\r\n                state.chatListListener();\r\n                state.chatListListener = null;\r\n            }\r\n\r\n            state.chatMessagesListeners.forEach(l => {\r\n                if (l != null && l != undefined) {\r\n                    l();\r\n                }\r\n            });\r\n\r\n            state.chatMessagesListeners.splice(0, state.chatMessagesListeners.length);\r\n        },\r\n        addChatMessagesListener(state, listener) {\r\n            state.chatMessagesListeners.push(listener);\r\n        },\r\n        addChat(state, chat) {\r\n            if (!state.chats[chat.id] || chat.messages.length > state.chats[chat.id].messages.length) {\r\n                Vue.set(state.chats, chat.id, chat);\r\n            }\r\n        },\r\n        updateChatMessages(state, data) {\r\n            for (let i = state.chats[data.chatID].messages.length - 1; i >= 0; i--) {\r\n\r\n                let index = data.messages.findIndex(function (mMessage) {\r\n                    return mMessage.id === state.chats[data.chatID].messages[i].id;\r\n                });\r\n\r\n                if (index != -1) {\r\n                    Vue.set(state.chats[data.chatID].messages, i, data.messages[index]);\r\n                    data.messages.splice(index, 1);\r\n                    if (data.messages.length == 0) {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        sortChatMessagesByDate(state, chatID) {\r\n\r\n            function compareChatMessagesByDate(a, b) {\r\n                let dateA = a.date;\r\n                let dateB = b.date;\r\n\r\n                if (dateA === null) {\r\n                    return 1;\r\n                } else if (dateB === null) {\r\n                    return -1;\r\n                }\r\n                if (dateB < dateA) {\r\n                    return 1;\r\n                }\r\n                if (dateB > dateA) {\r\n                    return -1;\r\n                }\r\n                return 0;\r\n            }\r\n\r\n            state.chats[chatID].messages.sort(compareChatMessagesByDate);\r\n        },\r\n        addChatToShow(state, chatID) {\r\n            if (-1 == state.chatsToShowIDs.findIndex(id => id == chatID)) {\r\n                state.chatsToShowIDs.push(chatID);\r\n            }\r\n        },\r\n        sortChatsToShowByLastMessage(state) {\r\n            function compareChatsByLastMessageDate(a, b) {\r\n                let chatALastMessageDate = state.chats[a].messages[state.chats[a].messages.length - 1].date;\r\n                let chatBLastMessageDate = state.chats[b].messages[state.chats[b].messages.length - 1].date;\r\n                if (chatALastMessageDate < chatBLastMessageDate) {\r\n                    return 1;\r\n                }\r\n                if (chatALastMessageDate > chatBLastMessageDate) {\r\n                    return -1;\r\n                }\r\n                return 0;\r\n            }\r\n\r\n            state.chatsToShowIDs.sort(compareChatsByLastMessageDate);\r\n        },\r\n\r\n\r\n        setChatListListener(state, chatListListener) {\r\n            state.chatListListener = chatListListener;\r\n        },\r\n\r\n        pushChatMessages(state, data) {\r\n            data.messages.forEach((mp) => {\r\n                if (mp.date != null && mp.date != undefined) {\r\n                    if (state.chats[data.chatID].messages.length == 0) {\r\n                        Vue.set(state.chats[data.chatID].messages, 0, mp);\r\n                    } else {\r\n                        let alreadyAdded = false;\r\n\r\n                        for (let i = state.chats[data.chatID].messages.length - 1; i >= 0; i--) {\r\n                            if (state.chats[data.chatID].messages[i].date < mp.date && mp.date != null && mp.date != undefined) {\r\n                                state.chats[data.chatID].messages.push(mp);\r\n                                alreadyAdded = true;\r\n                                break;\r\n                            }\r\n                        }\r\n\r\n                        if (!alreadyAdded) {\r\n                            state.chats[data.chatID].messages.push(mp);\r\n                        }\r\n\r\n                    }\r\n                }\r\n            });\r\n\r\n            //state.chats[data.chatID].messages = state.chats[data.chatID].messages.concat(data.messages);\r\n        },\r\n    },\r\n    actions: {\r\n        //----------------------------------------------------------------------------->\r\n        // ~ resetState ~                                                              >\r\n        // To reset state info                                                         >\r\n        //----------------------------------------------------------------------------->\r\n        resetState(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.commit('resetState');\r\n                resolve();\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ initState ~                                                               >\r\n        // To init chats state info with the appropriate data                          >\r\n        //----------------------------------------------------------------------------->\r\n        initState(context, getters) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                context.dispatch('createChatListeners', context.getters['user/getChats'])\r\n                    .then(() => {\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error)\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ manageChatListChange ~                                                    >\r\n        // To manage the event of changes in a chat-list                               >\r\n        // parameters required: user whose chat list we are managing                   >\r\n        //----------------------------------------------------------------------------->\r\n        manageChatListChange(context, user) {\r\n            return new Promise(async function (resolve, reject) {\r\n\r\n                for (const chatID of user.chats) {\r\n                    if (-1 == context.getters.getChatsToShowIDs.findIndex(id => id == chatID) &&\r\n                        (!context.state.chats.hasOwnProperty(chatID) || context.state.chats[chatID].messages.length == 0)) {\r\n                        // It is new\r\n                        await context.dispatch('database/getChatByID', chatID)\r\n                            .then(async (chat) => {\r\n                                chat = {\r\n                                    ...chat,\r\n                                    messages: []\r\n                                }\r\n\r\n                                let userID;\r\n\r\n                                if (chat.users[0] == context.getters['user/getID']) {\r\n                                    userID = chat.users[1];\r\n                                } else {\r\n                                    userID = chat.users[0];\r\n                                }\r\n\r\n                                await context.dispatch('users/getUserByID', userID)\r\n                                    .then(() => {\r\n                                        context.commit(\"addChat\", chat);\r\n                                    })\r\n                                    .catch((error) => {\r\n                                        reject(error);\r\n                          cch          });\r\n\r\n\r\n                                // Create messages listener\r\n                                await context.dispatch('database/createChatMessagesListener', chatID)\r\n                                    .then(() => {\r\n                                        context.commit(\"addChatToShow\", chat.id);\r\n                                    })\r\n                                    .catch((error) => {\r\n                                        reject(error);\r\n                                    });\r\n\r\n                            })\r\n                            .catch((error) => {\r\n                                reject(error)\r\n                            });\r\n\r\n                    }\r\n                }\r\n                resolve();\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ manageChatMessagesChange ~                                                >\r\n        // To manage the event of changes in user chat messages                        >\r\n        // parameters required: chatMessages                                           >\r\n        //----------------------------------------------------------------------------->\r\n        manageChatMessagesChange(context, chatMessages) {\r\n            return new Promise(function (resolve, reject) {\r\n                    context.commit('addChatMessagesListener', chatMessages.listener);\r\n\r\n                    let newMessages = [];\r\n                    let modifiedMessagesToRead = [];\r\n                    let modifiedMessagesDated = [];\r\n\r\n                    chatMessages.messages.forEach((m) => {\r\n                        if (m.change == \"added\" && m.date) {\r\n                            newMessages.push(m);\r\n                        } else if (m.change == \"modified\" && m.read && m.date) {\r\n                            modifiedMessagesToRead.push(m);\r\n                        } else if (m.change == \"modified\" && !m.read && m.date) {\r\n                            modifiedMessagesDated.push(m);\r\n                        }\r\n                    });\r\n\r\n                    if (newMessages.length > 0) {\r\n                        context.commit('pushChatMessages', {chatID: chatMessages.id, messages: newMessages});\r\n                        //context.commit(\"sortChatMessagesByDate\", chatMessages.id);\r\n                        context.commit(\"sortChatsToShowByLastMessage\");\r\n                    }\r\n                    if (modifiedMessagesDated.length > 0) {\r\n                        context.commit('pushChatMessages', {chatID: chatMessages.id, messages: modifiedMessagesDated});\r\n                        //context.commit(\"sortChatMessagesByDate\", chatMessages.id);\r\n                        context.commit(\"sortChatsToShowByLastMessage\");\r\n                    }\r\n                    if (modifiedMessagesToRead.length > 0) {\r\n                        context.commit('updateChatMessages', {chatID: chatMessages.id, messages: modifiedMessagesToRead});\r\n                    }\r\n                    resolve();\r\n                }\r\n            );\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ setChatMessagesToReadByChatID ~                                           >\r\n        // To set messages in chat to read state                                       >\r\n        // parameters required: chatID                                                 >\r\n        //----------------------------------------------------------------------------->\r\n        setChatMessagesToReadByChatID(context, chatID) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let unreadMessages = context.getters.getUnreadMessagesByChatID(chatID);\r\n\r\n                context.dispatch('database/setMessagesToRead', {chatID: chatID, messages: unreadMessages})\r\n                    .catch((error) => {\r\n                        reject(error);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ sendNewChatMessage ~                                                      >\r\n        // To send a chat message                                                      >\r\n        // parameters required: {chatID, users, messageText}                           >\r\n        //----------------------------------------------------------------------------->\r\n        sendNewChatMessage(context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                let chat = context.getters.getChatByID(data.chatID);\r\n\r\n                let result;\r\n\r\n                if (context.getters.getChatByID(data.chatID).messages.length == 0) {\r\n                    result = context.dispatch('database/addChat', {id: data.chatID, users: chat.users});\r\n                } else {\r\n                    result = Promise.resolve();\r\n                }\r\n\r\n                result.then(() => {\r\n                    context.dispatch('database/addMessagesToChat', {\r\n                        chatID: data.chatID,\r\n                        message: {sender: context.getters['user/getID'], text: data.messageText}\r\n                    }).then(function () {\r\n                        resolve();\r\n                    }).catch((error) => {\r\n                        reject(error);\r\n                    });\r\n                }).catch((error) => {\r\n                    reject(error);\r\n                });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ createChatListeners ~                                                     >\r\n        // To create listeners for the chats of the user                               >\r\n        //----------------------------------------------------------------------------->\r\n        createChatListeners: function (context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('database/createAccountListener', context.getters['user/getID'])\r\n                    .then(() => {\r\n                        if (context.state.chatListListener != null && context.state.chatListListener != undefined) {\r\n                            context.state.chatListListener();\r\n                        }\r\n                        context.commit('setChatListListener', user.listener);\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error);\r\n                    });\r\n            });\r\n        }\r\n    },\r\n}","import Vue from 'vue'\r\nimport Vuex from 'vuex'\r\n\r\nVue.use(Vuex);\r\n\r\nimport Constants from \"../Constants\";\r\nimport database from \"./database\";\r\nimport permissions from \"./permissions\";\r\nimport users from \"./users.js\";\r\nimport user from \"./user.js\";\r\n\r\n\r\n////////////////////////////////////////////////////////\r\n//-----               APP RANKING                -----//\r\n////////////////////////////////////////////////////////\r\n\r\nexport default {\r\n    namespaced: true,\r\n    modules: {\r\n        database,\r\n        permissions,\r\n        users,\r\n        user\r\n    },\r\n    state: {\r\n        lastUserShowed: -1,\r\n        rankingUsers: [],\r\n        rankingUsersIDs: [],\r\n        rankingUser: null,\r\n    },\r\n    getters: {\r\n\r\n        getRankingUsersToShow: (state, getters) => {\r\n            let rus = [];\r\n\r\n            let i = 0;\r\n            state.rankingUsersIDs.forEach(uid => {\r\n                let ru = {\r\n                    ...getters['users/getUserByID'](uid)\r\n                };\r\n\r\n                ru[\"score\"] = state.rankingUsers[i].score;\r\n                ru[\"position\"] = state.rankingUsers[i].position;\r\n\r\n                rus.push(ru);\r\n                i++;\r\n            });\r\n\r\n            return rus;\r\n        },\r\n        getLastUserShowed: (state) => {\r\n            return state.lastUserShowed;\r\n        },\r\n        getRankedUserByIndex: (state) => (index) => {\r\n            return state.rankingUsers[index];\r\n        },\r\n        getRankingUsers: (state) => {\r\n            return state.rankingUsers;\r\n        },\r\n    },\r\n    mutations: {\r\n        resetState(state) {\r\n            state.lastUserShowed = -1;\r\n            state.rankingUsers.splice(0, state.rankingUsers.length);\r\n            state.rankingUsersIDs.splice(0, state.rankingUsersIDs.length);\r\n            state.rankingUser = null;\r\n        },\r\n        setRankingUser(state, rankingUser) {\r\n            state.rankingUser = rankingUser;\r\n        },\r\n        setRankingUsers(state, rankingUsers) {\r\n            rankingUsers.forEach(r => {\r\n                state.rankingUsers.push(r);\r\n            });\r\n        },\r\n        resetRankingUsers(state, rankingUsers) {\r\n            state.rankingUsers.splice(0, state.rankingUsers.length);\r\n        },\r\n        resetRankingUsersIDs(state, rankingUsers) {\r\n            state.rankingUsersIDs.splice(0, state.rankingUsersIDs.length);\r\n        },\r\n\r\n        setLastUserShowed(state, lastUserShowed) {\r\n            state.lastUserShowed = lastUserShowed;\r\n        },\r\n        addRankingUserID(state, rankingUserID) {\r\n            state.rankingUsersIDs.push(rankingUserID);\r\n        },\r\n    },\r\n    actions: {\r\n        //----------------------------------------------------------------------------->\r\n        // ~ initState ~                                                               >\r\n        // To init ranking state info with the appropriate data                        >\r\n        //----------------------------------------------------------------------------->\r\n        initState(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('resetState')\r\n                    .then(() => {\r\n                        context.dispatch('getRankingUsers')\r\n                            .then(() => {\r\n                                resolve();\r\n                            })\r\n                            .catch((error) => {\r\n                                reject(error)\r\n                            });\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error)\r\n                    });\r\n            });\r\n\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getRankingUsers ~                                                         >\r\n        // To get top 100 ranking users and current user position in ranking           >\r\n        //----------------------------------------------------------------------------->\r\n        getRankingUsers(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('database/getTop100RankingUsers')\r\n                    .then((top100Users) => {\r\n                        let userID = context.getters['user/getID'];\r\n\r\n                        let userIndex = top100Users.findIndex(user => {\r\n                            return user.id == userID;\r\n                        });\r\n\r\n                        context.commit('setRankingUsers', top100Users);\r\n\r\n                        if (userIndex == -1) {\r\n                            context.dispatch('database/getUserRankingPositionByID', userID)\r\n                                .then((user) => {\r\n                                    context.commit('setRankingUser', user);\r\n                                    resolve();\r\n                                })\r\n                                .catch((error) => {\r\n                                    reject(error);\r\n                                });\r\n                        } else {\r\n                            resolve();\r\n                        }\r\n                    })\r\n                    .catch((error) => {\r\n                        reject(error);\r\n                    });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getPagedRankingUsers ~                                                    >\r\n        // To get page-size users from the group of ranking users retrieved            >\r\n        //----------------------------------------------------------------------------->\r\n        getPagedRankingUsers(context) {\r\n            return new Promise(async function (resolve, reject) {\r\n                let newUserShowed = context.getters.getLastUserShowed + 1;\r\n                let pageEnding = newUserShowed + Constants.RANKING_PAGE_SIZE;\r\n\r\n                while (newUserShowed < pageEnding && newUserShowed < context.getters.getRankingUsers.length) {\r\n                    let user = context.getters.getRankedUserByIndex(newUserShowed);\r\n\r\n                    await context.dispatch('users/getUserByID', user.id)\r\n                        .then(() => {\r\n                            context.commit(\"addRankingUserID\", user.id);\r\n                        })\r\n                        .catch((error) => {\r\n                            reject(error);\r\n                        });\r\n                    newUserShowed++;\r\n                }\r\n\r\n                context.commit('setLastUserShowed', newUserShowed - 1);\r\n                if (newUserShowed < context.getters.getRankingUsers.length) {\r\n                    resolve(true);\r\n                } else {\r\n                    resolve(false);\r\n                }\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ areThereMoreRankingUsersToShow ~                                          >\r\n        // To check if there are ranking users left to show                            >\r\n        //----------------------------------------------------------------------------->\r\n        areThereMoreRankingUsersToShow(context) {\r\n            return new Promise(async function (resolve, reject) {\r\n                let newUserShowed = context.getters.getLastUserShowed + 1;\r\n                if (newUserShowed < context.getters.getRankingUsers.length) {\r\n                    resolve(true);\r\n                } else {\r\n                    resolve(false);\r\n                }\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ resetState ~                                                              >\r\n        // To reset state info                                                         >\r\n        //----------------------------------------------------------------------------->\r\n        resetState(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.commit('resetState');\r\n                resolve();\r\n            });\r\n        },\r\n\r\n    }\r\n}","import Vue from 'vue'\r\nimport Vuex from 'vuex'\r\n\r\nVue.use(Vuex);\r\n\r\nimport * as firebase from \"firebase\";\r\nimport {GeoFirestore} from 'geofirestore';\r\nimport Constants from \"./Constants\";\r\nimport users from \"./modules/users\";\r\nimport events from \"./modules/events\";\r\nimport user from \"./modules/user\";\r\nimport chats from \"./modules/chats\";\r\nimport ranking from \"./modules/ranking\";\r\nimport database from \"./modules/database\";\r\nimport permissions from \"./modules/permissions\";\r\n\r\nexport default new Vuex.Store({\r\n    modules: {\r\n        user,\r\n        users,\r\n        events,\r\n        chats,\r\n        ranking,\r\n        database,\r\n        permissions\r\n    },\r\n    state: {\r\n        appInfoLoaded: false,\r\n        allAvailableLanguages: {\r\n            \"de\": \"Alemán\",\r\n            \"zh\": \"Chino\",\r\n            \"es\": \"Español\",\r\n            \"fr\": \"Francés\",\r\n            \"en\": \"Inglés\",\r\n            \"it\": \"Italiano\",\r\n            \"ja\": \"Japonés\",\r\n            \"pt\": \"Portugués\",\r\n            \"all\": \"Cualquier idioma\"\r\n        },\r\n        allAvailableGenders: {\r\n            \"M\": {\r\n                name: \"Hombre\",\r\n                img: \"img/genders/male.svg\"\r\n            },\r\n            \"W\": {\r\n                name: \"Mujer\",\r\n                img: \"img/genders/female.svg\"\r\n            }\r\n        },\r\n        defaultInfo: {\r\n            userImage: 'img/defaultUserImages/defaultUserImage.svg',\r\n            maleUserImage: 'img/defaultUserImages/male-defaultUserImage.svg',\r\n            femaleUserImage: 'img/defaultUserImages/female-defaultUserImage.svg',\r\n            profileHeaderImage: \"img/backgrounds/user_profile_header.png\"\r\n        },\r\n        searchInfo: {\r\n            lastVisible: null,\r\n            userIDs: [],\r\n            filtering: {\r\n                genderW: true,\r\n                genderM: true,\r\n                ageRange: [Constants.MIN_USER_AGE, Constants.MAX_USER_AGE],\r\n                maxDistance: 3,\r\n                maxDistanceRanges: [5000, 10000, 20000, null],\r\n                maxDistanceRangesText: [Constants.TEXT_5_KM, Constants.TEXT_10_KM, Constants.TEXT_10_KM, '∞'],\r\n                searchByUsername: false,\r\n                filterByLanguageToLearn: true,\r\n                knownLanguage:\r\n                    {\r\n                        id: \"all\",\r\n                        text: \"Cualquier idioma\"\r\n                    },\r\n                languageToLearn:\r\n                    {\r\n                        id: \"all\",\r\n                        text: \"Cualquier idioma\"\r\n                    },\r\n                nearbyUsersIDs: [],\r\n            },\r\n\r\n        },\r\n        emailVerified: false,\r\n        userInfo: {\r\n            uid: null,\r\n            registrationState: null,\r\n            username: null,\r\n            email: null,\r\n            name: null,\r\n            lastName: null,\r\n            birthDate: null,\r\n            gender: null,\r\n            description: null,\r\n            knownLanguages: null,\r\n            languagesToLearn: null,\r\n            profileImage: null,\r\n            chatIDs: [],\r\n            chatUsers: [],\r\n            chatIDsListener: null,\r\n            avgRating: null,\r\n            numRatings: null,\r\n            location: {}\r\n        },\r\n        chats: [],\r\n        chatsInfo: {\r\n            activeChat: null\r\n        },\r\n        rankingInfo: {\r\n            lastVisible: null,\r\n            userIDs: []\r\n        },\r\n        activeUser: [],\r\n        eventsInfo: {\r\n            lastVisible: null,\r\n            events: []\r\n        },\r\n        activeEventID: null,\r\n        ratings: {},\r\n        users: []\r\n    },\r\n    getters: {\r\n        getAppInfoLoaded: (state) => {\r\n            return state.appInfoLoaded;\r\n        },\r\n\r\n        notReadMessagesCountByChatID: (state) => (chatID) => {\r\n            let chatIndex = state.chats.findIndex(chat => {\r\n                return chat.id == chatID;\r\n            });\r\n\r\n            let notReadMessagesCount = 0;\r\n\r\n            if (chatIndex != null) {\r\n                state.chats[chatIndex].messages.forEach(function (message) {\r\n                    if (message.sender !== state.userInfo.uid && !message.read) {\r\n                        notReadMessagesCount++;\r\n                    }\r\n                })\r\n            }\r\n\r\n            return notReadMessagesCount;\r\n        },\r\n        getProfileHeaderImage: (state) => {\r\n            return state.defaultInfo.profileHeaderImage;\r\n        },\r\n\r\n        getUserIndexByUID: (state) => (uid) => {\r\n            return state.users.findIndex(user => {\r\n                return user.uid == uid;\r\n            });\r\n        },\r\n        getUserByUID: (state, getters) => (userID) => {\r\n            let userIndex = getters.getUserIndexByUID(userID);\r\n\r\n            if (-1 != userIndex) {\r\n                return state.users[userIndex];\r\n            } else {\r\n                return null;\r\n            }\r\n\r\n        },\r\n        getRankingUsers: (state, getters) => {\r\n            let rankingUsers = [];\r\n            state.rankingInfo.userIDs.forEach(function (rankingUser) {\r\n                let userIndex = getters.getUserIndexByUID(rankingUser);\r\n                if (userIndex != -1) {\r\n                    rankingUsers.push(state.users[userIndex]);\r\n                }\r\n            });\r\n\r\n            return rankingUsers;\r\n        },\r\n        getSearchUsers: (state, getters) => {\r\n            let searchUsers = [];\r\n            state.searchInfo.userIDs.forEach(function (searchUser) {\r\n                let userIndex = getters.getUserIndexByUID(searchUser);\r\n                if (userIndex != -1) {\r\n                    searchUsers.push(state.users[userIndex]);\r\n                }\r\n            });\r\n\r\n            return searchUsers;\r\n        },\r\n        getOtherUserInChatByChatID: (state, getters) => (chatID) => {\r\n            let chat = getters.getChatWithUserByChatID(chatID);\r\n\r\n            let uid = null;\r\n            chat.users.forEach(function (userID) {\r\n                if (userID != state.userInfo.uid) {\r\n                    uid = userID;\r\n                }\r\n            });\r\n\r\n            if (uid != null) {\r\n                return getters.getUserByUID(uid);\r\n            }\r\n\r\n            return null;\r\n        },\r\n        getEmailVerified: (state) => {\r\n            return state.emailVerified;\r\n        },\r\n        getRatingOfUserByUID: (state) => (uid) => {\r\n            return state.ratings[uid];\r\n        },\r\n        getRegistrationState: (state) => {\r\n            return state.userInfo.registrationState;\r\n        },\r\n        getChatsInfoActiveChat: (state) => {\r\n            return state.chatsInfo.activeChat;\r\n        },\r\n        getActiveEvent: (state) => {\r\n            return state.eventsInfo.events.find(function (event) {\r\n                return event.id === state.activeEventID;\r\n            });\r\n\r\n        },\r\n        getEvent: (state) => (id) => {\r\n            return state.eventsInfo.events.find(function (event) {\r\n                return event.id === id;\r\n            });\r\n\r\n        },\r\n        getActiveChatUserID: (state) => {\r\n            return state.activeChat.userID;\r\n        },\r\n        getChatUserByChatID: (state) => (chatID) => {\r\n            return state.userInfo.chatUsers.find(function (user) {\r\n                return user.chatID == chatID;\r\n            })\r\n        },\r\n        getNewChatMessageIndex: (state) => (chatIndex) => {\r\n            return state.chats[chatIndex].messages.length;\r\n        },\r\n        getSearchInfoUsers: function (state) {\r\n            return state.searchInfo.userIDs;\r\n        },\r\n        getSearchInfoUserByUID: (state) => (uid) => {\r\n            return state.searchInfo.userIDs.find(function (user) {\r\n                return user.uid == uid;\r\n            });\r\n        },\r\n        getChatWithUser: function (state) {\r\n            return state.chatWithUser;\r\n        },\r\n        getChats: (state) => {\r\n            return state.chats;\r\n        },\r\n        getSearchInfoFilteringFilterByLanguageToLearn: function (state) {\r\n            return state.searchInfo.filtering.filterByLanguageToLearn;\r\n        },\r\n        getSearchInfoFiltering: function (state) {\r\n            return state.searchInfo.filtering;\r\n        },\r\n        getSearchInfoLastVisible: function (state) {\r\n            return state.searchInfo.lastVisible;\r\n        },\r\n        getSearchInfo: (state) => {\r\n            return state.searchInfo;\r\n        },\r\n        getLanguageNameByID: (state) => (id) => {\r\n            return state.allAvailableLanguages[id];\r\n        },\r\n        getChatWithUserByChatID: (state) => (chatID) => {\r\n            return state.chats.find(function (chat) {\r\n                return chat.id == chatID;\r\n            });\r\n        },\r\n        getAllAvailableLanguagesAsArray: (state, getters) => {\r\n            return Object.keys(state.allAvailableLanguages).map(function (id) {\r\n                let text = getters.getLanguageNameByID(id)\r\n                return new Object({id, text});\r\n            });\r\n        },\r\n        getGenderNameByID: (state) => (id) => {\r\n            return state.allAvailableGenders[id].name;\r\n        },\r\n\r\n        getAngleInRad: () => (x) => {\r\n            return x * Math.PI / 180;\r\n        },\r\n        getHaversineDistance: (state, getters) => (data) => {\r\n            let p1 = data.p1;\r\n            let p2 = data.p2;\r\n\r\n            let R = 6378137; // Earth’s mean radius in meter\r\n            let dLat = getters.getAngleInRad(p2.lat - p1.lat);\r\n            let dLong = getters.getAngleInRad(p2.lng - p1.lng);\r\n            let a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n                Math.cos(getters.getAngleInRad(p1.lat)) * Math.cos(getters.getAngleInRad(p2.lat)) *\r\n                Math.sin(dLong / 2) * Math.sin(dLong / 2);\r\n            let c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n            let distance = R * c;\r\n            return distance; // returns the distance in meters\r\n        },\r\n\r\n\r\n        getGenderImgByID: (state) => (id) => {\r\n            return state.allAvailableGenders[id].img;\r\n        },\r\n        getAllAvailableGendersAsArray: (state, getters) => {\r\n            return Object.keys(state.allAvailableGenders).map(function (id) {\r\n                let name = getters.getGenderNameByID(id);\r\n                let img = getters.getGenderImgByID(id);\r\n                return new Object({id, name, img});\r\n            });\r\n        },\r\n        getPathToFlagImageByLanguageID: () => (lang) => {\r\n            return \"img/flags/\" + lang + \".svg\";\r\n        },\r\n        getDefaultInfoUserImage: (state) => {\r\n            return state.defaultInfo.userImage;\r\n        },\r\n        getUserInfo: (state) => {\r\n            return state.userInfo;\r\n        },\r\n        getUserInfoLocation: (state) => {\r\n            return state.userInfo.location;\r\n        },\r\n        getUserInfoUID: (state) => {\r\n            return state.userInfo.uid;\r\n        },\r\n        getUserInfoChatIDs: (state) => {\r\n            return state.userInfo.chatIDs;\r\n        },\r\n        getMaleDefaultInfoUserImage: (state) => {\r\n            return state.defaultInfo.maleUserImage;\r\n        },\r\n        getFemaleDefaultInfoUserImage: (state) => {\r\n            return state.defaultInfo.femaleUserImage;\r\n        },\r\n        getDefaultInfoUserImageByGender: (state, getters) => {\r\n            if (state.userInfo.gender == \"M\") {\r\n                return getters.getMaleDefaultInfoUserImage;\r\n            } else if (state.userInfo.gender == \"W\") {\r\n                return getters.getFemaleDefaultInfoUserImage;\r\n            } else {\r\n                return state.defaultInfo.userImage;\r\n            }\r\n        },\r\n        getUserInfoProfileImage: (state, getters) => {\r\n            if (!state.userInfo.profileImage) {\r\n                return getters.getDefaultInfoUserImageByGender;\r\n            } else {\r\n                return state.userInfo.profileImage;\r\n            }\r\n\r\n        },\r\n        getLanguageObjectsByIDs: (state, getters, lids) => {\r\n            let lobjects = [];\r\n            lids.forEach(function (lid) {\r\n                let lobject = {\r\n                    name: getters.getLanguageNameByID(lid),\r\n                    img: getters.getPathToFlagImageByLanguageID(lid),\r\n                };\r\n                lobjects.push(lobject);\r\n            })\r\n            return lobjects;\r\n        },\r\n        getFormattedDateInTextMonth: () => (date) => {\r\n            let d = new Date(date);\r\n            return d.getDate() + \" \" + Constants.TEXT_OF + \" \" + Constants.MONTHS_OF_THE_YEAR_IN_TEXT[d.getMonth()] + \" \" + Constants.TEXT_OF + \" \" + d.getFullYear();\r\n        },\r\n        getFormattedMonthIn3CapitalLettersText: () => (date) => {\r\n            let d = new Date(date);\r\n            let month = Constants.MONTHS_OF_THE_YEAR_IN_TEXT[d.getMonth()];\r\n            return month.charAt(0).toUpperCase() + month.charAt(1).toUpperCase() + month.charAt(2).toUpperCase();\r\n        },\r\n        getStoreInitiated: (state) => {\r\n            return state.storeInitiated;\r\n        }\r\n\r\n\r\n    },\r\n    mutations: {\r\n        setAppInfoLoaded(state, appInfoLoaded) {\r\n            state.appInfoLoaded = appInfoLoaded;\r\n        },\r\n        setSearchInfoFilteringNearbyUsersIDs(state, nearbyUsersIDs) {\r\n            state.searchInfo.filtering.nearbyUsersIDs = nearbyUsersIDs;\r\n        },\r\n\r\n        setEmailVerified(state, isVerified) {\r\n            state.emailVerified = isVerified;\r\n        },\r\n        setUserInfoLocation(state, location) {\r\n            state.userInfo.location = location;\r\n        },\r\n        resetSearchInfoUserIDs(state) {\r\n            state.searchInfo.userIDs = [];\r\n        },\r\n        resetUserInfo(state) {\r\n            state.userInfo = {\r\n                uid: null,\r\n                registrationState: null,\r\n                username: null,\r\n                email: null,\r\n                name: null,\r\n                lastName: null,\r\n                birthDate: null,\r\n                gender: null,\r\n                description: null,\r\n                knownLanguages: null,\r\n                languagesToLearn: null,\r\n                profileImage: null,\r\n                chatIDs: [],\r\n                chatUsers: [],\r\n                chatIDsListener: null,\r\n                avgRating: null,\r\n                numRatings: null\r\n            };\r\n        },\r\n        setSearchInfoFiltering: function (state, newFiltering) {\r\n            return state.searchInfo.filtering = newFiltering;\r\n        },\r\n        resetRankingInfo(state) {\r\n            state.rankingInfo = {\r\n                lastVisible: null,\r\n                userIDs: []\r\n            };\r\n        },\r\n        resetEventsInfo(state) {\r\n            state.eventsInfo = {\r\n                lastVisible: null,\r\n                events: []\r\n            };\r\n        },\r\n        resetChatsInfoActiveChat(state) {\r\n            state.chatsInfo.activeChat = null;\r\n        },\r\n        resetChats(state) {\r\n            state.chats = [];\r\n        },\r\n        resetRatings(state) {\r\n            state.ratings = {};\r\n        },\r\n        setUserRating(state, data) {\r\n            if (!data.rating) {\r\n                delete state.ratings[data.to];\r\n            } else {\r\n                state.ratings[data.to] = data.rating;\r\n            }\r\n        },\r\n        setUserRatingInfo(state, data) {\r\n            let userIndex = state.users.findIndex(user => {\r\n                return user.uid == data.uid;\r\n            });\r\n            state.users[userIndex].avgRating = data.avgRating;\r\n            state.users[userIndex].numRatings = data.numRatings;\r\n        },\r\n        setNewUserRatingInfo(state, data) {\r\n            let userIndex = state.users.findIndex(user => {\r\n                return user.uid == data.to;\r\n            });\r\n\r\n            if (!data.rating) {\r\n                // Delete existent rating to user\r\n                let newNumRatings = state.users[userIndex].numRatings - 1;\r\n                let oldRatingTotal = state.users[userIndex].avgRating * state.users[userIndex].numRatings;\r\n                let newAvgRating;\r\n                if (newNumRatings > 0) {\r\n                    newAvgRating = (oldRatingTotal - state.ratings[data.to]) / newNumRatings;\r\n                } else {\r\n                    newAvgRating = 0;\r\n                }\r\n\r\n                state.users[userIndex].avgRating = newAvgRating;\r\n                state.users[userIndex].numRatings = newNumRatings;\r\n            } else if (!state.ratings[data.to]) {\r\n                // If first rating to user\r\n                let newNumRatings = state.users[userIndex].numRatings + 1;\r\n                let oldRatingTotal = state.users[userIndex].avgRating * state.users[userIndex].numRatings;\r\n                let newAvgRating = (oldRatingTotal + data.rating) / newNumRatings;\r\n\r\n                state.users[userIndex].avgRating = newAvgRating;\r\n                state.users[userIndex].numRatings = newNumRatings;\r\n            } else {\r\n                // If first rating to user\r\n                let newNumRatings = state.users[userIndex].numRatings;\r\n                let oldRatingTotal = state.users[userIndex].avgRating * state.users[userIndex].numRatings;\r\n                let newAvgRating = (oldRatingTotal - state.ratings[data.to] + data.rating) / newNumRatings;\r\n\r\n                state.users[userIndex].avgRating = newAvgRating;\r\n                state.users[userIndex].numRatings = newNumRatings;\r\n            }\r\n        },\r\n        setUserRatings(state, data) {\r\n            state.ratings = data;\r\n        },\r\n        setUserInfoEmail(state, email) {\r\n            state.userInfo.email = email;\r\n        },\r\n\r\n        setUserInfoChatIDs(state, chatIDs) {\r\n            state.userInfo.chatIDs = chatIDs;\r\n        },\r\n        setUserInfoChatIDsListener(state, chatIDsListener) {\r\n            state.userInfo.chatIDsListener = chatIDsListener;\r\n        },\r\n        addChatToChats(state, newChat) {\r\n            if (state.chats.findIndex(chat => {\r\n                return chat.id == newChat.id;\r\n            }) == -1) {\r\n                state.chats.push(newChat);\r\n            }\r\n        },\r\n        addUserToChatUsers(state, user) {\r\n            if (!state.userInfo.chatUsers.find(function (user2) {\r\n                return user2.chatID == user.chatID;\r\n            })) {\r\n                state.userInfo.chatUsers.push(user);\r\n            }\r\n        },\r\n        addChatIDToChatIDs(state, chatID) {\r\n            state.userInfo.chatIDs.push(chatID);\r\n        },\r\n        addMessageToChat(state, data) {\r\n            state.chats[data.chatIndex].messages.push(data.message);\r\n        },\r\n        setUserInfoUID(state, uid) {\r\n            state.userInfo.uid = uid;\r\n        },\r\n        addUserToSearchInfoUserIDs(state, user) {\r\n            state.searchInfo.userIDs.push(user);\r\n        },\r\n        addRankingInfoUserID(state, userToAddUID) {\r\n            let userIndex = state.rankingInfo.userIDs.findIndex(function (user) {\r\n                return userToAddUID == user.uid;\r\n            });\r\n\r\n            if (userIndex != 1) {\r\n                state.rankingInfo.userIDs.push(userToAddUID);\r\n            }\r\n        },\r\n        addSearchInfoUserID(state, userToAddUID) {\r\n            let userIndex = state.searchInfo.userIDs.findIndex(function (user) {\r\n                return userToAddUID == user.uid;\r\n            });\r\n\r\n            if (userIndex != 1) {\r\n                state.searchInfo.userIDs.push(userToAddUID);\r\n            }\r\n        },\r\n        setSearchInfoUserIDs(state, userIDs) {\r\n            state.searchInfo.userIDs = userIDs;\r\n        },\r\n        addEventsInfoEvent(state, event) {\r\n            state.eventsInfo.events.push(event);\r\n        },\r\n        addUser(state, userToAdd) {\r\n            let userIndex = state.users.findIndex(function (user) {\r\n                return userToAdd.uid == user.uid;\r\n            });\r\n\r\n            if (userIndex != 1) {\r\n                state.users.push(userToAdd);\r\n            } else {\r\n                Vue.set(state.users, userIndex, userToAdd)\r\n            }\r\n        },\r\n        setSearchInfoFilteringSearchByUsername(state, searchByUsername) {\r\n            state.searchInfo.filtering.searchByUsername = searchByUsername;\r\n        },\r\n        resetSearchInfo(state) {\r\n            state.searchInfo = {\r\n                lastVisible: null,\r\n                userIDs: [],\r\n                filtering: {\r\n                    genderW: true,\r\n                    genderM: true,\r\n                    ageRange: [Constants.MIN_USER_AGE, Constants.MAX_USER_AGE],\r\n                    maxDistance: 3,\r\n                    maxDistanceRanges: [1000, 5000, 10000, null],\r\n                    maxDistanceRangesText: [Constants.TEXT_1_KM, Constants.TEXT_5_KM, Constants.TEXT_10_KM, '∞'],\r\n                    searchByUsername: false,\r\n                    filterByLanguageToLearn: true,\r\n                    knownLanguage:\r\n                        {\r\n                            id: \"all\",\r\n                            text: \"Cualquier idioma\"\r\n                        },\r\n                    languageToLearn:\r\n                        {\r\n                            id: \"all\",\r\n                            text: \"Cualquier idioma\"\r\n                        },\r\n                    nearbyUsersIDs: [],\r\n                }\r\n            };\r\n        },\r\n        resetSearchInfoFiltering(state) {\r\n            state.searchInfo.filtering = {\r\n                genderW: true,\r\n                genderM: true,\r\n                ageRange: [Constants.MIN_USER_AGE, Constants.MAX_USER_AGE],\r\n                maxDistance: 3,\r\n                maxDistanceRanges: [1000, 5000, 10000, null],\r\n                maxDistanceRangesText: [Constants.TEXT_1_KM, Constants.TEXT_5_KM, Constants.TEXT_10_KM, '∞'],\r\n                searchByUsername: false,\r\n                filterByLanguageToLearn: true,\r\n                knownLanguage:\r\n                    {\r\n                        id: \"all\",\r\n                        text: \"Cualquier idioma\"\r\n                    },\r\n                languageToLearn:\r\n                    {\r\n                        id: \"all\",\r\n                        text: \"Cualquier idioma\"\r\n                    },\r\n                nearbyUsersIDs: [],\r\n            };\r\n        },\r\n        setSearchInfoLastVisible(state, lastVisible) {\r\n            state.searchInfo.lastVisible = lastVisible;\r\n        },\r\n        setRankingInfoLastVisible(state, lastVisible) {\r\n            state.rankingInfo.lastVisible = lastVisible;\r\n        },\r\n        setEventsInfoLastVisible(state, lastVisible) {\r\n            state.eventsInfo.lastVisible = lastVisible;\r\n        },\r\n        setSearchInfoFilter(state, filter) {\r\n            state.searchInfo.filter = filter;\r\n        },\r\n        setUserInfoUsername(state, username) {\r\n            state.userInfo.username = username;\r\n        },\r\n        setUserInfoName(state, name) {\r\n            state.userInfo.name = name;\r\n        },\r\n        setUserInfoLastName(state, lastName) {\r\n            state.userInfo.lastName = lastName;\r\n        },\r\n        setUserInfoBirthDate(state, birthDate) {\r\n            state.userInfo.birthDate = birthDate;\r\n        },\r\n        setUserInfoGender(state, gender) {\r\n            state.userInfo.gender = gender;\r\n        },\r\n        setUserInfoAvgRating(state, avgRating) {\r\n            state.userInfo.avgRating = avgRating;\r\n        },\r\n        setUserInfoNumRatings(state, numRatings) {\r\n            state.userInfo.numRatings = numRatings;\r\n        },\r\n        setSearchedUserAvgRating(state, data) {\r\n            let userIndex = state.searchInfo.userIDs.findIndex(user => {\r\n                return user.uid == data.uid;\r\n            });\r\n\r\n            state.searchInfo.userIDs[userIndex].avgRating = data.avgRating;\r\n        },\r\n        setSearchedUserNumRatings(state, data) {\r\n            let userIndex = state.searchInfo.userIDs.findIndex(user => {\r\n                return user.uid == data.uid;\r\n            });\r\n\r\n            state.searchInfo.userIDs[userIndex].numRatings = data.numRatings;\r\n        },\r\n        setUserInfoDescription(state, description) {\r\n            state.userInfo.description = description;\r\n        },\r\n        setUserInfoProfileImage(state, profileImage) {\r\n            state.userInfo.profileImage = profileImage;\r\n        },\r\n        setUserInfoKnownLanguages(state, knownLanguages) {\r\n            state.userInfo.knownLanguages = knownLanguages;\r\n        },\r\n        setUserInfoLanguagesToLearn(state, languagesToLearn) {\r\n            state.userInfo.languagesToLearn = languagesToLearn;\r\n        },\r\n        setRegistrationState(state, st) {\r\n            state.userInfo.registrationState = st;\r\n        },\r\n        setChatWithUser(state, data) {\r\n            state.chatWithUser = data;\r\n        },\r\n        setChatsInfoActiveChat(state, data) {\r\n            state.chatsInfo.activeChat = data;\r\n        },\r\n        setActiveEventID(state, eventID) {\r\n            state.activeEventID = eventID;\r\n        },\r\n        setMessageToRead(state, data) {\r\n            let chatIndex = state.chats.findIndex(chat => {\r\n                return chat.id == data.chatID;\r\n            });\r\n\r\n            if (chatIndex != -1) {\r\n                let messageIndex = state.chats[chatIndex].messages.findIndex(message => {\r\n                    return message.id = data.messageID;\r\n                });\r\n                state.chats[chatIndex].messages[messageIndex].read = true;\r\n            }\r\n        },\r\n        closeAllChatListenersFirebase(state) {\r\n            state.chats.forEach(chat => {\r\n                chat.databaseListener();\r\n            });\r\n        },\r\n        addNewMessage(state, data) {\r\n            let chatIndex = state.chats.findIndex(chat => {\r\n                return chat.id == data.chatID;\r\n            });\r\n\r\n            let messageIndex = state.chats[chatIndex].messages.findIndex(message => {\r\n                return message.id == data.message.id;\r\n            });\r\n            if (messageIndex == -1) {\r\n                if (data.message.created == null) {\r\n                    state.chats[chatIndex].messages.splice(state.chats[chatIndex].messages.length, 0, data.message);\r\n                } else {\r\n                    let messageIndex2 = state.chats[chatIndex].messages.findIndex(message => {\r\n                        return message.created.toDate().getTime() > data.message.created.toDate().getTime();\r\n                    });\r\n                    if (messageIndex2 == -1) {\r\n                        state.chats[chatIndex].messages.push(data.message);\r\n                    } else {\r\n                        state.chats[chatIndex].messages.splice(messageIndex2, 0, data.message);\r\n                    }\r\n                }\r\n\r\n            } else {\r\n                /*state.chats[chatIndex].messages[messageIndex] = data.message;*/\r\n                Vue.set(state.chats[chatIndex].messages, messageIndex, data.message)\r\n            }\r\n\r\n        },\r\n        resetChat(state) {\r\n            state.chats = [];\r\n            state.chatWithUser = null;\r\n\r\n        },\r\n    },\r\n    actions: {\r\n\r\n        isUsernameInUseFirebase(context, username) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                // Is username registered?\r\n                firestoreDB.collection(\"UsersPublicInfo\").where(\"username\", \"==\", username).get()\r\n                    .then((querySnapshot) => {\r\n                        if (querySnapshot.size > 0) {\r\n                            if (firebase.auth().currentUser.uid == querySnapshot.docs[0].id) {\r\n                                resolve(false);\r\n                            } else {\r\n                                resolve(true);\r\n                            }\r\n                        } else {\r\n                            resolve(false);\r\n                        }\r\n                    })\r\n                    .catch((error) => {\r\n                        console.error(error);\r\n                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n        /*setUserUsernameFirebase(context, username) {\r\n          return new Promise(function (resolve, reject) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            firestoreDB.collection(\"UsersPublicInfo\").doc(firebase.auth().currentUser.uid).set(\r\n                {\r\n                  username: username\r\n                }\r\n            )\r\n                .then(() => {\r\n                  console.log(\"Username successfully written in users\");\r\n                  context.commit('setUserInfoUsername', username);\r\n                  resolve();\r\n                })\r\n                .catch(function (error) {\r\n                  console.error(\"Error writing username in users: \", error);\r\n                  reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM)\r\n                });\r\n          });\r\n        },*/\r\n        setUserPersistanceFirebase(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL)\r\n                    .then(() => {\r\n                        context.commit('setUserInfoUID', firebase.auth().currentUser.uid);\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        console.error(error)\r\n                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n        registerUserFirebase: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                    if (!context.state.userInfo.registrationState) {\r\n                        firebase.auth().createUserWithEmailAndPassword(data.email, data.password)\r\n                            .then(() => {\r\n                                console.log(\"Success registering user in system.\");\r\n                                context.dispatch('setUserPersistanceFirebase')\r\n                                    .then(() => {\r\n                                        context.dispatch('setUserPrivateInfoFirebase', data).then(() => {\r\n                                            resolve();\r\n                                        })\r\n                                            .catch((error) => {\r\n                                                reject(error);\r\n                                            });\r\n                                    })\r\n                                    .catch((error) => {\r\n                                        context.dispatch('logoutUserFirebase').then(() => {\r\n                                            reject(error);\r\n                                        }).catch(() => {\r\n                                            reject(error);\r\n                                        });\r\n                                    });\r\n                            })\r\n                            .catch((error) => {\r\n                                console.log(error);\r\n                                if (error.code == 'auth/email-already-in-use') {\r\n                                    reject(Constants.ERROR_ALREADY_AN_ACCOUNT_WITH_THIS_EMAIL);\r\n                                } else {\r\n                                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                                }\r\n                            });\r\n                    } else {\r\n                        context.dispatch('setUserPersistanceFirebase')\r\n                            .then(() => {\r\n                                context.dispatch('setUserUsernameFirebase', data.username)\r\n                                    .then(() => {\r\n                                        resolve();\r\n                                    })\r\n                                    .catch((error) => {\r\n                                        reject(error);\r\n                                    })\r\n                            })\r\n                            .catch((error) => {\r\n                                reject(error);\r\n                            });\r\n                    }\r\n                }\r\n            );\r\n        },\r\n        logoutUserFirebase: function (context) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                if (firebase.auth() != null) {\r\n                    context.commit('closeAllChatListenersFirebase');\r\n\r\n                    firebase.auth().signOut()\r\n                        .then(() => {\r\n                            console.log(\"User logged out correctly!\");\r\n                            context.commit('resetChat');\r\n                            resolve();\r\n                        })\r\n                        .catch(err => {\r\n                            console.error(err);\r\n                            reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                        });\r\n                }\r\n            });\r\n        },\r\n\r\n        setUserPrivateInfoFirebase: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                firestoreDB.collection(\"UsersPrivateInfo\").doc(firebase.auth().currentUser.uid).set(\r\n                    {\r\n                        email: data.email,\r\n                        name: data.name,\r\n                        lastName: data.lastName,\r\n                        registrationState: 'registered'\r\n                    },\r\n                    {merge: true}\r\n                )\r\n                    .then(() => {\r\n                        console.log(\"Private info successfully written\");\r\n                        context.commit('setRegistrationState', 'registered');\r\n                        context.commit('setUserInfoEmail', data.email);\r\n                        context.commit('setUserInfoName', data.name);\r\n                        context.commit('setUserInfoLastName', data.lastName);\r\n                        resolve();\r\n                    })\r\n                    .catch(function (error) {\r\n                        console.error(\"Error writing private info: \", error);\r\n                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n\r\n        setUserPrivateInfoRegistrationStateFirebase: function (context, st) {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                firestoreDB.collection(\"UsersPrivateInfo\").doc(firebase.auth().currentUser.uid).set(\r\n                    {\r\n                        registrationState: st\r\n                    },\r\n                    {merge: true}\r\n                )\r\n                    .then(() => {\r\n                        console.log(\"Registration state successfully written\");\r\n                        context.commit('setRegistrationState', st);\r\n                        resolve();\r\n                    })\r\n                    .catch(function (error) {\r\n                        console.error(\"Error writing registration state info: \", error);\r\n                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n\r\n        sendEmailVerificationFirebase: function () {\r\n            return new Promise(function (resolve, reject) {\r\n                firebase.auth().currentUser.sendEmailVerification().then(function () {\r\n                    console.log('verification sent: ');\r\n                    resolve();\r\n                }, function (error) {\r\n                    console.log('verification not sent: ' + error.message);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n        checkEmailVerifiedFirebase: function (context) {\r\n            return new Promise(function (resolve, reject) {\r\n                firebase.auth().currentUser.reload().then(() => {\r\n                    if (firebase.auth().currentUser.emailVerified) {\r\n                        console.log(\"Email is verified\");\r\n                        context.dispatch('setUserPrivateInfoRegistrationStateFirebase', 'emailVerified')\r\n                            .then(() => {\r\n                                resolve(true);\r\n                            })\r\n                            .catch((error) => {\r\n                                reject(error);\r\n                            });\r\n                    }\r\n                }).catch((error) => {\r\n                    console.error(error)\r\n                    reject(error);\r\n                });\r\n            });\r\n        },\r\n        setUserProfileInfoFirebase: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                firestoreDB.collection(\"UsersPublicInfo\").doc(firebase.auth().currentUser.uid).set(\r\n                    {\r\n                        username: data.username.toLowerCase(),\r\n                        birthDate: new Date(data.birthDate),\r\n                        gender: data.gender,\r\n                        description: data.description,\r\n                        avgRating: 0,\r\n                        numRatings: 0\r\n                    },\r\n                    {merge: true}\r\n                )\r\n                    .then(() => {\r\n                        console.log(\"Profile info successfully written in users\");\r\n                        context.dispatch('setUserPrivateInfoRegistrationStateFirebase', 'profileInfoFilled')\r\n                            .then(() => {\r\n                                context.commit('setUserInfoUsername', data.username);\r\n                                context.commit('setUserInfoBirthDate', data.birthDate);\r\n                                context.commit('setUserInfoGender', data.gender);\r\n                                context.commit('setUserInfoDescription', data.description);\r\n                                resolve();\r\n                            })\r\n                            .catch((error) => {\r\n                                reject(error);\r\n                            });\r\n                        resolve();\r\n                    })\r\n                    .catch(function (error) {\r\n                        console.error(\"Error writing profile info in users: \", error);\r\n                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n        setUserLanguagesFirebase: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n                let knownLanguagesDB = [];\r\n                let languagesToLearnDB = [];\r\n                console.log(data);\r\n                for (let i = 0; i < data.knownLanguages.length; i++) {\r\n                    knownLanguagesDB.push(data.knownLanguages[i].id);\r\n                }\r\n                for (let i = 0; i < data.languagesToLearn.length; i++) {\r\n                    languagesToLearnDB.push(data.languagesToLearn[i].id);\r\n                }\r\n                firestoreDB.collection(\"UsersPublicInfo\").doc(firebase.auth().currentUser.uid).set(\r\n                    {\r\n                        knownLanguages: knownLanguagesDB,\r\n                        languagesToLearn: languagesToLearnDB\r\n                    },\r\n                    {merge: true}\r\n                )\r\n                    .then(() => {\r\n                        console.log(\"Languages info successfully written in users\");\r\n                        context.dispatch('setUserPrivateInfoRegistrationStateFirebase', 'languagesFilled')\r\n                            .then(() => {\r\n                                context.commit('setUserInfoKnownLanguages', knownLanguagesDB);\r\n                                context.commit('setUserInfoLanguagesToLearn', languagesToLearnDB);\r\n                                resolve();\r\n                            })\r\n                            .catch((error) => {\r\n                                reject(error);\r\n                            });\r\n                    })\r\n                    .catch(function (error) {\r\n                        console.error(\"Error writing languages info in users: \", error);\r\n                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                    });\r\n            });\r\n        }\r\n        ,\r\n        setUserProfileImageDatabase: function (context, imageUpload) {\r\n            return new Promise(function (resolve, reject) {\r\n                Vue.nextTick(() => {\r\n                    let firestoreDB = firebase.firestore();\r\n                    let userID = firebase.auth().currentUser.uid;\r\n                    let storageDB = firebase.storage().ref().child(\"UserProfileImages/\" + userID);\r\n                    storageDB.putString(imageUpload, 'base64')\r\n                        .then(() => {\r\n                            console.log('User profile image uploaded');\r\n                            storageDB.getDownloadURL().then((url) => {\r\n                                firestoreDB.collection(\"UsersPublicInfo\").doc(userID).set(\r\n                                    {\r\n                                        profileImage: url\r\n                                    },\r\n                                    {merge: true}\r\n                                )\r\n                                    .then(() => {\r\n                                        console.log(\"User profile image url successfully written\");\r\n                                        context.dispatch('setUserPrivateInfoRegistrationStateFirebase', 'registered')\r\n                                            .then(() => {\r\n                                                context.commit('setUserInfoProfileImage', url);\r\n                                                resolve();\r\n                                            })\r\n                                            .catch((error) => {\r\n                                                reject(error);\r\n                                            });\r\n                                    })\r\n                                    .catch(function (error) {\r\n                                        console.error(\"Error writing user profile image url info in users: \", error);\r\n                                        context.dispatch('deleteUserProfileImageDatabase', userID);\r\n                                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                                    });\r\n                            })\r\n                        })\r\n                        .catch(() => {\r\n                            reject(Constants.ERROR_UPLOADING_IMAGE);\r\n                        });\r\n                });\r\n            });\r\n        }\r\n        ,\r\n        deleteUserProfileImageDatabase: function (context, userID) {\r\n            return new Promise(function (resolve, reject) {\r\n                let storageDB = firebase.storage().ref().child(\"UserProfileImages/\" + userID);\r\n                storageDB.delete().then(function () {\r\n                    console.log(\"User profile image removed from database storage\");\r\n                    context.commit('setUserInfoProfileImage', null);\r\n                    resolve();\r\n                }).catch(function (error) {\r\n                    console.error(error);\r\n                    reject(Constants.ERROR_SOMETHING_HAPPENED);\r\n                });\r\n\r\n            });\r\n        },\r\n        loginUserFirebase: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                firebase.auth().signInWithEmailAndPassword(data.email, data.password)\r\n                    .then((success) => {\r\n                        console.log(\"Success logging user in system.\");\r\n                        context.dispatch('setUserPersistanceFirebase')\r\n                            .then(() => {\r\n                                context.dispatch('getUserPrivateInfo').then(() => {\r\n                                    console.log(\"Success UserPrivateInfo retrieved.\");\r\n\r\n                                    context.dispatch('getUserPublicInfo').then(() => {\r\n                                        console.log(\"Success UserPublicInfo retrieved.\");\r\n                                        context.dispatch('getRatingsInRatingsFirebase')\r\n                                            .then(() => {\r\n                                                resolve(success);\r\n                                            })\r\n                                            .catch((error) => {\r\n                                                console.error(error);\r\n                                                reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                                            });\r\n\r\n                                    })\r\n                                        .catch((error) => {\r\n                                            reject(error);\r\n                                        });\r\n\r\n                                })\r\n                                    .catch((error) => {\r\n                                        reject(error);\r\n                                    });\r\n                            })\r\n                            .catch((error) => {\r\n                                context.dispatch('logoutUserFirebase').then(() => {\r\n                                    reject(error);\r\n                                }).catch(() => {\r\n                                    reject(error);\r\n                                });\r\n                            });\r\n                    })\r\n                    .catch((error) => {\r\n                        console.log(error);\r\n                        if (error.code == 'auth/wrong-password') {\r\n                            reject(Constants.ERROR_WRONG_EMAIL_PASSWORD_COMBINATION);\r\n                        } else {\r\n                            reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                        }\r\n                    });\r\n            });\r\n        },\r\n        getAppInfoForLoggedUserFirebase: function (context) {\r\n            context.commit('resetUserInfo');\r\n            context.commit('resetChatsInfoActiveChat');\r\n            context.commit('resetChats');\r\n            context.commit('resetRatings');\r\n\r\n            context.commit('setUserInfoUID', firebase.auth().currentUser.uid);\r\n\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('getUserPrivateInfo').then(() => {\r\n                    console.log(\"Success UserPrivateInfo retrieved.\");\r\n\r\n                    context.dispatch('getUserPublicInfo').then(() => {\r\n                        console.log(\"Success UserPublicInfo retrieved.\");\r\n                        context.dispatch('getRatingsInRatingsFirebase')\r\n                            .then(() => {\r\n                                context.dispatch('getUserLocation')\r\n                                    .then(() => {\r\n                                        resolve()\r\n                                    })\r\n                                    .catch((error) => {\r\n                                        console.error(error);\r\n                                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                                    });\r\n                                resolve();\r\n                            })\r\n                            .catch((error) => {\r\n                                console.error(error);\r\n                                reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                            });\r\n\r\n                    })\r\n                        .catch((error) => {\r\n                            reject(error);\r\n                        });\r\n\r\n                })\r\n                    .catch((error) => {\r\n                        reject(error);\r\n                    });\r\n            })\r\n\r\n        },\r\n        getUserPrivateInfo: function (context) {\r\n\r\n            return new Promise(function (resolve, reject) {\r\n\r\n\r\n                let firestoreDB = firebase.firestore();\r\n                let userID = firebase.auth().currentUser.uid;\r\n\r\n                firestoreDB.collection(\"UsersPrivateInfo\").doc(userID).get().then(function (doc) {\r\n                    if (doc.exists) {\r\n                        context.commit('setRegistrationState', doc.data().registrationState);\r\n                        context.commit('setUserInfoEmail', doc.data().email);\r\n                        context.commit('setUserInfoName', doc.data().name);\r\n                        context.commit('setUserInfoLastName', doc.data().lastName);\r\n                        resolve();\r\n                    } else {\r\n                        console.warn(\"No such document!\");\r\n                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                    }\r\n                }).catch(function (error) {\r\n                    console.warn(\"Error getting document:\", error);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n        getUserPublicInfoDocByUIDFirebase: function (context, uid) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                firestoreDB.collection(\"UsersPublicInfo\").doc(uid).get().then(function (userDoc) {\r\n                    resolve(userDoc);\r\n                })\r\n                    .catch(function (error) {\r\n                        console.warn(\"Error getting document:\", error);\r\n                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n\r\n                    });\r\n            });\r\n        },\r\n        getUserPublicInfo: function (context) {\r\n            return new Promise(function (resolve, reject) {\r\n                let userID = firebase.auth().currentUser.uid;\r\n\r\n                context.dispatch('getUserPublicInfoDocByUIDFirebase', userID).then(function (userDoc) {\r\n                    if (userDoc.exists) {\r\n                        context.commit('setUserInfoUsername', userDoc.data().username);\r\n                        context.commit('setUserInfoBirthDate', userDoc.data().birthDate);\r\n                        context.commit('setUserInfoGender', userDoc.data().gender);\r\n                        context.commit('setUserInfoDescription', userDoc.data().description);\r\n                        context.commit('setUserInfoKnownLanguages', userDoc.data().knownLanguages);\r\n                        context.commit('setUserInfoLanguagesToLearn', userDoc.data().languagesToLearn);\r\n                        context.commit('setUserInfoProfileImage', userDoc.data().profileImage);\r\n                        context.commit('setUserInfoAvgRating', userDoc.data().avgRating);\r\n                        context.commit('setUserInfoNumRatings', userDoc.data().numRatings);\r\n\r\n                        context.dispatch('createChatIDsListenerFirebase')\r\n                            .then(() => {\r\n                                let userChats = userDoc.data().chats;\r\n\r\n                                try {\r\n                                    let promises = [];\r\n                                    userChats.forEach(chatID => {\r\n                                        promises.push(context.dispatch('createChatListenerFirebase', chatID));\r\n                                    });\r\n                                    Promise.all(promises).then(function () {\r\n                                        resolve();\r\n                                    })\r\n                                        .catch(function (error) {\r\n                                            reject(error);\r\n                                        });\r\n                                } catch (e) {\r\n                                    console.error(e);\r\n                                    reject(e);\r\n                                }\r\n                            })\r\n                            .catch((error) => {\r\n                                console.error(error);\r\n                                reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                            });\r\n                    } else {\r\n                        console.warn(\"No such document!\");\r\n                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                    }\r\n                }).catch(function (error) {\r\n                    console.warn(\"Error getting document:\", error);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n        createChatIDsListenerFirebase: function (context) {\r\n            let firestoreDB = firebase.firestore();\r\n            return new Promise(function (resolve, reject) {\r\n                try {\r\n                    let docRef = firestoreDB.collection(\"UsersPublicInfo\").doc(firebase.auth().currentUser.uid)\r\n                        .onSnapshot(function (chatIDs) {\r\n                            if (chatIDs) {\r\n                                context.commit('setUserInfoChatIDs', chatIDs.data().chats);\r\n                                context.commit('setUserInfoChatIDsListener', docRef);\r\n                            }\r\n                            resolve();\r\n                        })\r\n                } catch (e) {\r\n                    console.error(e);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                }\r\n            });\r\n        }\r\n        ,\r\n        setChatWithUserMessagesToRead: function (context, chatID) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                let chatIndex = context.state.chats.findIndex(chat => {\r\n                    return chat.id == chatID;\r\n                });\r\n\r\n                let promises = [];\r\n\r\n                context.state.chats[chatIndex].messages.forEach(message => {\r\n                    if (!message.read && message.sender != context.state.userInfo.uid) {\r\n                        promises.push(firestoreDB.collection(\"Chats\").doc(chatID).collection(\"Messages\").doc(message.id).update(\r\n                            {\r\n                                'read': true\r\n                            })\r\n                            .then(() => {\r\n                                console.log(\"Message successfully updated read state \");\r\n                                /*let setMessageToReadData =\r\n                                    {\r\n                                        'chatID': chatID,\r\n                                        'messageID': message.id\r\n                                    };\r\n                                context.commit('setMessageToRead', setMessageToReadData);*/\r\n                            })\r\n                            .catch(function (error) {\r\n                                console.error(\"Error updating message read state: \", error);\r\n                                reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                            }));\r\n                    }\r\n                });\r\n\r\n                Promise.all(promises).then(function () {\r\n                    resolve();\r\n                })\r\n                    .catch(function () {\r\n                        console.error(\"Error updating messages read state: \");\r\n                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n        sendChatMessageFirebase: function (context, data) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                let chatIndex = context.state.chats.findIndex(chat => {\r\n                    return chat.id == data.chatID;\r\n                });\r\n\r\n\r\n                let messageIndex = context.state.chats[chatIndex].messages.length;\r\n\r\n\r\n                let newMessage = {\r\n                    'created': firebase.firestore.FieldValue.serverTimestamp(),\r\n                    'text': data.messageText,\r\n                    'read': false,\r\n                    'sender': context.state.userInfo.uid,\r\n                    /*'id': messageIndex.toString() + context.state.userInfo.uid,*/\r\n                };\r\n\r\n                let promises = [];\r\n                if (messageIndex == 0) {\r\n                    let chatID;\r\n                    let myUID = context.state.userInfo.uid;\r\n                    let otherUserUID = context.getters.getOtherUserInChatByChatID(data.chatID);\r\n\r\n                    if (myUID < otherUserUID) {\r\n                        chatID = myUID + otherUserUID;\r\n                    } else {\r\n                        chatID = otherUserUID + myUID;\r\n                    }\r\n\r\n                    promises.push(firestoreDB.collection(\"UsersPublicInfo\").doc(myUID).update(\r\n                        {\r\n                            'chats': firebase.firestore.FieldValue.arrayUnion(chatID),\r\n                        }\r\n                    )\r\n                        .then(() => {\r\n                            context.commit(\"addChatIDToChatIDs\", chatID);\r\n                            console.log(\"chatID successfuly written p1\")\r\n                        })\r\n                        .catch(function (error) {\r\n                            console.error(\"Error writing chatID\", error);\r\n                            reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                        }));\r\n\r\n                    promises.push(firestoreDB.collection(\"UsersPublicInfo\").doc(otherUserUID).update(\r\n                        {\r\n                            'chats': firebase.firestore.FieldValue.arrayUnion(chatID),\r\n                        }\r\n                    ).then(() => {\r\n                        console.log(\"chatID successfuly written p2\")\r\n                    })\r\n                        .catch(function (error) {\r\n                            console.error(\"Error writing chatID\", error);\r\n                            reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                        }));\r\n                }\r\n\r\n                Promise.all(promises).then(function () {\r\n\r\n                    firestoreDB.collection(\"Chats\").doc(data.chatID).collection(\"Messages\").doc().set(newMessage)\r\n                        .then(() => {\r\n                            console.log(\"Message successfully added\");\r\n                            resolve();\r\n                        })\r\n                        .catch(function (error) {\r\n                            console.error(\"Error adding message\", error);\r\n                            reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                        });\r\n                })\r\n                    .catch(function (error) {\r\n                        console.error(\"Error writing chatID on users chatIDs: \" + error);\r\n                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                    });\r\n\r\n\r\n            });\r\n        }\r\n        ,\r\n\r\n        /*setChatMessageFirebase: function (context, data) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                firestoreDB.collection(\"UsersPrivateInfo\").doc(data.chatID).get().then(function (doc) {\r\n                    if (doc.exists) {\r\n                        context.commit('setRegistrationState', doc.data().registrationState);\r\n                        context.commit('setUserInfoEmail', doc.data().email);\r\n                        context.commit('setUserInfoName', doc.data().name);\r\n                        context.commit('setUserInfoLastName', doc.data().lastName);\r\n                        context.commit('setUserInfoChatIDs', doc.data().chats);\r\n                        resolve();\r\n                    } else {\r\n                        console.warn(\"No such document!\");\r\n                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                    }\r\n                }).catch(function (error) {\r\n                    console.warn(\"Error getting document:\", error);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                });\r\n            });\r\n        },*/\r\n        listUsersSearchedPageFirebase: function (context, data) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                if (data.first) {\r\n                    context.commit('setSearchInfoUserIDs', []);\r\n                    context.commit('setSearchInfoLastVisible', null);\r\n                }\r\n\r\n                let page = firestoreDB.collection(\"UsersPublicInfo\");\r\n\r\n                //GENDER FILTERING\r\n                if (context.state.searchInfo.filtering.genderM && !context.state.searchInfo.filtering.genderW) {\r\n                    page = page.where(Constants.DATABASE_GENDER_FIELD, \"==\", \"M\");\r\n                } else if (context.state.searchInfo.filtering.genderW && !context.state.searchInfo.filtering.genderM) {\r\n                    page = page.where(Constants.DATABASE_GENDER_FIELD, \"==\", \"W\");\r\n                } else if (!context.state.searchInfo.filtering.genderW && !context.state.searchInfo.filtering.genderM) {\r\n                    context.commit('setSearchInfoUserIDs', []);\r\n                    context.commit('setSearchInfoLastVisible', null);\r\n                }\r\n\r\n                //AGE FILTERING\r\n                let currentDate = new Date();\r\n                currentDate.setFullYear(currentDate.getFullYear() - context.state.searchInfo.filtering.ageRange[0]);\r\n                currentDate.setHours(0, 0, 0)\r\n                /*currentDate.setMonth(currentDate.getMonth()-context.state.searchInfo.filtering.ageRange[0]);\r\n                currentDate.setDate(currentDate.getDate()-context.state.searchInfo.filtering.ageRange[0]);\r\n                console.log(currentDate.toISOString().substr(0, 10));*/\r\n                page = page.where(Constants.DATABASE_BIRTHDATE_FIELD, \"<\", currentDate);\r\n                currentDate = new Date();\r\n                currentDate.setFullYear(currentDate.getFullYear() - context.state.searchInfo.filtering.ageRange[1] - 1);\r\n                currentDate.setHours(0, 0, 0)\r\n                page = page.where(Constants.DATABASE_BIRTHDATE_FIELD, \">\", currentDate);\r\n\r\n                //LANGUAGES FILTERING\r\n                if (context.state.searchInfo.filtering.filterByLanguageToLearn && context.state.searchInfo.filtering.languageToLearn.id != \"all\") {\r\n                    page = page.where(Constants.DATABASE_LANGUAGES_TO_LEARN_FIELD, \"array-contains\", context.state.searchInfo.filtering.languageToLearn.id);\r\n                } else if (!context.state.searchInfo.filtering.filterByLanguageToLearn && context.state.searchInfo.filtering.knownLanguage.id != \"all\") {\r\n                    page = page.where(Constants.DATABASE_KNOWN_LANGUAGES_FIELD, \"array-contains\", context.state.searchInfo.filtering.knownLanguage.id);\r\n                }\r\n\r\n                let page2 = page.orderBy(data.orderBy).startAfter(context.state.searchInfo.lastVisible).limit(Constants.SEARCHED_USERS_PAGE_SIZE);\r\n                page2.get().then(function (documentSnapshots) {\r\n                    let searchedUserIndex = documentSnapshots.docs.findIndex(function (searchedUser) {\r\n                        return searchedUser.id == context.state.userInfo.uid;\r\n                    });\r\n\r\n\r\n                    let newDocs = documentSnapshots.docs;\r\n                    if (searchedUserIndex != -1) {\r\n                        newDocs.splice(searchedUserIndex, 1);\r\n                        let lastVisible2 = documentSnapshots.docs[documentSnapshots.docs.length - 1];\r\n                        context.commit('setSearchInfoLastVisible', lastVisible2);\r\n                        let page3 = page.orderBy(data.orderBy).startAfter(context.state.searchInfo.lastVisible).limit(1);\r\n                        page3.get().then(function (documentSnapshots2) {\r\n                            newDocs.push(documentSnapshots2.docs[0]);\r\n\r\n                            context.dispatch('setSearchedUsersState', {\r\n                                newDocs: newDocs,\r\n                                originalDocs: documentSnapshots2.docs\r\n                            }).then(function () {\r\n                                resolve();\r\n                            });\r\n                        })\r\n                            .catch(function (error) {\r\n                                console.warn(\"Error fetching page: \", error);\r\n                                reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                            });\r\n                    } else {\r\n                        context.dispatch('setSearchedUsersState', {\r\n                            newDocs: newDocs,\r\n                            originalDocs: documentSnapshots.docs\r\n                        }).then(function () {\r\n                            resolve();\r\n                        })\r\n\r\n                    }\r\n                }).catch(function (error) {\r\n                    console.warn(\"Error fetching page: \", error);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n\r\n        setSearchedUsersState(context, data) {\r\n            return new Promise(function (resolve) {\r\n                let usersRetrieved = data.newDocs.map(doc => {\r\n                    const uid = doc.id;\r\n                    const dataDocs = doc.data();\r\n                    return {uid, ...dataDocs};\r\n\r\n                });\r\n\r\n\r\n                usersRetrieved.forEach(function (user) {\r\n                    context.commit('addUser', user);\r\n                    context.commit('addSearchInfoUserID', user.uid);\r\n                });\r\n\r\n\r\n                if (data.originalDocs.length > 0) {\r\n                    let lastVisible2 = data.originalDocs[data.originalDocs.length - 1];\r\n                    context.commit('setSearchInfoLastVisible', lastVisible2);\r\n                } else {\r\n                    context.commit('setSearchInfoUserIDs', []);\r\n                    context.commit('setSearchInfoLastVisible', null);\r\n                }\r\n\r\n                resolve();\r\n            });\r\n        },\r\n        isNextUsersSearchedPageEmptyFirebase(context, data) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                let page = firestoreDB.collection(\"UsersPublicInfo\");\r\n\r\n                //GENDER FILTERING\r\n                if (context.state.searchInfo.filtering.genderM && !context.state.searchInfo.filtering.genderW) {\r\n                    page = page.where(Constants.DATABASE_GENDER_FIELD, \"==\", \"M\");\r\n                } else if (context.state.searchInfo.filtering.genderW && !context.state.searchInfo.filtering.genderM) {\r\n                    page = page.where(Constants.DATABASE_GENDER_FIELD, \"==\", \"W\");\r\n                } else if (!context.state.searchInfo.filtering.genderW && !context.state.searchInfo.filtering.genderM) {\r\n                    context.commit('setSearchInfoUserIDs', []);\r\n                    context.commit('setSearchInfoLastVisible', null);\r\n\r\n                    resolve(true)\r\n                }\r\n\r\n                //AGE FILTERING\r\n                let currentDate = new Date();\r\n                currentDate.setFullYear(currentDate.getFullYear() - context.state.searchInfo.filtering.ageRange[0]);\r\n                currentDate.setHours(0, 0, 0)\r\n                /*currentDate.setMonth(currentDate.getMonth()-context.state.searchInfo.filtering.ageRange[0]);\r\n                currentDate.setDate(currentDate.getDate()-context.state.searchInfo.filtering.ageRange[0]);\r\n                console.log(currentDate.toISOString().substr(0, 10));*/\r\n                page = page.where(Constants.DATABASE_BIRTHDATE_FIELD, \"<\", currentDate);\r\n                currentDate = new Date();\r\n                currentDate.setFullYear(currentDate.getFullYear() - context.state.searchInfo.filtering.ageRange[1] - 1);\r\n                currentDate.setHours(0, 0, 0)\r\n                page = page.where(Constants.DATABASE_BIRTHDATE_FIELD, \">\", currentDate);\r\n\r\n                //LANGUAGES FILTERING\r\n                if (context.state.searchInfo.filtering.filterByLanguageToLearn && context.state.searchInfo.filtering.languageToLearn.id != \"all\") {\r\n                    page = page.where(Constants.DATABASE_LANGUAGES_TO_LEARN_FIELD, \"array-contains\", context.state.searchInfo.filtering.languageToLearn.id);\r\n                } else if (!context.state.searchInfo.filtering.filterByLanguageToLearn && context.state.searchInfo.filtering.knownLanguage.id != \"all\") {\r\n                    page = page.where(Constants.DATABASE_KNOWN_LANGUAGES_FIELD, \"array-contains\", context.state.searchInfo.filtering.knownLanguage.id);\r\n                    console.log(context.state.searchInfo.filtering.knownLanguage.id)\r\n                }\r\n\r\n                page.orderBy(data.orderBy).startAfter(context.state.searchInfo.lastVisible).limit(Constants.SEARCHED_USERS_PAGE_SIZE).get()\r\n                    .then(function (documentSnapshots) {\r\n                        let searchedUserIndex = documentSnapshots.docs.findIndex(function (searchedUser) {\r\n                            return searchedUser.id == context.state.userInfo.uid;\r\n                        });\r\n\r\n                        let newDocs = documentSnapshots.docs;\r\n                        if (searchedUserIndex != -1) {\r\n                            newDocs.splice(searchedUserIndex, 1);\r\n\r\n                        }\r\n\r\n                        resolve(newDocs.length == 0);\r\n\r\n                    }).catch((error) => {\r\n                    console.log(error);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                });\r\n            });\r\n\r\n        },\r\n        searchUsersByUsernameFirebase: function (context, data) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                context.commit('resetSearchInfo');\r\n                context.commit('setSearchInfoFilteringSearchByUsername', true);\r\n\r\n                let page = firestoreDB.collection(\"UsersPublicInfo\").orderBy(data.orderBy).startAt(data.searchByUsernameField).endAt(data.searchByUsernameField + \"\\uf8ff\");\r\n\r\n                page.get().then(function (documentSnapshots) {\r\n                    let searchedUserIndex = documentSnapshots.docs.findIndex(function (searchedUser) {\r\n                        return searchedUser.id == context.state.userInfo.uid;\r\n                    });\r\n\r\n                    if (searchedUserIndex != 1) {\r\n                        documentSnapshots.docs.splice(searchedUserIndex, 1);\r\n                    }\r\n\r\n                    let usersRetrieved = documentSnapshots.docs.map(doc => {\r\n                        const uid = doc.id\r\n                        const dataDocs = doc.data()\r\n                        return {uid, ...dataDocs}\r\n\r\n                    });\r\n\r\n                    let userIDs = [];\r\n                    usersRetrieved.forEach(function (user) {\r\n                        context.commit('addUser', user);\r\n                        userIDs.push(user.uid)\r\n                    });\r\n\r\n                    context.commit('setSearchInfoUserIDs', userIDs);\r\n\r\n\r\n                    if (documentSnapshots.docs.length > 0) {\r\n                        let lastVisible2 = documentSnapshots.docs[documentSnapshots.docs.length - 1];\r\n                        context.commit('setSearchInfoLastVisible', lastVisible2);\r\n                    }\r\n                    resolve();\r\n                }).catch(function (error) {\r\n                    console.warn(\"Error fetching users: \", error);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                });\r\n            });\r\n        }\r\n        ,\r\n\r\n        prepareChatWithUser: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                // if it does not exist a chat between this users yet\r\n                context.dispatch('createChatFirebase', {\r\n                    chatID: data.chatID,\r\n                    userID: data.userID\r\n                })\r\n                    .then(() => {\r\n                        context.commit('setChatsInfoActiveChat', data.chatID);\r\n                        resolve();\r\n                    })\r\n                    .catch((error) => {\r\n                        console.error(error);\r\n                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                    });\r\n\r\n                //context.commit('setChatWithUser', chat);\r\n            });\r\n            /*let user = context.getters.getSearchInfoUserByUID(data.userID);*/\r\n\r\n\r\n        },\r\n\r\n        createChatFirebase: function (context, data) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                let newChat = {\r\n                    'messages': [],\r\n                    'users': [context.state.userInfo.uid, data.userID]\r\n                };\r\n\r\n                firestoreDB.collection(\"Chats\").doc(data.chatID).set(newChat)\r\n                    .then(() => {\r\n                        console.log(\"Chats info successfully written in Chats\");\r\n                        context.dispatch('createChatListenerFirebase', data.chatID).then(() => {\r\n                            resolve();\r\n                        })\r\n                            .catch(function (error) {\r\n                                reject(error);\r\n                            });\r\n                    })\r\n                    .catch(function (error) {\r\n                        console.error(\"Error writing profile info in users: \", error);\r\n                        reject(error);\r\n                    });\r\n\r\n\r\n            });\r\n            /*let user = context.getters.getSearchInfoUserByUID(data.userID);*/\r\n\r\n\r\n        },\r\n\r\n        createChatListenerFirebase: function (context, chatID) {\r\n            let firestoreDB = firebase.firestore();\r\n            return new Promise(function (resolve, reject) {\r\n                try {\r\n                    let docRef = firestoreDB.collection(\"Chats\").doc(chatID)\r\n                        .onSnapshot(function (chat) {\r\n                            if (chat && chat.data()) {\r\n                                context.commit('addChatToChats', {\r\n                                    'id': chat.id, ...chat.data(),\r\n                                    'databaseListener': docRef,\r\n                                    'messages': []\r\n                                });\r\n\r\n                                try {\r\n                                    firestoreDB.collection(\"Chats\").doc(chatID).collection(\"Messages\")\r\n                                        .onSnapshot(function (chatMessages) {\r\n                                                if (chatMessages && chatMessages.docs) {\r\n                                                    let messages = chatMessages.docs.map(doc => {\r\n                                                        const id = doc.id;\r\n                                                        const dataDocs = doc.data();\r\n                                                        return {id, ...dataDocs};\r\n\r\n                                                    });\r\n                                                    messages.forEach(message => {\r\n                                                            let data = {\r\n                                                                'chatID': chat.id,\r\n                                                                'message': message\r\n                                                            }\r\n                                                            context.commit('addNewMessage', data);\r\n\r\n                                                            if (context.state.chatsInfo.activeChat == data.chatID) {\r\n                                                                context.dispatch('setChatWithUserMessagesToRead', context.state.chatsInfo.activeChat)\r\n                                                                    .catch(function (error) {\r\n                                                                        console.warn(\"Error updating messages to read:\", error);\r\n                                                                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                                                                    });\r\n                                                            }\r\n                                                            /*try {\r\n                                                                let messageDocRef = firestoreDB.collection(\"Chats\").doc(chatID).collection(\"Messages\").doc(message.id)\r\n                                                                    .onSnapshot(function (message2) {\r\n                                                                        if (message2 && message2.data()) {\r\n                                                                            let data = {\r\n                                                                                'chatID': chat.id,\r\n                                                                                'message': {\r\n                                                                                    'id': message.id,\r\n                                                                                    ...message2.data(),\r\n                                                                                    'databaseListener': messageDocRef\r\n                                                                                }\r\n                                                                            }\r\n                                                                            console.log(\"CAMBIO EN DOCUMENTO DE MESSAGE\")\r\n                                                                            if(context.state.activeChat && context.state.activeChat.chatID){\r\n                                                                                context.dispatch('setChatWithUserMessagesToRead',context.state.activeChat.chatID)\r\n                                                                                    .catch(function (error) {\r\n                                                                                        console.warn(\"Error updating messages to read:\", error);\r\n                                                                                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                                                                                    });\r\n                                                                            }\r\n\r\n                                                                            context.commit('addNewMessage', data);\r\n                                                                        }\r\n                                                                    });\r\n                                                        }\r\n                                                    catch\r\n                                                        (e)\r\n                                                        {\r\n                                                            console.error(e);\r\n                                                            reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                                                        }\r\n                                                        let data = {\r\n                                                            'chatID': chat.id,\r\n                                                            'message': message,\r\n                                                        }\r\n                                                        context.commit('addNewMessage', data);*/\r\n                                                        }\r\n                                                    );\r\n                                                }\r\n                                            }\r\n                                        );\r\n                                } catch (e) {\r\n                                    console.error(e);\r\n                                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                                }\r\n\r\n                                let otherUserID = chat.data().users.find(function (user) {\r\n                                    return user != firebase.auth().currentUser.uid;\r\n                                });\r\n\r\n                                context.dispatch('getUserPublicInfoDocByUIDFirebase', otherUserID).then(function (userDoc) {\r\n                                    if (userDoc.exists) {\r\n\r\n                                        let user = {\r\n                                            id: otherUserID,\r\n                                            chatID: chatID,\r\n                                            username: userDoc.data().username,\r\n                                            birthDate: userDoc.data().birthDate,\r\n                                            gender: userDoc.data().gender,\r\n                                            description: userDoc.data().description,\r\n                                            knownLanguages: userDoc.data().knownLanguages,\r\n                                            languagesToLearn: userDoc.data().languagesToLearn,\r\n                                            profileImage: userDoc.data().profileImage\r\n\r\n                                        };\r\n\r\n                                        context.commit('addUserToChatUsers', user);\r\n                                    }\r\n                                }).catch(function (error) {\r\n                                    console.warn(\"Error getting document:\", error);\r\n                                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                                });\r\n\r\n                            }\r\n                            resolve();\r\n                        });\r\n                } catch\r\n                    (e) {\r\n                    console.error(e);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                }\r\n            });\r\n\r\n            /*openChatWithUserFirebase: function (context, chatID) {\r\n                let firestoreDB = firebase.firestore();\r\n\r\n                let docRef = firestoreDB.doc(chatID)\r\n                    .onSnapshot(function (chat) {\r\n                        if (chat && chat.data()) {\r\n                            chat.data().messages.forEach(message => {\r\n                                    context.state.chat.chatWithUser.messages.push(message)\r\n                                    console.log(message)\r\n                                }\r\n                            )\r\n                            context.state.chat.chatWithUser.created = chat.data().created;\r\n                            context.state.chat.chatWithUser.users = chat.data().users;\r\n                        }\r\n                    });\r\n                context.state.chat.chatWithUser.databaseRef = docRef;\r\n            },\r\n\r\n            closeChatWithUserFirebase: function (context) {\r\n                context.state.chat.chatWithUser.databaseRef();\r\n            }*/\r\n\r\n        },\r\n        /*\r\n         * Action to set rating data.rating from user data.from to user data.to\r\n         */\r\n        rateUser: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('getRatingInUsersPublicInfo', data.to)\r\n                    .then((ratingInfo) => {\r\n                        context.commit('setUserRatingInfo', ratingInfo);\r\n                        context.dispatch('setRatingInRatingsFirebase', data)\r\n                            .then(() => {\r\n                                context.commit('setNewUserRatingInfo', data);\r\n                                context.commit('setUserRating', data);\r\n                                resolve();\r\n                            })\r\n                            .catch(function (error2) {\r\n                                console.error(error2);\r\n                                reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                            });\r\n                    })\r\n                    .catch(function (error) {\r\n                        console.error(error)\r\n                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                    });\r\n            });\r\n        },\r\n        setRatingInRatingsFirebase: function (context, data) {\r\n            return new Promise(function (resolve, reject) {\r\n                let firestoreDB = firebase.firestore();\r\n                let newRating = {};\r\n\r\n                newRating[data.to] = data.rating;\r\n                if (data.rating) {\r\n                    firestoreDB.collection(\"Ratings\").doc(data.from).set(newRating, {merge: true})\r\n                        .then(() => {\r\n                            console.log(\"Rating successfully written in Ratings\");\r\n                            resolve();\r\n                        })\r\n                        .catch(function (error) {\r\n                            console.error(\"Error writing rating info in Ratings: \", error);\r\n                            reject(error);\r\n                        });\r\n                } else {\r\n                    firestoreDB.collection(\"Ratings\").doc(data.from).update({\r\n                        [data.to]: firebase.firestore.FieldValue.delete()\r\n                    })\r\n                        .then(() => {\r\n                            console.log(\"Rating successfully deleted of Ratings\");\r\n                            resolve();\r\n                        })\r\n                        .catch(function (error) {\r\n                            console.error(\"Error deleting rating info of Ratings: \", error);\r\n                            reject(error);\r\n                        });\r\n                }\r\n\r\n            });\r\n        },\r\n        getRatingsInRatingsFirebase: function (context) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                firestoreDB.collection(\"Ratings\").doc(context.state.userInfo.uid).get().then(function (doc) {\r\n                    if (doc.exists) {\r\n                        context.commit('setUserRatings', doc.data());\r\n                    }\r\n                    resolve();\r\n                })\r\n                    .catch(function (error) {\r\n                        console.warn(\"Error getting document:\", error);\r\n                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n\r\n                    });\r\n            });\r\n        },\r\n\r\n        getRatingInUsersPublicInfo: function (context, uid) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                firestoreDB.collection(\"UsersPublicInfo\").doc(uid).get().then(function (userDoc) {\r\n\r\n                    console.log(userDoc.data())\r\n                    console.log(uid)\r\n                    let returnValue = {\r\n                        'uid': uid,\r\n                        'avgRating': userDoc.data().avgRating,\r\n                        'numRatings': userDoc.data().numRatings\r\n                    };\r\n\r\n                    resolve(returnValue);\r\n                })\r\n                    .catch(function (error) {\r\n                        console.warn(\"Error getting document:\", error);\r\n                        reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n\r\n                    });\r\n            });\r\n        },\r\n        listUsersRankingPageFirebase: function (context, first) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                if (first) {\r\n                    context.commit('resetRankingInfo');\r\n                }\r\n\r\n                let page;\r\n                if (context.state.rankingInfo.lastVisible == null) {\r\n                    page = firestoreDB.collection(\"UsersPublicInfo\").orderBy(Constants.DATABASE_AVG_RATING_FIELD, \"desc\").orderBy(Constants.DATABASE_NUM_RATINGS_FIELD, \"desc\");\r\n                } else {\r\n                    page = firestoreDB.collection(\"UsersPublicInfo\").orderBy(Constants.DATABASE_AVG_RATING_FIELD, \"desc\").orderBy(Constants.DATABASE_NUM_RATINGS_FIELD, \"desc\").startAfter(context.state.rankingInfo.lastVisible);\r\n                }\r\n                page.limit(Constants.RANKING_PAGE_SIZE).get().then(function (documentSnapshots) {\r\n                    console.log(documentSnapshots)\r\n                    let usersRetrieved = documentSnapshots.docs.map(doc => {\r\n                        const uid = doc.id;\r\n                        const dataDocs = doc.data();\r\n                        return {uid, ...dataDocs};\r\n\r\n                    });\r\n\r\n                    usersRetrieved.forEach(function (user) {\r\n                        context.commit('addUser', user);\r\n                        context.commit('addRankingInfoUserID', user.uid);\r\n                    });\r\n\r\n                    if (documentSnapshots.docs.length > 0) {\r\n                        let lastVisible2 = documentSnapshots.docs[documentSnapshots.docs.length - 1];\r\n                        context.commit('setRankingInfoLastVisible', lastVisible2);\r\n                    }\r\n                    resolve();\r\n                }).catch(function (error) {\r\n                    console.warn(\"Error fetching page: \", error);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n        isNextRankingUsersPageEmptyFirebase(context) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                let page = firestoreDB.collection(\"UsersPublicInfo\").orderBy(Constants.DATABASE_AVG_RATING_FIELD, \"desc\").orderBy(Constants.DATABASE_NUM_RATINGS_FIELD, \"desc\").startAfter(context.state.rankingInfo.lastVisible).limit(Constants.RANKING_PAGE_SIZE);\r\n                page.get().then(function (documentSnapshots) {\r\n                    console.log(documentSnapshots.docs.length)\r\n                    resolve(documentSnapshots.docs.length == 0);\r\n                }).catch((error) => {\r\n                    console.log(error);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n        /*createEmailVerifiedListenerFirebase: function (context, uid) {\r\n            return new Promise(function (resolve, reject) {\r\n                try {\r\n                    let docRef = firebase.auth.onSnapshot(function (chatIDs) {\r\n                            if (chatIDs) {\r\n                                context.commit('setUserInfoChatIDs', chatIDs.data().chats);\r\n                                context.commit('setUserInfoChatIDsListener', docRef);\r\n                            }\r\n                            resolve();\r\n                        })\r\n                } catch (e) {\r\n                    console.error(e);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                }\r\n            });\r\n        },*/\r\n\r\n        getUserLocation(context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('geolocateUser').then(function (location) {\r\n                    context.commit('setUserInfoLocation', location);\r\n                    context.dispatch('updateUserLocationFirebase', location)\r\n                        .then(() => {\r\n                            resolve();\r\n                        })\r\n                        .catch((error) => {\r\n                            console.error(error);\r\n                            reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                        });\r\n                }).catch(() => {\r\n                    context.dispatch('getUserLocationFirebase', context.state.userInfo.uid)\r\n                        .then((lastLocation) => {\r\n                            context.commit('setUserInfoLocation', lastLocation);\r\n                            reject(Constants.TEXT_PROBLEM_GETTING_CURRENT_LOCATION)\r\n                        })\r\n                        .catch(() => {\r\n                            context.commit('setUserInfoLocation', null);\r\n                            reject(Constants.TEXT_PROBLEM_GETTING_CURRENT_LOCATION)\r\n                        });\r\n\r\n                });\r\n            });\r\n        },\r\n        getUserLocationFirebase(context, uid) {\r\n            let geofirestore = new GeoFirestore(firebase.firestore());\r\n            return new Promise(function (resolve, reject) {\r\n                geofirestore.collection('UsersLocation').doc(uid).get()\r\n                    .then((snapshot) => {\r\n                        let lastLocationData = snapshot.data();\r\n                        console.log(JSON.stringify(lastLocationData))\r\n                        if (!lastLocationData) {\r\n                            reject();\r\n                        } else {\r\n                            resolve({\r\n                                lat: lastLocationData.coordinates._lat,\r\n                                lng: lastLocationData.coordinates._long\r\n                            });\r\n                        }\r\n                    })\r\n                    .catch((error) => {\r\n                        console.log(error);\r\n                        reject();\r\n                    });\r\n            });\r\n        },\r\n\r\n        updateUserLocationFirebase(context, location) {\r\n            let geofirestore = new GeoFirestore(firebase.firestore());\r\n\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                geofirestore.collection('UsersLocation').doc(context.state.userInfo.uid).set({\r\n                    coordinates: new firebase.firestore.GeoPoint(location.lat, location.lng)\r\n                }).then(function () {\r\n                    resolve();\r\n                }).catch((error) => {\r\n                    console.log(error);\r\n                    reject();\r\n                });\r\n            });\r\n        },\r\n        geolocateUser() {\r\n            return new Promise(function (resolve, reject) {\r\n                try {\r\n                    navigator.geolocation.getCurrentPosition(position => {\r\n                            resolve({\r\n                                lat: position.coords.latitude,\r\n                                lng: position.coords.longitude\r\n                            })\r\n                        },\r\n                        function (error) {\r\n                            console.log(error);\r\n                            reject();\r\n                        });\r\n                } catch (error) {\r\n                    console.log(error);\r\n                    reject();\r\n                }\r\n\r\n            });\r\n        },\r\n        getNearbyUsersFirebase(context, meters) {\r\n            let geofirestore = new GeoFirestore(firebase.firestore());\r\n            let queryNearbyUsers = geofirestore.collection('UsersLocation').near({\r\n                center: new firebase.firestore.GeoPoint(context.state.userInfo.location.lat, context.state.userInfo.location.lng),\r\n                radius: meters\r\n            });\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                queryNearbyUsers.get().then((snapshot) => {\r\n                    resolve(snapshot.docs);\r\n                }).catch((error) => {\r\n                    console.log(error);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n\r\n        listNearbyUsersSearchedPageFirebase(context, data) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            let pageUsers = 0;\r\n            let nearbyUsersIndex = 0;\r\n\r\n            let promises = [];\r\n\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                if (data.first) {\r\n                    context.commit('setSearchInfoUserIDs', []);\r\n                    context.commit('setSearchInfoLastVisible', null);\r\n\r\n                    context.dispatch('getNearbyUsersFirebase', context.state.searchInfo.filtering.maxDistanceRanges[context.state.searchInfo.filtering.maxDistance])\r\n                        .then((nearbyUsersDocs) => {\r\n                            let nearbyUsersIDs = [];\r\n                            nearbyUsersDocs.forEach(function (doc) {\r\n                                if (doc.id != context.state.userInfo.uid) {\r\n                                    nearbyUsersIDs.push(doc.id)\r\n                                }\r\n\r\n                            });\r\n                            context.commit('setSearchInfoUserIDs', nearbyUsersIDs);\r\n\r\n                            while (pageUsers < Constants.SEARCHED_USERS_PAGE_SIZE && nearbyUsersIndex < context.state.searchInfo.filtering.nearbyUsersIDs.length) {\r\n                                console.log(context.state.searchInfo.filtering.nearbyUsersIDs[nearbyUsersIndex]);\r\n\r\n                                promises.push(firestoreDB.collection(\"UsersPublicInfo\").doc(context.state.searchInfo.filtering.nearbyUsersIDs[nearbyUsersIndex]).get().then(function (doc) {\r\n                                    console.log(doc)\r\n                                    context.commit('addUserToSearchInfoUserIDs', doc.id);\r\n                                }).catch((error) => {\r\n                                    console.log(error);\r\n                                    context.commit('setSearchInfoLastVisible', nearbyUsersIndex - 1);\r\n                                    reject(Constants.TEXT_PROBLEM_GETTING_NEARBY_USERS);\r\n                                }));\r\n\r\n                                pageUsers++;\r\n                                nearbyUsersIndex++;\r\n                            }\r\n                            Promise.all(promises).then(function () {\r\n                                context.commit('setSearchInfoLastVisible', nearbyUsersIndex - 1);\r\n                                resolve();\r\n                            })\r\n                                .catch(function (error) {\r\n                                    context.commit('setSearchInfoLastVisible', nearbyUsersIndex - 1);\r\n                                    reject(error);\r\n                                });\r\n                        })\r\n                        .catch((error) => {\r\n                            console.log(error);\r\n                            reject(Constants.TEXT_PROBLEM_GETTING_NEARBY_USERS);\r\n                        });\r\n                } else {\r\n                    nearbyUsersIndex = context.state.searchInfo.lastVisible + 1;\r\n\r\n                    while (pageUsers < Constants.SEARCHED_USERS_PAGE_SIZE && nearbyUsersIndex < context.state.searchInfo.filtering.nearbyUsersIDs.length) {\r\n                        console.log(context.state.searchInfo.filtering.nearbyUsersIDs[nearbyUsersIndex]);\r\n\r\n                        promises.push(firestoreDB.collection(\"UsersPublicInfo\").doc(context.state.searchInfo.filtering.nearbyUsersIDs[nearbyUsersIndex]).get().then(function (doc) {\r\n                            console.log(doc)\r\n                            context.commit('addUserToSearchInfoUserIDs', doc.id);\r\n                        }).catch((error) => {\r\n                            console.log(error);\r\n                            context.commit('setSearchInfoLastVisible', nearbyUsersIndex - 1);\r\n                            reject(Constants.TEXT_PROBLEM_GETTING_NEARBY_USERS);\r\n                        }));\r\n\r\n                        pageUsers++;\r\n                        nearbyUsersIndex++;\r\n                    }\r\n                    Promise.all(promises).then(function () {\r\n                        context.commit('setSearchInfoLastVisible', nearbyUsersIndex - 1);\r\n                        resolve();\r\n                    })\r\n                        .catch(function (error) {\r\n                            context.commit('setSearchInfoLastVisible', nearbyUsersIndex - 1);\r\n                            reject(error);\r\n                        });\r\n                }\r\n            });\r\n        },\r\n        isNextNearbyUsersSearchedPageEmptyFirebase(context) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                console.log(\"--\" + context.state.searchInfo.lastVisible)\r\n                console.log(\"--\" + context.state.searchInfo.filtering.nearbyUsersIDs.length)\r\n\r\n                if (context.state.searchInfo.lastVisible >= context.state.searchInfo.filtering.nearbyUsersIDs.length - 1) {\r\n                    resolve(true);\r\n                }\r\n\r\n                let nearbyUsersIndex = context.state.searchInfo.lastVisible + 1;\r\n\r\n                while (nearbyUsersIndex < context.state.searchInfo.filtering.nearbyUsersIDs.length - 1) {\r\n\r\n                    firestoreDB.collection(\"UsersPublicInfo\").doc(context.state.searchInfo.filtering.nearbyUsersIDs[nearbyUsersIndex]).get().then(function (doc) {\r\n                        context.commit('addUserToSearchInfoUserIDs', {uid: doc.id, ...doc.data()});\r\n                        console.log(\"!!\" + context.state.searchInfo.lastVisible)\r\n                        resolve(false);\r\n\r\n                    }).catch((error) => {\r\n                        console.log(error);\r\n                        context.commit('setSearchInfoLastVisible', nearbyUsersIndex - 1);\r\n                        reject(true);\r\n                    });\r\n\r\n                    nearbyUsersIndex++;\r\n                }\r\n            });\r\n        },\r\n        listEventsEventsPageFirebase: function (context, first) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            return new Promise(function (resolve, reject) {\r\n\r\n                if (first) {\r\n                    context.commit('resetEventsInfo');\r\n                }\r\n\r\n                let page;\r\n                let currentDate = new Date();\r\n                if (context.state.eventsInfo.lastVisible == null) {\r\n                    page = firestoreDB.collection(Constants.DATABASE_COLLECTION_EVENTS).where(Constants.DATABASE_DATE_FIELD, \">\", currentDate).orderBy(Constants.DATABASE_DATE_FIELD);\r\n                } else {\r\n                    page = firestoreDB.collection(Constants.DATABASE_COLLECTION_EVENTS).where(Constants.DATABASE_DATE_FIELD, \">\", currentDate).orderBy(Constants.DATABASE_DATE_FIELD).startAfter(context.state.eventsInfo.lastVisible);\r\n                }\r\n                page.limit(Constants.EVENTS_PAGE_SIZE).get().then(function (documentSnapshots) {\r\n\r\n                    let eventsRetrieved = documentSnapshots.docs.map(doc => {\r\n                        const id = doc.id;\r\n                        const dataDocs = doc.data();\r\n                        return {id, ...dataDocs};\r\n\r\n                    });\r\n\r\n                    eventsRetrieved.forEach(function (event) {\r\n                        console.log(event)\r\n                        let eventCoordinates = {\r\n                            lat: event.coordinates.latitude,\r\n                            lng: event.coordinates.longitude\r\n                        };\r\n                        console.log(eventCoordinates)\r\n                        console.log(context.state.userInfo.location)\r\n                        if (context.state.userInfo.location != null) {\r\n                            let distanceInKm = context.getters.getHaversineDistance({\r\n                                p1: eventCoordinates,\r\n                                p2: context.state.userInfo.location\r\n                            }) / 1000;\r\n                            event = {\r\n                                ...event,\r\n                                distance: parseFloat(distanceInKm).toFixed(1)\r\n                            }\r\n                        } else {\r\n                            event = {\r\n                                ...event,\r\n                                distance: null\r\n                            }\r\n                        }\r\n\r\n                        context.commit('addEventsInfoEvent', event);\r\n                    });\r\n\r\n                    if (documentSnapshots.docs.length > 0) {\r\n                        let lastVisible2 = documentSnapshots.docs[documentSnapshots.docs.length - 1];\r\n                        context.commit('setEventsInfoLastVisible', lastVisible2);\r\n                    }\r\n                    resolve();\r\n                }).catch(function (error) {\r\n                    console.warn(\"Error fetching page: \", error);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n        isNextEventsEventsPageEmptyFirebase(context) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                let currentDate = new Date();\r\n                let page = firestoreDB.collection(Constants.DATABASE_COLLECTION_EVENTS).where(Constants.DATABASE_DATE_FIELD, \">\", currentDate).orderBy(Constants.DATABASE_DATE_FIELD).startAfter(context.state.eventsInfo.lastVisible).limit(Constants.EVENTS_PAGE_SIZE);\r\n                page.get().then(function (documentSnapshots) {\r\n                    resolve(documentSnapshots.docs.length == 0);\r\n                }).catch((error) => {\r\n                    console.log(error);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n        setSearchInfoFiltering(context, newFiltering) {\r\n            return context.commit('setEventsInfoLastVisible', newFiltering);\r\n        },\r\n        getUserByUID(context, uid) {\r\n            return new Promise(function (resolve, reject) {\r\n                let user = context.getters.getUserByUID(uid);\r\n                console.log(user)\r\n                if (null != user) {\r\n                    resolve(user);\r\n                } else {\r\n                    context.dispatch('getUserPublicInfoDocByUIDFirebase', uid)\r\n                        .then(function (doc) {\r\n                            if (doc.data()) {\r\n                                user = {\r\n                                    uid: uid,\r\n                                    ...doc.data()\r\n                                };\r\n                                context.commit('addUser', user);\r\n                                resolve(user);\r\n                            } else {\r\n                                reject();\r\n                            }\r\n                        })\r\n                        .catch(function (error) {\r\n                            console.log(error);\r\n                            reject();\r\n                        })\r\n                }\r\n\r\n            });\r\n        },\r\n        getEventFirebase: function (context, eventID) {\r\n            let firestoreDB = firebase.firestore();\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                firestoreDB.collection(Constants.DATABASE_COLLECTION_EVENTS).doc(eventID).get().then(function (documentSnapshot) {\r\n                    let eventCoordinates = {\r\n                        lat: documentSnapshot.data().coordinates.latitude,\r\n                        lng: documentSnapshot.data().coordinates.longitude\r\n                    };\r\n\r\n                    let distanceInKm = context.getters.getHaversineDistance({\r\n                        p1: eventCoordinates,\r\n                        p2: context.state.userInfo.location\r\n                    }) / 1000;\r\n                    let event = {\r\n                        id: documentSnapshot.id,\r\n                        ...documentSnapshot.data(),\r\n                        distance: parseFloat(distanceInKm).toFixed(1)\r\n                    };\r\n\r\n                    resolve(event);\r\n                }).catch(function (error) {\r\n                    console.warn(\"Error fetching event: \", error);\r\n                    reject(Constants.ERROR_GENERIC_CONNECTION_PROBLEM);\r\n                });\r\n            });\r\n        },\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ getLoggedUser ~                                                           >\r\n        // To get user logged                                                          >\r\n        //----------------------------------------------------------------------------->\r\n        getLoggedUser: function (context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('database/isUserAuth')\r\n                    .then((user) => {\r\n                        resolve(user);\r\n                    })\r\n                    .catch((error) => {\r\n                        console.error(error);\r\n                        reject(error);\r\n                    });\r\n            });\r\n        },\r\n\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ resetState ~                                                              >\r\n        // To reset all modules state info                                             >\r\n        //----------------------------------------------------------------------------->\r\n        resetAppState: function (context) {\r\n            return new Promise(function (resolve, reject) {\r\n                if(context.getters.getAppInfoLoaded) {\r\n                    let promises = [];\r\n\r\n                    promises.push(context.dispatch('user/resetState'));\r\n                    promises.push(context.dispatch('users/resetState'));\r\n                    promises.push(context.dispatch('chats/resetState'));\r\n                    promises.push(context.dispatch('events/resetState'));\r\n                    promises.push(context.dispatch('ranking/resetState'));\r\n                    promises.push(context.dispatch('permissions/resetState'));\r\n\r\n                    Promise.all(promises).then(() => {\r\n                        console.log('state successfully reseted.');\r\n                        context.commit('setAppInfoLoaded', false);\r\n                        resolve();\r\n                    })\r\n                        .catch((error) => {\r\n                            console.error(error);\r\n                            console.log('Error resetting state.');\r\n                            reject(Constants.ERROR_GENERIC_PROBLEM);\r\n                        });\r\n                }\r\n                else{\r\n                    resolve();\r\n                }\r\n            });\r\n        },\r\n\r\n\r\n        //----------------------------------------------------------------------------->\r\n        // ~ initAppInfo ~                                                             >\r\n        // To init the necessary info to init the app for a logged user                >\r\n        //----------------------------------------------------------------------------->\r\n        initAppInfo: function (context) {\r\n            return new Promise(function (resolve, reject) {\r\n                context.dispatch('user/isUserLogged')\r\n                    .then((isUserLogged) => {\r\n                        if (isUserLogged && !context.getters.getAppInfoLoaded) {\r\n                            context.dispatch('user/initState')\r\n                                .then(() => {\r\n                                    console.log('user module state successfully initiated.');\r\n                                    context.dispatch('chats/initState')\r\n                                        .then(() => {\r\n                                            console.log('chats module state successfully initiated.');\r\n                                            context.dispatch('ranking/initState')\r\n                                                .then(() => {\r\n                                                    console.log('ranking module state successfully initiated.');\r\n                                                    context.commit('setAppInfoLoaded', true);\r\n                                                    resolve();\r\n                                                })\r\n                                                .catch((error) => {\r\n                                                    reject(error);\r\n                                                });\r\n                                        })\r\n                                        .catch((error) => {\r\n                                            reject(error);\r\n                                        });\r\n\r\n                                })\r\n                                .catch((error) => {\r\n                                    reject(error);\r\n                                });\r\n                        } else {\r\n                            resolve();\r\n                        }\r\n\r\n                    })\r\n                    .catch((error) => {\r\n                        console.log('Error initiating users module state.');\r\n                        reject(error);\r\n                    });\r\n            })\r\n\r\n        },\r\n\r\n\r\n    },\r\n});\r\n","import Vue from 'vue'\r\nimport Router from 'vue-router'\r\nimport firebase from \"firebase\";\r\nimport Home from './views/Home.vue'\r\nimport store from './store/store.js'\r\n\r\nVue.use(Router)\r\n\r\nconst router = new Router({\r\n    /*mode: 'history',*/\r\n    base: process.env.BASE_URL,\r\n    routes: [\r\n        {\r\n            //To redirect all routes that do not exist to /home\r\n            path: '*',\r\n            redirect: '/home'\r\n        },\r\n        {\r\n            //To redirect root route to /home\r\n            path: '/',\r\n            redirect: '/home'\r\n        },\r\n        {\r\n            path: '/home',\r\n            name: 'home',\r\n            component: Home\r\n        },\r\n        {\r\n            path: '/login',\r\n            name: 'login',\r\n            component: () => import('./views/Accounts/Login.vue'),\r\n        },\r\n        {\r\n            path: '/sign-up',\r\n            name: 'signUp',\r\n            component: () => import('./views/Accounts/SignUp.vue'),\r\n        },\r\n        {\r\n            path: '/email-verification',\r\n            name: 'emailVerification',\r\n            component: () => import('./views/Accounts/EmailVerification.vue'),\r\n            meta: {\r\n                requiresAuth: true\r\n            }\r\n        }, {\r\n            path: '/fill-your-profile-info',\r\n            name: 'fillYourProfileInfo',\r\n            component: () => import('./views/Accounts/FillYourProfileInfo.vue'),\r\n            meta: {\r\n                requiresAuth: true\r\n            }\r\n        }, {\r\n            path: '/fill-your-languages',\r\n            name: 'fillYourLanguages',\r\n            component: () => import('./views/Accounts/FillYourLanguages.vue'),\r\n            meta: {\r\n                requiresAuth: true\r\n            }\r\n        }, {\r\n            path: '/set-your-profile-image',\r\n            name: 'setYourProfileImage',\r\n            component: () => import('./views/Accounts/SetYourProfileImage.vue'),\r\n            meta: {\r\n                requiresAuth: true\r\n            }\r\n        }, {\r\n            path: '/send-change-password-email',\r\n            name: 'sendChangePasswordEmail',\r\n            component: () => import('./views/Accounts/SendChangePasswordEmail.vue'),\r\n            meta: {\r\n                requiresAuth: false\r\n            }\r\n        },\r\n        {\r\n            path: '/dashboard',\r\n            name: 'dashboard',\r\n            redirect: {name: 'profileHome'},\r\n            meta: {requiresAuth: true},\r\n            component: () => import('./views/Dashboard.vue'),\r\n            children: [\r\n                {\r\n                    path: 'ranking',\r\n                    name: 'rankingHome',\r\n                    meta: {requiresAuth: true, menu: 'ranking'},\r\n                    component: () => import('./views/Ranking/RankingHome.vue'),\r\n                },\r\n                {\r\n                    path: 'ranking/user/:id/',\r\n                    name: 'userProfileRanking',\r\n                    meta: {requiresAuth: true, menu: 'ranking'},\r\n                    component: () => import('./views/UserProfile.vue'),\r\n                },\r\n                {\r\n                    path: 'events',\r\n                    name: 'eventsHome',\r\n                    meta: {requiresAuth: true, menu: 'events'},\r\n                    component: () => import('./views/Events/EventsHome.vue'),\r\n                },\r\n                {\r\n                    path: 'event/:id/',\r\n                    name: 'eventDescription',\r\n                    meta: {requiresAuth: true, menu: 'events'},\r\n                    component: () => import('./views/Events/EventDescription.vue'),\r\n                },\r\n                {\r\n                    path: 'search',\r\n                    name: 'searchHome',\r\n                    meta: {requiresAuth: true, menu: 'search'},\r\n                    component: () => import('./views/Search/SearchHome.vue'),\r\n                },\r\n                {\r\n                    path: 'search/filter',\r\n                    name: 'searchFilter',\r\n                    meta: {requiresAuth: true, menu: 'search'},\r\n                    component: () => import('./views/Search/SearchFilter.vue'),\r\n                },\r\n                {\r\n                    path: 'search/user/:id/',\r\n                    name: 'userProfileSearch',\r\n                    meta: {requiresAuth: true, menu: 'search'},\r\n                    component: () => import('./views/UserProfile.vue'),\r\n                },\r\n                {\r\n                    path: 'chats',\r\n                    name: 'chatHome',\r\n                    meta: {requiresAuth: true, menu: 'chats'},\r\n                    component: () => import('./views/Chats/ChatHome.vue'),\r\n                },\r\n                {\r\n                    path: 'chats/chat/:id/',\r\n                    name: 'chatWithUser',\r\n                    meta: {requiresAuth: true, menu: 'chats'},\r\n                    component: () => import('./views/Chats/ChatWithUser.vue'),\r\n                },\r\n                {\r\n                    path: 'chats/user/:id/',\r\n                    name: 'userProfileChat',\r\n                    meta: {requiresAuth: true, menu: 'chats'},\r\n                    component: () => import('./views/UserProfile.vue'),\r\n                },\r\n                {\r\n                    path: 'profile',\r\n                    name: 'profileHome',\r\n                    meta: {requiresAuth: true, menu: 'profile'},\r\n                    component: () => import('./views/Profile/ProfileHome.vue'),\r\n                },\r\n                {\r\n                    path: 'profile/:id/edit',\r\n                    name: 'profileEdit',\r\n                    meta: {requiresAuth: true, menu: 'profile'},\r\n                    component: () => import('./views/Profile/ProfileEdit.vue')\r\n                },\r\n                {\r\n                    path: 'settings',\r\n                    name: 'settings',\r\n                    meta: {requiresAuth: true, menu: 'profile'},\r\n                    component: () => import('./views/Settings/SettingsHome.vue')\r\n                },\r\n                {\r\n                    path: 'settings/account',\r\n                    name: 'settingsAccount',\r\n                    meta: {requiresAuth: true, menu: 'profile'},\r\n                    component: () => import('./views/Settings/SettingsAccount.vue')\r\n                },\r\n                {\r\n                    path: 'settings/account/edit/name-and-last-name',\r\n                    name: 'settingsAccountEditNameAndLastName',\r\n                    meta: {requiresAuth: true, menu: 'profile'},\r\n                    component: () => import('./views/Settings/SettingsAccountEditNameAndLastName.vue')\r\n                },\r\n                {\r\n                    path: 'settings/account/edit/email',\r\n                    name: 'settingsAccountEditEmail',\r\n                    meta: {requiresAuth: true, menu: 'profile'},\r\n                    component: () => import('./views/Settings/SettingsAccountEditEmail.vue')\r\n                },\r\n                {\r\n                    path: 'settings/account/password-verification',\r\n                    name: 'settingsAccountPasswordVerification',\r\n                    meta: {requiresAuth: true, menu: 'profile'},\r\n                    component: () => import('./views/Settings/SettingsAccountPasswordVerification.vue')\r\n                },\r\n                {\r\n                    path: 'settings/account/edit/password',\r\n                    name: 'settingsAccountEditPassword',\r\n                    meta: {requiresAuth: true, menu: 'profile'},\r\n                    component: () => import('./views/Settings/SettingsAccountEditPassword.vue')\r\n                }\r\n            ]\r\n        }\r\n    ]\r\n});\r\n\r\n\r\nrouter.beforeEach((to, from, next) => {\r\n    const currentUser = firebase.auth().currentUser;\r\n    const requiresAuth = to.matched.some(record => record.meta.requiresAuth);\r\n    if (requiresAuth && !currentUser) {\r\n        next('home');\r\n    } else if ((requiresAuth && currentUser && (to.name !== from.name) && (!to.path.startsWith('/dashboard') || !from.path.startsWith('/dashboard'))) || (!requiresAuth && currentUser)) {\r\n        store.dispatch('user/getRegistrationState').then(registrationState => {\r\n            if (to.path.startsWith('/' + registrationState)) {\r\n                next()\r\n            } else if (from.path.startsWith('/' + registrationState)) {\r\n                next({name: from.name});\r\n            } else {\r\n                next({path: '/' + registrationState});\r\n            }\r\n        });\r\n        //next()\r\n    }\r\n    else {\r\n        next();\r\n    }\r\n    /*else if(to.matched.some(record =>['login','signUp','home','sendChangePasswordEmail'].includes(record.name))){\r\n      if (currentUser) {\r\n        next({\r\n          path: '/dashboard'\r\n        })\r\n      }\r\n      else{\r\n        next();\r\n      }*/\r\n});\r\n\r\nexport default router;\r\n","/* eslint-disable no-console */\n\nimport { register } from 'register-service-worker'\n\nif (process.env.NODE_ENV === 'production') {\n  register(`${process.env.BASE_URL}firebase-messaging-sw.js`, {\n    ready () {\n      console.log(\n        'App is being served from cache by a service worker.\\n' +\n        'For more details, visit https://goo.gl/AFskqB'\n      )\n    },\n    registered () {\n      console.log('Service worker has been registered.')\n    },\n    cached () {\n      console.log('Content has been cached for offline use.')\n    },\n    updatefound () {\n      console.log('New content is downloading.')\n    },\n    updated () {\n      console.log('New content is available; please refresh.')\n    },\n    offline () {\n      console.log('No internet connection found. App is running in offline mode.')\n    },\n    error (error) {\n      console.error('Error during service worker registration:', error)\n    }\n  })\n}\n","import Vue from 'vue';\nimport Vuetify from 'vuetify/lib';\n\n\nVue.use(Vuetify);\n\nexport default new Vuetify({\n  icons: {\n    iconfont: 'mdi',\n  },\n  theme: {\n    light: {\n      primary: '#1976D2',\n      secondary: '#424242',\n      accent: '#82B1FF',\n      error: '#FF5252',\n      info: '#2196F3',\n      success: '#4CAF50',\n      warning: '#FFC107',\n    }\n  }\n});\n","import Vue from 'vue'\r\nimport App from './App.vue'\r\nimport router from './router'\r\nimport store from './store/store'\r\nimport './registerServiceWorker'\r\nimport vuetify from './plugins/vuetify';\r\nimport firebase from \"firebase\";\r\nimport VueChatScroll from 'vue-chat-scroll'\r\nVue.use(VueChatScroll)\r\nimport * as VueGoogleMaps from \"vue2-google-maps\";\r\n\r\nVue.use(VueGoogleMaps, {\r\n  load: {\r\n    key: \"AIzaSyBYhPYAZkG6ML2kRArdK8xITPrZWzF0JSw\",\r\n    libraries: \"places\" // necessary for places input\r\n  }\r\n});\r\n\r\n\r\nVue.config.productionTip = false\r\n\r\nlet app = '';\r\n\r\nlet config = {\r\n  apiKey: \"AIzaSyABGil2afckXxQ127FS8fW6y5phy1wzd6g\",\r\n  authDomain: \"tfg-vue-m3m.firebaseapp.com\",\r\n  databaseURL: \"https://tfg-vue-m3m.firebaseio.com\",\r\n  projectId: \"tfg-vue-m3m\",\r\n  storageBucket: \"tfg-vue-m3m.appspot.com\",\r\n  messagingSenderId: \"144506012173\",\r\n  appId: \"1:144506012173:web:8a58aa4b50d8b336184b44\"\r\n};\r\nfirebase.initializeApp(config);\r\n\r\n// Initialize Cloud Firestore through Firebase\r\nlet db = firebase.firestore();\r\n\r\n// Disable deprecated features\r\ndb.settings({\r\n  timestampsInSnapshots: true\r\n});\r\n\r\ndb.enablePersistence({experimentalTabSynchronization:true})\r\n\r\nconst storage = firebase.storage()\r\n\r\nconst messaging = firebase.messaging()\r\n\r\nexport default {\r\n  db,\r\n  storage,\r\n  messaging\r\n}\r\n\r\nfirebase.auth().onAuthStateChanged(() => {\r\n  if (!app) {\r\n    app = new Vue({\r\n      router,\r\n      store,\r\n      vuetify,\r\n      render: h => h(App)\r\n    }).$mount('#app');\r\n  }\r\n})","module.exports = __webpack_public_path__ + \"img/logo.82b9c7a5.png\";","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/vuetify-loader/lib/loader.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=style&index=0&id=58559630&scoped=true&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/vuetify-loader/lib/loader.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=style&index=0&id=58559630&scoped=true&lang=css&\""],"sourceRoot":""}