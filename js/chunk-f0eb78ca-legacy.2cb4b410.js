(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f0eb78ca"],{"35f2":function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",[n("v-app-bar",{attrs:{fixed:"",app:"",color:"#FFFFFF",elevation:"3"}},[n("v-row",[n("v-col",{staticClass:"text-center"},[n("v-toolbar-title",[e._v(e._s(e.chatsText))])],1)],1)],1),n("v-row",{staticStyle:{"margin-top":"54px"}},[n("v-col",{staticClass:"pa-0"},[n("v-list",{staticClass:"ma-0 pa-0",attrs:{"three-line":""}},[e._l(e.items,(function(t,s){return[t.header?n("v-subheader",{key:t.header,domProps:{textContent:e._s(t.header)}}):t.divider?n("v-divider",{key:s,attrs:{inset:t.inset}}):n("v-list-item",{key:t.title,on:{click:function(n){return e.openChatWithUser(t.ids)}}},[n("v-list-item-avatar",[n("v-img",{attrs:{src:t.avatar}})],1),n("v-list-item-content",[n("v-list-item-title",[e._v("\n                                "+e._s(t.title)+"\n                                "),n("span",{directives:[{name:"show",rawName:"v-show",value:0!=t.notReadMessages,expression:"item.notReadMessages != 0"}],attrs:{id:"notReadMessagesNotification"}},[e._v(e._s(t.notReadMessages))])]),n("v-list-item-subtitle",{domProps:{innerHTML:e._s(t.subtitle)}})],1)],1)]}))],2)],1),n("v-col",{staticClass:"text-center"},[n("v-btn",{attrs:{color:"primary"},on:{click:e.getMessagingToken}},[n("p",[e._v("uwu2")])])],1)],1)],1)},a=[],o=(n("8e6e"),n("456d"),n("ac6a"),n("55dd"),n("96cf"),n("3b8d")),i=n("bd86"),r=n("2f62"),c=n("4c51"),l=n("8aa5"),u=n("bc3a"),g=n.n(u);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(n,!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m={name:"ChatHome",data:function(){return{chatsText:c["a"].TEXT_CHATS}},methods:f({},Object(r["b"])(["prepareChatWithUser"]),{openChatWithUser:function(e){this.$router.push("chats/chat/"+e.chat)},getMessagingToken:function(){var e=this;l["messaging"]().getToken().then(function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(n){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n){t.next=8;break}if(s=window.localStorage.getItem("messagingToken"),console.log("token will be updated",s!=n),s==n){t.next=6;break}return t.next=6,e.saveToken(n);case 6:t.next=10;break;case 8:console.log("No Instance ID token available. Request permission to generate one."),e.notificationsPermisionRequest();case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(e){console.log("An error occurred while retrieving token. ",e)}))},notificationsPermisionRequest:function(){var e=this;l["messaging"]().requestPermission().then((function(){e.getMessagingToken()})).catch((function(e){console.log("Unable to get permission to notify.",e)}))},listenTokenRefresh:function(){var e=window.localStorage.getItem("messagingToken");console.log("currentMessageToken",e),e&&l["messaging"]().onTokenRefresh((function(){l["messaging"]().getToken().then((function(e){this.saveToken(e)})).catch((function(e){console.log("Unable to retrieve refreshed token ",e)}))}))},saveToken:function(e){console.log("tokens",e),g.a.post("https://us-central1-tfg-vue-m3m.cloudfunctions.net/GeneralSubscription",{token:e}).then((function(t){window.localStorage.setItem("messagingToken",e),console.log(t)})).catch((function(e){console.log(e)}))}}),computed:f({},Object(r["e"])({activeChat:function(e){return e.activeChat},chats:function(e){return e.chats}}),{},Object(r["c"])({notReadMessagesCount:"notReadMessagesCountByChatID"}),{items:function(){var e=this,t=this,n=[],s=t.chats.sort((function(e,t){return e.messages.length>0&&t.messages.length>0?t.messages[t.messages.length-1].created.toDate().getTime()-e.messages[e.messages.length-1].created.toDate().getTime():0}));return s.forEach((function(s){var a=e.$store.getters.getChatUserByChatID(s.id);s.messages.length>0&&(n.push({ids:{chat:s.id,user:a.id},avatar:a.profileImage,title:a.username,subtitle:s.messages[s.messages.length-1].text,notReadMessages:t.notReadMessagesCount(s.id)}),n.push({divider:!0,inset:!0}))})),n}})},d=m,v=(n("c960"),n("2877")),p=n("6544"),b=n.n(p),k=n("40dc"),w=n("8336"),T=n("62ad"),C=n("a523"),O=n("ce7e"),y=n("adda"),R=n("8860"),j=n("da13"),x=n("8270"),V=n("5d23"),I=n("0fd9"),M=n("e0c7"),P=n("2a7f"),_=Object(v["a"])(d,s,a,!1,null,"2c292496",null);t["default"]=_.exports;b()(_,{VAppBar:k["a"],VBtn:w["a"],VCol:T["a"],VContainer:C["a"],VDivider:O["a"],VImg:y["a"],VList:R["a"],VListItem:j["a"],VListItemAvatar:x["a"],VListItemContent:V["a"],VListItemSubtitle:V["b"],VListItemTitle:V["c"],VRow:I["a"],VSubheader:M["a"],VToolbarTitle:P["a"]})},"882b":function(e,t,n){},c960:function(e,t,n){"use strict";var s=n("882b"),a=n.n(s);a.a}}]);
//# sourceMappingURL=chunk-f0eb78ca-legacy.2cb4b410.js.map