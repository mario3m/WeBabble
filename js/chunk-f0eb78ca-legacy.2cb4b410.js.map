{"version":3,"sources":["webpack:///./src/views/Chat/ChatHome.vue?f8ac","webpack:///src/views/Chat/ChatHome.vue","webpack:///./src/views/Chat/ChatHome.vue?e30a","webpack:///./src/views/Chat/ChatHome.vue","webpack:///./src/views/Chat/ChatHome.vue?4aca"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","staticClass","_v","_s","chatsText","staticStyle","_l","item","index","key","header","domProps","inset","title","on","$event","openChatWithUser","ids","avatar","directives","name","rawName","value","notReadMessages","expression","subtitle","getMessagingToken","staticRenderFns","component","VAppBar","VBtn","VCol","VContainer","VDivider","VImg","VList","VListItem","VListItemAvatar","VListItemContent","VListItemSubtitle","VListItemTitle","VRow","VSubheader","VToolbarTitle","VToolbar"],"mappings":"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","file":"js/chunk-f0eb78ca-legacy.2cb4b410.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-container',[_c('v-app-bar',{attrs:{\"fixed\":\"\",\"app\":\"\",\"color\":\"#FFFFFF\",\"elevation\":\"3\"}},[_c('v-row',[_c('v-col',{staticClass:\"text-center\"},[_c('v-toolbar-title',[_vm._v(_vm._s(_vm.chatsText))])],1)],1)],1),_c('v-row',{staticStyle:{\"margin-top\":\"54px\"}},[_c('v-col',{staticClass:\"pa-0\"},[_c('v-list',{staticClass:\"ma-0 pa-0\",attrs:{\"three-line\":\"\"}},[_vm._l((_vm.items),function(item,index){return [(item.header)?_c('v-subheader',{key:item.header,domProps:{\"textContent\":_vm._s(item.header)}}):(item.divider)?_c('v-divider',{key:index,attrs:{\"inset\":item.inset}}):_c('v-list-item',{key:item.title,on:{\"click\":function($event){return _vm.openChatWithUser(item.ids)}}},[_c('v-list-item-avatar',[_c('v-img',{attrs:{\"src\":item.avatar}})],1),_c('v-list-item-content',[_c('v-list-item-title',[_vm._v(\"\\n                                \"+_vm._s(item.title)+\"\\n                                \"),_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(item.notReadMessages != 0),expression:\"item.notReadMessages != 0\"}],attrs:{\"id\":\"notReadMessagesNotification\"}},[_vm._v(_vm._s(item.notReadMessages))])]),_c('v-list-item-subtitle',{domProps:{\"innerHTML\":_vm._s(item.subtitle)}})],1)],1)]})],2)],1),_c('v-col',{staticClass:\"text-center\"},[_c('v-btn',{attrs:{\"color\":\"primary\"},on:{\"click\":_vm.getMessagingToken}},[_c('p',[_vm._v(\"uwu2\")])])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <v-container>\r\n        <v-app-bar\r\n                fixed\r\n                app\r\n                color=\"#FFFFFF\"\r\n                elevation=\"3\"\r\n        >\r\n            <v-row >\r\n                <!--<v-col></v-col>-->\r\n                <v-col class=\"text-center\"><v-toolbar-title>{{chatsText}}</v-toolbar-title></v-col>\r\n                <!-- <v-col class=\"text-right\" style=\"padding-top: 0; padding-bottom: 0\"><v-btn class=\"app-bar-button\" small style=\"display: inline;\" text color=\"primary\"\r\n                                                                                            @click=\"openProfileEdit\">{{editText}}\r\n                 </v-btn></v-col>-->\r\n            </v-row>\r\n\r\n\r\n        </v-app-bar>\r\n\r\n        <v-row style=\"margin-top: 54px\">\r\n            <v-col class=\"pa-0\">\r\n                <v-list three-line class=\"ma-0 pa-0\">\r\n                    <template v-for=\"(item, index) in items\">\r\n                        <v-subheader\r\n                                v-if=\"item.header\"\r\n                                :key=\"item.header\"\r\n                                v-text=\"item.header\"\r\n                        ></v-subheader>\r\n\r\n                        <v-divider\r\n                                v-else-if=\"item.divider\"\r\n                                :key=\"index\"\r\n                                :inset=\"item.inset\"\r\n                        ></v-divider>\r\n\r\n                        <v-list-item\r\n                                v-else\r\n                                :key=\"item.title\"\r\n                                @click=\"openChatWithUser(item.ids)\"\r\n                        >\r\n                            <v-list-item-avatar>\r\n                                <v-img :src=\"item.avatar\"></v-img>\r\n                            </v-list-item-avatar>\r\n\r\n                            <v-list-item-content>\r\n                                <v-list-item-title>\r\n                                    {{item.title}}\r\n                                    <span v-show=\"item.notReadMessages != 0\" id=\"notReadMessagesNotification\">{{item.notReadMessages}}</span>\r\n                                </v-list-item-title>\r\n                                <v-list-item-subtitle v-html=\"item.subtitle\"></v-list-item-subtitle>\r\n                            </v-list-item-content>\r\n                        </v-list-item>\r\n                    </template>\r\n                </v-list>\r\n            </v-col>\r\n            <v-col class=\"text-center\">\r\n                <v-btn  color=\"primary\" @click=\"getMessagingToken\">\r\n                    <p>uwu2</p>\r\n                </v-btn>\r\n            </v-col>\r\n        </v-row>\r\n\r\n    </v-container>\r\n</template>\r\n\r\n<script>\r\n    import {mapActions, mapState, mapGetters} from 'vuex';\r\n    import Constants from \"../../store/Constants\";\r\n    import * as firebase from \"firebase\";\r\n    import axios from \"axios\";\r\n\r\n    export default {\r\n        name: \"ChatHome\",\r\n        data() {\r\n            return {\r\n                chatsText: Constants.TEXT_CHATS\r\n            }\r\n        },\r\n        methods: {\r\n            ...mapActions([\r\n                'prepareChatWithUser'\r\n            ]),\r\n            openChatWithUser(itemIDs) {\r\n                this.$router.push('chats/chat/' + itemIDs.chat);\r\n            },\r\n            getMessagingToken () {\r\n                firebase.messaging().getToken().then(async (token) => {\r\n                    if (token) {\r\n                        const currentMessageToken = window.localStorage.getItem('messagingToken')\r\n                        console.log('token will be updated', currentMessageToken != token)\r\n                        if(currentMessageToken != token){\r\n                            await this.saveToken(token)\r\n                        }\r\n                    } else {\r\n                        console.log('No Instance ID token available. Request permission to generate one.');\r\n                        this.notificationsPermisionRequest();\r\n                    }\r\n                }).catch(function(err) {\r\n                    console.log('An error occurred while retrieving token. ', err);\r\n                });\r\n            },\r\n            notificationsPermisionRequest () {\r\n                firebase.messaging().requestPermission()\r\n                    .then(() => {\r\n                        this.getMessagingToken();\r\n                    })\r\n                    .catch((err) => {\r\n                        console.log('Unable to get permission to notify.', err);\r\n                    });\r\n            },\r\n            listenTokenRefresh() {\r\n                const currentMessageToken = window.localStorage.getItem('messagingToken')\r\n                console.log('currentMessageToken', currentMessageToken);\r\n                if(currentMessageToken){\r\n                    firebase.messaging().onTokenRefresh(function() {\r\n                        firebase.messaging().getToken().then(function(token) {\r\n                            this.saveToken(token);\r\n                        }).catch(function(err) {\r\n                            console.log('Unable to retrieve refreshed token ', err);\r\n                        });\r\n                    });\r\n                }\r\n            },\r\n            saveToken(token) {\r\n                console.log('tokens', token)\r\n                axios.post('https://us-central1-tfg-vue-m3m.cloudfunctions.net/GeneralSubscription',{ token })\r\n                    .then(response => {\r\n                        window.localStorage.setItem('messagingToken',token)\r\n                        console.log(response)\r\n                    }).catch((err) => {\r\n                    console.log(err)\r\n                })\r\n            },\r\n        },\r\n        computed: {\r\n            ...mapState({\r\n                activeChat: state => state.activeChat,\r\n                chats: state => state.chats,\r\n            }),\r\n            ...mapGetters({\r\n                notReadMessagesCount: 'notReadMessagesCountByChatID'\r\n            }),\r\n            items: function () {\r\n                let self = this;\r\n                let itemsChatList = [];\r\n                let sortedChats = self.chats.sort(function (chat1, chat2) {\r\n                    if (chat1.messages.length > 0 && chat2.messages.length > 0) {\r\n                        return chat2.messages[chat2.messages.length - 1].created.toDate().getTime() - chat1.messages[chat1.messages.length - 1].created.toDate().getTime();\r\n                    } else {\r\n                        return 0;\r\n                    }\r\n                });\r\n                sortedChats.forEach(chat => {\r\n                        let user = this.$store.getters.getChatUserByChatID(chat.id);\r\n                        if (chat.messages.length > 0) {\r\n                            itemsChatList.push({\r\n                                ids: {\r\n                                    chat: chat.id,\r\n                                    user: user.id\r\n                                },\r\n                                avatar: user.profileImage,\r\n                                title: user.username,\r\n                                subtitle: chat.messages[chat.messages.length - 1].text,\r\n                                notReadMessages: self.notReadMessagesCount(chat.id)\r\n                            });\r\n                            itemsChatList.push({divider: true, inset: true});\r\n                        }\r\n                    }\r\n                )\r\n                return itemsChatList;\r\n            },\r\n        }\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n    #notReadMessagesNotification {\r\n        display: inline-block;\r\n        background-color: lightskyblue;\r\n        margin-left: 5px;\r\n        padding: 4px;\r\n        border-radius: 50%;\r\n    }\r\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vuetify-loader/lib/loader.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChatHome.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vuetify-loader/lib/loader.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChatHome.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ChatHome.vue?vue&type=template&id=2c292496&scoped=true&\"\nimport script from \"./ChatHome.vue?vue&type=script&lang=js&\"\nexport * from \"./ChatHome.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ChatHome.vue?vue&type=style&index=0&id=2c292496&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2c292496\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VAppBar } from 'vuetify/lib/components/VAppBar';\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VDivider } from 'vuetify/lib/components/VDivider';\nimport { VImg } from 'vuetify/lib/components/VImg';\nimport { VList } from 'vuetify/lib/components/VList';\nimport { VListItem } from 'vuetify/lib/components/VList';\nimport { VListItemAvatar } from 'vuetify/lib/components/VList';\nimport { VListItemContent } from 'vuetify/lib/components/VList';\nimport { VListItemSubtitle } from 'vuetify/lib/components/VList';\nimport { VListItemTitle } from 'vuetify/lib/components/VList';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSubheader } from 'vuetify/lib/components/VSubheader';\nimport { VToolbarTitle } from 'vuetify/lib/components/VToolbar';\ninstallComponents(component, {VAppBar,VBtn,VCol,VContainer,VDivider,VImg,VList,VListItem,VListItemAvatar,VListItemContent,VListItemSubtitle,VListItemTitle,VRow,VSubheader,VToolbarTitle})\n","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/vuetify-loader/lib/loader.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChatHome.vue?vue&type=style&index=0&id=2c292496&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/vuetify-loader/lib/loader.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChatHome.vue?vue&type=style&index=0&id=2c292496&scoped=true&lang=css&\""],"sourceRoot":""}