(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f0eb78ca"],{"35f2":function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-container",[s("v-app-bar",{attrs:{fixed:"",app:"",color:"#FFFFFF",elevation:"3"}},[s("v-row",[s("v-col",{staticClass:"text-center"},[s("v-toolbar-title",[e._v(e._s(e.chatsText))])],1)],1)],1),s("v-row",{staticStyle:{"margin-top":"54px"}},[s("v-col",{staticClass:"pa-0"},[s("v-list",{staticClass:"ma-0 pa-0",attrs:{"three-line":""}},[e._l(e.items,(function(t,n){return[t.header?s("v-subheader",{key:t.header,domProps:{textContent:e._s(t.header)}}):t.divider?s("v-divider",{key:n,attrs:{inset:t.inset}}):s("v-list-item",{key:t.title,on:{click:function(s){return e.openChatWithUser(t.ids)}}},[s("v-list-item-avatar",[s("v-img",{attrs:{src:t.avatar}})],1),s("v-list-item-content",[s("v-list-item-title",[e._v("\n                                "+e._s(t.title)+"\n                                "),s("span",{directives:[{name:"show",rawName:"v-show",value:0!=t.notReadMessages,expression:"item.notReadMessages != 0"}],attrs:{id:"notReadMessagesNotification"}},[e._v(e._s(t.notReadMessages))])]),s("v-list-item-subtitle",{domProps:{innerHTML:e._s(t.subtitle)}})],1)],1)]}))],2)],1),s("v-col",{staticClass:"text-center"},[s("v-btn",{attrs:{color:"primary"},on:{click:e.getMessagingToken}},[s("p",[e._v("uwu2")])])],1)],1)],1)},a=[],o=(s("ac6a"),s("55dd"),s("1da1")),i=s("ade3"),r=s("2f62"),c=s("4c51"),l=s("8aa5"),g=s("bc3a"),u=s.n(g);function h(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function d(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?h(s,!0).forEach((function(t){Object(i["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):h(s).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var m={name:"ChatHome",data(){return{chatsText:c["a"].TEXT_CHATS}},methods:d({},Object(r["b"])(["prepareChatWithUser"]),{openChatWithUser(e){this.$router.push("chats/chat/"+e.chat)},getMessagingToken(){var e=this;l["messaging"]().getToken().then(function(){var t=Object(o["a"])((function*(t){if(t){const s=window.localStorage.getItem("messagingToken");console.log("token will be updated",s!=t),s!=t&&(yield e.saveToken(t))}else console.log("No Instance ID token available. Request permission to generate one."),e.notificationsPermisionRequest()}));return function(e){return t.apply(this,arguments)}}()).catch((function(e){console.log("An error occurred while retrieving token. ",e)}))},notificationsPermisionRequest(){l["messaging"]().requestPermission().then(()=>{this.getMessagingToken()}).catch(e=>{console.log("Unable to get permission to notify.",e)})},listenTokenRefresh(){const e=window.localStorage.getItem("messagingToken");console.log("currentMessageToken",e),e&&l["messaging"]().onTokenRefresh((function(){l["messaging"]().getToken().then((function(e){this.saveToken(e)})).catch((function(e){console.log("Unable to retrieve refreshed token ",e)}))}))},saveToken(e){console.log("tokens",e),u.a.post("https://us-central1-tfg-vue-m3m.cloudfunctions.net/GeneralSubscription",{token:e}).then(t=>{window.localStorage.setItem("messagingToken",e),console.log(t)}).catch(e=>{console.log(e)})}}),computed:d({},Object(r["e"])({activeChat:e=>e.activeChat,chats:e=>e.chats}),{},Object(r["c"])({notReadMessagesCount:"notReadMessagesCountByChatID"}),{items:function(){let e=this,t=[],s=e.chats.sort((function(e,t){return e.messages.length>0&&t.messages.length>0?t.messages[t.messages.length-1].created.toDate().getTime()-e.messages[e.messages.length-1].created.toDate().getTime():0}));return s.forEach(s=>{let n=this.$store.getters.getChatUserByChatID(s.id);s.messages.length>0&&(t.push({ids:{chat:s.id,user:n.id},avatar:n.profileImage,title:n.username,subtitle:s.messages[s.messages.length-1].text,notReadMessages:e.notReadMessagesCount(s.id)}),t.push({divider:!0,inset:!0}))}),t}})},p=m,v=(s("c960"),s("2877")),f=s("6544"),b=s.n(f),k=s("40dc"),w=s("8336"),T=s("62ad"),y=s("a523"),C=s("ce7e"),O=s("adda"),j=s("8860"),V=s("da13"),I=s("8270"),R=s("5d23"),M=s("0fd9"),P=s("e0c7"),_=s("2a7f"),x=Object(v["a"])(p,n,a,!1,null,"2c292496",null);t["default"]=x.exports;b()(x,{VAppBar:k["a"],VBtn:w["a"],VCol:T["a"],VContainer:y["a"],VDivider:C["a"],VImg:O["a"],VList:j["a"],VListItem:V["a"],VListItemAvatar:I["a"],VListItemContent:R["a"],VListItemSubtitle:R["b"],VListItemTitle:R["c"],VRow:M["a"],VSubheader:P["a"],VToolbarTitle:_["a"]})},"882b":function(e,t,s){},c960:function(e,t,s){"use strict";var n=s("882b"),a=s.n(n);a.a}}]);
//# sourceMappingURL=chunk-f0eb78ca.a60a02e5.js.map